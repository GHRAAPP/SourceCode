<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src * data:" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>My App</title>
    <!-- Path to Framework7 Library CSS-->
    <link rel="stylesheet" href="css/framework7.ios.min.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.min.css">
    <!-- Path Fonts-->
    <link rel="stylesheet" href="font/css/ionicons.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="css/my-app.css">
    <link rel="stylesheet" href="css/framework7.upscroller.min.css">
    <link rel="stylesheet" href="css/framework7.keypad.min.css">
    <link rel="stylesheet" href="css/toast.css">
    <style>
        .picker-keypad {
            height: 69%;
        }

        .close-panel {
            color: #777 !important;
        }

        .inactiveLink {
            pointer-events: none;
            cursor: default;
        }

        .infinite-scroll-preloader {
            margin-top: -20px;
            margin-bottom: 10px;
            text-align: center;
        }

            .infinite-scroll-preloader .preloader {
                width: 34px;
                height: 34px;
            }

        /*.picker-modal {
            height:auto;
        }
        .picker-modal-inner > .content-block {
            margin:0;
        }*/

        select .disabled, [disabled] {
            opacity: 1;
            color: black;
        }

        .displaynone {
            display: none !important;
        }
    </style>
</head>
<body class="theme-blue layout-white" onload="onLoad();">

    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar-overlay"></div>
    <!-- Panels overlay-->
    <div class="panel-overlay"></div>
    <!-- Left panel with reveal effect-->
    <div class="panel panel-left panel-reveal" style="display: block;border-right-color: #DDDDDD;border-right-style: solid;border-right-width: thin;">
        <div class="content-block-title">Main Menu</div>
        <div class="content-block">
            <div class="list-block" style="margin-top: 0px;">
                <ul>
                    <!-- Text inputs -->
                    <li>
                        <a class="close-panel" href="products.html?ObjectType=A">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-android-apps font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Products</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="search.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-search-strong font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Search</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="quick-scan.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-barcode-outline font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Quick Scan</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="view-cart.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-cart font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>View Cart</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="order-history.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-time font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Order History</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="setmsrp.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-pricetags font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Set MSRP</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="announcement.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-mic font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Announcement</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>

                    <li>
                        <a class="close-panel" href="promotion.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-pricetag font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Promotions</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>

                    <li>
                        <div class="item-content">
                            <div class="item-media"><i class="ion-ios-calendar font23 colorBlue"></i></div>
                            <div class="item-inner">
                                <div class="item-title label open-popup" data-popup=".popup-calendar" style="width:100%;">Calendar</div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-media"><i class="ion-calculator font23 colorBlue"></i></div>
                            <div class="item-inner">
                                <div class="item-title label open-popup" data-popup=".popup-calculator" style="width:100%;">Calculator</div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="close-panel" href="settings.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-ios-settings-strong font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>Settings</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a class="close-panel" href="about.html">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-information-circled font23 colorBlue"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span>About</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <!--<li>
                        <a class="open-login-screen" style="width:100%;" href="#">
                            <div class="item-content">
                                <div class="item-media"><i class="ion-log-out font23" style="color:#ff0000;"></i></div>
                                <div class="item-inner">
                                    <div class="item-title label" style="width:100%;">
                                        <span style="color:#ff0000;">Logout</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>-->
                </ul>
            </div>
        </div>
    </div>

    <!-- Right panel with cover effect-->
    <!--<div class="panel panel-right panel-cover">
        <div class="content-block">
            <p>Right panel content goes here</p>
        </div>
    </div>-->

    <script type="text/template7" id="popupaddTemplate">
        <div id="my-form">
            <div class="row" style="padding:30px; padding-top:15px; padding-bottom:0px;">
                <img src="{{@global.imagelocationurlbig}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width: 70%; margin: 0 Auto;">
                <div id="cartExists" style="color:white;padding:7px;background-color:#2196f3;margin-top:-100px; text-align:center; border-radius:5px; width:100%; opacity:0.8;">
                    This item already exists in the cart.
                </div>                
            </div>
            <div id="viewpurchasedhistorydiv" style="margin:5px; text-align:center;width:100%;">
                <a href="#" data-id="{{ProductId}}" class="open-propurhis button button-round active theme-pink">View Purchased History</a>
            </div>
            <div class="row">
                <h3 style="color:#333;margin: 0px 0px 0px 0px; font-weight:bold;">{{Description}}</h3>
            </div>
            <div class="row">
                <h4 style="color:#333;margin: 0px 0px 0px 0px; font-weight:bold;"><small>{{CategoryName}} / SKU ({{SKU}})</small></h4>
            </div>
            <div style="color:green;text-align:center;white-space: normal;margin-top: 5px;">
                {{#js_compare "this.IsDiscounted === 'true'"}}Discounted Item: {{DiscountReason}}{{else}}{{/js_compare}}
            </div>
            <div class="row" style="margin-top: 5px;">
                <div class="col-30" style="padding-top: 10px;display: block;text-align: center;padding-bottom: 20px;">
                    <div class="item-inner">
                        <small class="item-title label" style="font-size:small;">
                            <strong>
                                {{#js_compare "this.CaseQty <= 1"}}
                                Not In Case
                                {{else}}
                                {{CaseQty}} In Case
                                {{/js_compare}}
                            </strong>
                        </small>
                        <div class="item-input">
                            <label class="label label-switch">
                                <input type="checkbox" id="orderSwitchid" onchange="checkValue();" name="orderSwitch" {{#js_compare "this.CaseQty <= 1"}} disabled {{/js_compare}}>
                                <div class="checkbox" style="margin-top: 8px;"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="col-30" style="padding-top: 10px;display: block;padding-bottom: 20px;text-align: center;padding-left: 0px;">
                    <div class="item-inner">
                        <small class="item-title label" style="font-size:small;"><strong>GHRA SRP</strong></small>
                        <div class="item-input" style="color:#EF9B00;font-weight: bold; font-size:medium; margin-bottom: 0px;">
                            ${{SRPrice}}<br /><small>({{SRPer}}%)</small>
                        </div>
                    </div>
                </div>

                <div class="col-40" style="text-align: center;margin-top:10px;padding-bottom: 20px;">
                    <input type="hidden" id="productId" value="{{ProductId}}" name="productId" />
                    <input type="hidden" id="caseQuantity" value="{{CaseQty}}" name="caseQuantity" />
                    <input type="hidden" id="permsrp" value="0" name="permsrp" />
                    <input type="hidden" id="setmsrpper" value="{{perMSRP}}" name="setmsrpper" />
                    <input type="hidden" id="ismsrp" value="{{isMSRP}}" name="ismsrp" />
                    <input type="hidden" id="srpcost" value="{{SRPrice}}" name="srpcost" />
                    <input type="hidden" id="srpper" value="{{SRPer}}" name="srpper" />
                    <input type="hidden" id="productCost" value="{{DPri}}" name="productCost" />
                    <input type="hidden" id="perUnitCost" value="{{UPri}}" name="perUnitCost" />
                    <input type="hidden" id="isdsd" value="{{isDSD}}" name="isdsd" />

                    <div>
                        <small style="color:#007DC6; font-size:small;">
                            Unit&nbsp;
                            <span class="unitpricespan">{{UPri}}</span>
                            {{#js_compare "this.SellPack > 0"}} x {{this.SellPack}}{{/js_compare}}
                        </small>
                    </div>
                    <div style="color:green;font-weight: bold; font-size:x-large; margin-bottom: 0px;">
                        <div> {{#js_compare "this.DFlag === 'R'"}}$<span class="productPrice">{{RegPrice}}</span>{{else}}<small style="color:#DA0000; font-size:small; text-decoration: line-through;">${{RegPrice}}</small>&nbsp;&nbsp;$<span class="productPrice">{{DPri}}</span>{{/js_compare}}</div>
                    </div>
                </div>

                                                                                                                             

            </div>

            <div id="labeldiv" class="row" style="margin-top:5px;display:none;">
                <div class="col-100">
                    <div class="item-content">
                        <div class="item-inner" style="text-align:center;">
                            <div class="item-input">
                                <div class="item-title label" style="font-size:medium;color:#008000;font-weight:bold;"><strong><span id="displaymsrplabel"></span>&nbsp;<span id="showmsrplabel"></span></strong></div>
                                <input type="number" id="sretailid" name="sretail" style="width: 100%;height:40px;font-size: large;font-weight: bold;text-align:center;" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
            <div id="quantitydiv" class="row" style="margin-top:5px;">
                <div class="col-100">
                    <div class="item-content">
                        <div class="item-inner">
                            <div class="item-title label" style="font-size:large;letter-spacing:2px;padding-bottom:2px;"><strong>Select Quantity</strong></div>
                            <div class="item-input">
                                <select id="quantityid" name="quantity" style="width: 100%;height: 40px;font-size: medium;font-weight: bold;padding-left:10px;">                                   
                                </select>
                            </div>
                        </div>
                    </div>
                </div>               
            </div>


            <div id="addtocartdiv" class="row pdTop25">
                <div class="col-50">
                    <a href="#" class="button button-big close-popup">Close</a>
                </div>
                <div class="col-50">
                    <div id="btnaddtocart" class="button button-big form-to-json {{#js_compare "this.InStock === 0"}}button-red disabled{{else}} button-green {{/js_compare}}">{{#js_compare "this.InStock === 0"}}Out Of Stock{{else}} Add to Cart {{/js_compare}}</div>
                </div>
            </div>

            <div id="dsdproductmsg" class="row pdTop25" style="display:none;">
                <div class="col-100" style="color:red;font-size:large;">
                    This product is only for Non-GHRA members. 
                </div>
                <div class="col-100">
                    <a href="#" class="button button-big close-popup">Close</a>
                </div>
            </div>

        </div>
    </script>

    <!-- Product List -->
    <script type="text/template7" id="ProductListTemplate">
        <ul>
            {{#results}}
            <!--<li class="item-content no-padding">
                <div class="item-inner">
                    <a href="#" data-id="{{ProductId}}" class="popupadd">
                        <div class="row no-padding">
                            <div class="" style="padding-left:10px;width:20% !important">
                                <img class="fullWidth" src="{{@global.imagelocationurl}}{{ImageUrl}}" onError="this.src='img/imagemissing.jpg';" style="" />
                            </div>
                            <div class="col-75">
                                <div class="search description">{{Description}}</div>
                                <div class="mrBot5"><small class="no-margin color333">{{Size}}</small><h3 style="color:#EF9B00;font-weight: bold;float:right;" class="no-margin">{{#js_compare "this.SpecialPrice <= 0"}}${{RegPrice}}{{else}}${{SpecialPrice}}{{/js_compare}}</h3></div>
                                <div sstyle="font-size:small;"><span class="{{#js_compare "this.InStock === 0"}}outstock{{else}}instock{{/js_compare}}">{{InStockStatus}}</span>&nbsp;&nbsp;<h4 class="prvPrice no-margin">{{#js_compare "this.SpecialPrice > 0"}}${{RegPrice}}{{else}}{{/js_compare}}</h4></div>
                            </div>
                        </div>
                    </a>
                </div>
            </li>-->
            <li>
                <!--img/products/p4.JPG-->
                <a href="#" data-id="{{ProductId}}" class="popupadd">
                    <div class="item-content">
                        <div class="item-media"><img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" width="70"></div>
                        <div class="item-inner" style="margin-left:15px;">
                            <div class="item-title-row">
                                <h4 class="item-title no-margin search description" style="white-space:normal;overflow:auto;text-overflow:inherit;"><small><strong>{{Description}}</strong></small></h4>
                            </div>
                            <div class="item-subtitle" style="letter-spacing: 1px;">
                                <div class="mrBot5">

                                    <small class="no-margin color333">
                                        <span>SKU:{{SKU}}</span>
                                        <span style="color:#007DC6;float:right;font-size:small;margin-top:4px;">SRP ${{SRPrice}}&nbsp;({{SRPer}}%)</span>
                                    </small>
                                </div>

                                <div sstyle="font-size:small;">

                                    <!--<span class="{{#js_compare "this.InStock === 0"}}outstock{{else}}instock{{/js_compare}}">{{InStockStatus}}</span>-->
                                    <span style="color:#007DC6;font-size:small;margin-top:4px;">
                                        Unit ${{UPri}}{{#js_compare "this.SellPack > 1"}} x {{this.SellPack}}{{/js_compare}}
                                    </span>
                                    <h3 style="color:#EF9B00;font-weight:bold;float:right;" class="no-margin">
                                        <span class="prvPrice" style="font-size:small;font-weight:normal;">
                                            {{#js_compare "this.DFlag !== 'R'"}}${{RegPrice}}{{else}}{{/js_compare}}
                                        </span>
                                        &nbsp;&nbsp;
                                        ${{DPri}}
                                    </h3>

                                </div>

                                <div style="color:green;white-space: normal;">
                                    {{#js_compare "this.IsDiscounted === 'true'"}}Discounted Item: {{DiscountReason}}{{else}}{{/js_compare}}
                                </div>

                            </div>
                        </div>
                    </div>
                </a>
            </li>
            {{/results}}
        </ul>

    </script>

    <!-- Categories List -->
    <script type="text/template7" id="catsubTemplate">
        <ul>
            {{#each category}}
            <li class="accordion-item">
                <a href="#" class="item-content item-link">
                    <div class="item-inner">
                        <div class="item-title">{{Description}}</div>
                    </div>
                </a>
                <div class="accordion-item-content">
                    <div class="content-block">
                        <ul>
                            <li class="allclass">
                                <div class="item-content">
                                    <a href="ProductList.html?id=0&cid={{CategoryId}}&alpha=0" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">All&nbsp;<span style="color:white;">{{Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="alphaclass">
                                <div class="item-content">
                                    <a href="ProductList.html?id=0&cid={{CategoryId}}&alpha=1" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">Items [A - H]&nbsp;<span style="color:white;">{{Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="alphaclass">
                                <div class="item-content">
                                    <a href="ProductList.html?id=0&cid={{CategoryId}}&alpha=2" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">Items [I - Q]&nbsp;<span style="color:white;">{{Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="alphaclass">
                                <div class="item-content">
                                    <a href="ProductList.html?id=0&cid={{CategoryId}}&alpha=3" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">Items [R - Z]&nbsp;<span style="color:white;">{{Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="alphaclass">
                                <div class="item-content">
                                    <a href="ProductList.html?id=0&cid={{CategoryId}}&alpha=4" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">Items [0 - 9]&nbsp;<span style="color:white;">{{Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            {{#each SubCategory}}

                            {{#js_compare "this.CatSubegoryId > 0"}}

                            <li>
                                <div class="item-content">
                                    <a href="ProductList.html?id={{CatSubegoryId}}&cid={{../CategoryId}}&alpha=0" style="width:100%">
                                        <div class="item-inner">
                                            <div class="item-title">{{SubDescription}}&nbsp;<span style="color:white;">{{../Description}}</span></div><i class="fa fa-angle-right"></i>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            {{/js_compare}}

                            {{/each}}
                        </ul>
                    </div>
                </div>
            </li>
            {{/each category}}
        </ul>
    </script>

    <!-- MSRP List -->
    <script type="text/template7" id="msrpTemplate">

        {{#each results}}
        <ul>
            <li class="accordion-item">
                <a href="#" data-id="{{cCategoryId}}" class="item-content item-link item-msrp">
                    <div>
                        <div class="item-title"><strong>{{cDescription}}</strong></div>
                    </div>
                </a>
                <div class="item-content" style="display:none;">
                    <div class="item-inner" style="border:none;">
                        <div class="item-title label" style="width:150px;">MSRP on Labels:</div>
                        <div class="item-input">
                            <label class="label label-switch">
                                <input type="checkbox" data-id="{{cCategoryId}}" class="msrpcheck" {{#js_compare "this.isMSRP === 1"}} checked {{/js_compare}}>
                                <div class="checkbox"></div>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="item-content">
                    <div class="item-inner">
                        <div class="item-title label" style="width:150px;">Set MSRP %: <strong>(<span id="msrpoutput{{cCategoryId}}">{{perMSRP}}</span>)</strong></div>
                        <div class="item-input">
                            <div class="range-slider">
                                <input class="msrpslider" data-id="{{cCategoryId}}" id="rangeInput" type="range" min="0" max="100" value="{{perMSRP}}" step="1">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item-content" id="subitems{{cCategoryId}}">
                </div>

            </li>
        </ul>
        {{/each results}}

    </script>

    <!-- Sub CAT List -->
    <script type="text/template7" id="subcatTemplate">
        <div class="content-block">
            <ul>
                {{#each results}}


                <li>
                    <div class="item-content">

                        <div class="item-inner">
                            <div class="item-title">{{Description}}</div>
                        </div>

                    </div>
                </li>


                {{/each results}}
            </ul>
        </div>

    </script>

    <!-- Cart Temp -->
    <script type="text/template7" id="cartTemplate">
        {{#results}}
        <!--<a name="cartdivID}}"></a>-->
        <div class="content-block" style="margin:0px;padding:5px 0px 10px 0px; border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: nowrap; overflow:hidden; display:block;">{{Description}}</h3>
                <small>{{Size}} / {{CategoryName}}</small>
            </div>
            <div class="row no-gutter">
                <div class="col-25" style="vertical-align:bottom;">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:90%;"><br />
                    <button data-id="{{ID}}" class="button color-red itemRemove" style="margin:0; margin-top:10px;">Remove</button>
                </div>
                <h3 class="col-33" style="margin:0;padding:0;padding-top:10px;font-weight:normal;padding-left:5px;">
                    <small>
                        SKU {{SKU}}
                        <br />
                        Unit ${{UPri}}{{#js_compare "this.SellPack > 1"}} x {{this.SellPack}}{{/js_compare}}
                        <br />
                        SRP ${{SRPrice}}
                        <br />
                        SRP ({{SRPer}}%)
                        <br />
                        {{#js_compare "this.Bulky === 1"}}<span style="color:#ff0000;">*Limited Quantity</span>{{/js_compare}}
                    </small>
                </h3>
                <div class="col-40">

                    <div class="item-input" style="padding-top:0px; text-align:right;">
                        <strong>Units:</strong>&nbsp;<input id="cartQty{{ID}}" class="cartQty" required maxlength="5" type="number" data-id="{{ID}}" value="{{Quantity}}" style="height:25px; width:65px; padding-right:2px; font-size:large; text-align:right;" />

                    </div>
                    <h3 style="margin:0px;padding:0px;padding-top:4px; text-align:right;">
                        x&nbsp;&nbsp;${{CurrentPrice}}
                    </h3>
                    <h2 style="margin:0px;padding:0px;padding-top:0px;text-align:right; color:#007DC6;">
                        <small> ${{TotalItemPrice}}</small>
                    </h2>
                    <button data-id="{{ID}}" class="col-100 button button-small updateQty" style="margin-top:3px;">Update</button>
                </div>
            </div>

        </div>
        {{/results}}
    </script>

    <!-- Label Temp -->
    <script type="text/template7" id="labelTemplate">
        {{#results}}
        <div class="content-block contentblocklbl" style="margin:0px;padding:0px;padding-bottom:10px;padding-top:5px;border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: nowrap; overflow:hidden; display:block;">{{Description}}</h3>
                <small>{{Size}} / {{CategoryName}}</small>
            </div>
            <div class="row">
                <div class="col-25">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:75px;"><br />
                    <a href="#" class="button color-red labelRemove" data-id="{{ID}}" style="margin:0px;padding:0px;">Remove</a>
                </div>
                <div class="col-75" style="padding-left:7px;">
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal;">
                        <small><strong>SKU: {{SKU}}</strong></small>
                    </h3>
                    <!--<h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal;">
                        <small><strong>{{Size}}</strong></small>
                    </h3>-->
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal; color:#EF9B00;">
                        <small>Current Price&nbsp;&nbsp;<strong>${{CurrentPrice}}</strong></small>
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal; color:#ff3b30;">
                        <small>Unit Price&nbsp;&nbsp;<strong>${{UPri}}{{#js_compare "this.SellPack > 1"}} x {{this.SellPack}}{{/js_compare}}</strong></small>
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal; color:#007DC6;">
                        <small>SRP&nbsp;&nbsp;<strong>${{SRPrice}}&nbsp;({{SRPer}}%)</strong></small>
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal; color:#008000;">
                        <small>Label Price&nbsp;&nbsp;<strong>{{#js_compare "this.LabelPrice > 0"}}${{LabelPrice}}&nbsp;({{MarginLabel}}%){{else}}No MSRP{{/js_compare}}</strong></small>
                    </h3>
                </div>

            </div>

        </div>
        {{/results}}


    </script>

    <!-- Returns Temp -->
    <script type="text/template7" id="returnTemplate">
        {{#results}}
        <div class="content-block contentblocklbl" style="margin:0px;padding:0px;padding-bottom:10px;padding-top:5px;border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: nowrap; overflow:hidden; display:block;">{{Description}}</h3>
                <small>{{Size}} / {{CategoryName}}</small>
            </div>
            <div class="row">
                <div class="col-25">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:75px;"><br />
                    <a href="#" class="button color-red returnsRemove" data-value="{{Quantity}}" data-id="{{ID}}" style="margin:0px;padding:0px;">Remove</a>
                </div>
                <div class="col-75" style="padding-left:7px;font-size:medium;">
                    <h3 style="margin:0;padding:0;padding-top:0; text-align:left;font-weight:normal;">
                        <small><strong>SKU: {{SKU}}</strong></small>
                    </h3>
                    <h3 style="margin:0;padding:0;padding-top:0; text-align:left;font-weight:normal; color:#007DC6;">
                        <small>Order Id&nbsp;&nbsp;<strong>{{MarginLabel}}</strong></small>
                    </h3>
                    <h3 style="margin:0;padding:0;padding-top:0; text-align:left;font-weight:normal; color:#EF9B00;">
                        <small>Ordered Price&nbsp;&nbsp;<strong>${{LabelPrice}}</strong></small>
                    </h3>
                    <h3 style="margin:0;padding:0;padding-top:0; text-align:left;font-weight:normal; color:#ff3b30;">
                        <small>Quantity&nbsp;&nbsp;<strong>{{Quantity}}</strong></small>
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:0px; text-align:left;font-weight:normal; color:#008000;">
                        <small>Total&nbsp;&nbsp;<strong>$<span class="returntotalspan">{{js "this.Quantity * this.LabelPrice"}}</span></strong></small>
                    </h3>
                </div>
            </div>

        </div>
        {{/results}}


    </script>

    <!-- Announcement -->
    <script type="text/template7" id="announceTemplate">
        {{#results}}
        <div class="card">
            <div class="card-header cardHeader">{{NewsTitle}}</div>
            <div class="card-footer cardFooter">{{StartDate}}<span style="float:right;" class="closeannpopup"><a href="#" class="close-popup button button-fill color-red button-round" style="letter-spacing:2px;">Close</a></span></div>
            <div class="card-content">
                {{#js_compare "this.ImageUrl != ''"}}
                <img src="{{ImageUrl}}" onError="this.src='img/imagemissing.jpg';" class="fullWidth" />
                {{/js_compare}}
                <div class="card-content-inner">{{NewsDescription}}</div>
            </div>
        </div>
        {{/results}}
    </script>




    <!-- Recent Promotions -->
    <script type="text/template7" id="promotionsTemplate">
        <ul>
            {{#results}}

            <li>
                <a href="promotion-details.html?id={{BatchId}}" class="item-link item-content">
                    <div class="item-inner">

                        <div class="row">
                            <div class="col-70">
                                <strong style="color:green;">Total Items: {{TotalQuanity}}</strong>
                            </div>
                            <div class="col-30" style="text-align:right">
                                <span class="badge bg-green">&nbsp;${{TotalAmount}}&nbsp;</span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-60">
                                <strong style="color:blue;">Accepted Items: {{UserQuanity}}</strong>
                            </div>
                            <div class="col-40" style="text-align:right">
                                <span class="badge bg-blue">&nbsp;${{UserAmount}}&nbsp;</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-100">
                                Expiration Date<br />
                                {{ExpDate}}
                            </div>
                        </div>
                    </div>
                </a>
            </li>
            {{/results}}
        </ul>
    </script>

    <!-- Promotion Detail -->
    <script type="text/template7" id="promotionDetailTemplate">
        <ul>
            {{#results}}
            <li>
                <!--img/products/p4.JPG-->
                <div class="item-content">
                    <div class="item-media">
                        <img src="{{@global.imagelocationurl}}{{ImageUrl}}" onError="this.src='img/imagemissing.jpg';" width="50">
                    </div>
                    <div class="item-inner" style="margin-left:15px">
                        <div class="item-title-row">
                            <h4 class="item-title no-margin"><small><strong>{{ProdDescription}}</strong> </small> </h4>
                        </div>
                        <div class="item-subtitle" style="letter-spacing: 1px;">
                            <div>
                                Item Price: ${{Price}}
                            </div>
                            <div style="color:green">Quantity: {{Quanity}}</div>
                            <div style="color:green">Total: ${{TotalPrice}}</div>
                            <div style="color:blue">Accepted Quantity: <span data-id="{{Id}}" class="UserQtyText">{{UserQuanity}}</span></div>
                            <div style="color:blue">Accepted Total: $<span data-id="{{Id}}" class="UserTotalText">{{UserTotal}}</span></div>
                        </div>

                        {{#js_compare "this.BatchEnforce !== 1"}}
                        <div>
                            <span style="display:inline;float:left;margin-right:7px;">
                                <select data-id="{{Id}}" class="promoacceptqty" style="width:auto;height:30px;font-size: small;color:#333; padding-right:10px;padding-left:10px;border:solid 1px #ccc;border-radius:5px;">
                                    {{#each QtyList}}
                                    <option value="{{this}}">{{this}}</option>
                                    {{/each QtyList}}
                                </select>
                            </span>
                            <span>
                                <button data-id="{{Id}}" data-batchid="{{BatchId}}" data-price="{{Price}}" class="button color-blue acceptQty" style="margin:0; margin-top:7px;font-size:small;">Accept</button>
                            </span>
                        </div>
                        {{/js_compare}}


                    </div>
                </div>
            </li>
            {{/results}}
        </ul>
    </script>


    <!-- Order History -->
    <script type="text/template7" id="orderHistoryTemplate">
        <ul>
            {{#results}}

            <li>
                <a href="order-historyDetail.html?id={{OrderId}}" class="item-link item-content">
                    <div class="item-inner">
                        <div class="item-title-row">
                            <div class="item-title">
                                <strong style="color:green;">Status: {{OrdDescritpion}}</strong>
                                <br />{{#js_compare "this.RoyalId === '0'"}}{{else}}Order# {{RoyalId}}<br />{{/js_compare}}{{OrderDate}}
                            </div>
                            <div class="item-after">
                                <span style="color:#ff3b30;text-decoration:line-through;">{{#js_compare "this.OrderTotal > 0"}}${{oldTotal}}{{/js_compare}}</span>&nbsp;&nbsp;<span class="badge bg-green">&nbsp;{{#js_compare "this.OrderTotal > 0"}}${{OrderTotal}}{{else}}${{oldTotal}}{{/js_compare}}&nbsp;</span>
                            </div>
                        </div>
                        <div class="item-text" style="height:auto;font-weight:bold;color:red;font-size:small;">
                            {{OdrMsg}}
                        </div>
                    </div>
                </a>
            </li>
            {{/results}}
        </ul>
    </script>

    <!-- Order History Detail -->
    <script type="text/template7" id="orderHistoryDetailTemplate">

        <ul>
            {{#results}}
            <li>
                <!--img/products/p4.JPG-->
                <div class="item-content" {{#js_compare "this.IsTobPromotion === 1"}} style="background-color: #ccc;" {{/js_compare}}>
                    <div class="item-media">
                        <img src="{{@global.imagelocationurl}}{{ImageUrl}}" onError="this.src='img/imagemissing.jpg';" width="50">
                    </div>
                    <div class="item-inner" style="margin-left:15px">
                        <div class="item-title-row">
                            <h4 class="item-title no-margin"><small><strong>{{Desc}}</strong> </small> </h4>
                        </div>
                        <div class="item-subtitle" style="letter-spacing: 1px;">

                            <div>
                                Item Price: ${{UnitPrice}}
                            </div>
                            <div>Quantity: {{Qty}}&nbsp;&nbsp;{{#js_compare "this.QtyStatus != 0"}}<span style="color:#ff3b30;text-decoration:line-through;">{{oldQty}}</span>{{/js_compare}}</div>
                            <div>Total: ${{Price}}&nbsp;&nbsp;<span style="color:#ff3b30;text-decoration:line-through;">{{#js_compare "this.QtyStatus != 0"}}${{OldPrice}}</span>{{/js_compare}}</div>
                        </div>
                        {{#js_compare "this.Edit === 'Y' && this.IsTobPromotion === 0"}}
                        <div>
                            <span>
                                <button data-id="{{PId}}" data-orderid="{{NOrderID}}" class="button color-red itemRemoveOrder" style="margin:0; margin-top:7px;font-size:small;">Remove Item</button>
                            </span>
                        </div>
                        {{/js_compare}}
                        {{#js_compare "this.Return === 'Y' && this.IsReturnable === 1"}}
                        <div>
                            <span style="display:inline;float:left;margin-right:7px;">
                                <select data-id="{{PId}}" class="returnqty" style="width:auto;height:30px;font-size: small;color:#333; padding-right:10px;padding-left:10px;border:solid 1px #ccc;border-radius:5px;">
                                    {{#each QtyList}}
                                    <option value="{{this}}">{{this}}</option>
                                    {{/each QtyList}}
                                </select>
                            </span>
                            <span>
                                <button data-id="{{PId}}" data-orderid="{{OrderID}}" data-price="{{UnitPrice}}" class="button color-red itemReturn" style="margin:0; margin-top:7px;font-size:small;">Return</button>
                            </span>
                        </div>
                        {{/js_compare}}
                    </div>
                </div>
            </li>
            {{/results}}
        </ul>
    </script>

    <!-- Order History Detail -->
    <script type="text/template7" id="lastOrderDetailTemplate">
        {{#results}}
        <div class="content-block" style="margin:0px;padding:5px 0px 10px 0px; border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: nowrap; overflow:hidden; display:block;">{{Description}}</h3>
                <small>{{CategoryName}} / {{Size}}</small>
            </div>
            <div class="row no-gutter">
                <div class="col-25">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:75px;"><br />
                </div>
                <h3 class="col-33" style="margin:0px;padding:0px;padding-top:10px;font-weight:normal;">
                    <small>
                        SKU: {{SKU}}<br />
                        SRP: ${{UPri}}<br />
                        Unit: {{SRPrice}} ({{SRPer}}%)
                    </small>
                </h3>
                <div class="col-40">

                    <h3 class="item-input" style="margin:0px;padding:0px;padding-top:4px;text-align:right;">
                        Qtys:&nbsp;&nbsp;{{Quantity}}
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:4px; text-align:right;">
                        x&nbsp;&nbsp;${{CurrentPrice}}
                    </h3>
                    <h2 style="margin:0px;padding:0px;padding-top:0px;text-align:right; color:#007DC6;">
                        <small> ${{TotalItemPrice}}</small>
                    </h2>
                </div>
            </div>

        </div>
        {{/results}}
    </script>

    <!-- Edit Order Cart -->
    <script type="text/template7" id="editOrderDetailTemplate">
        <h3 style="text-align:center;">
            Below items are coming from your current cart, please select all the items that you want to add into order# <span id="editorderspan"></span>.
        </h3>
        <div class="row" style="margin-bottom:7px;">
            <div class="col-75">
                <div id="edittocart" style="text-transform: uppercase; letter-spacing: 2px; font-weight: bold;" class="button button-big button-green">Add items</div>
            </div>
            <div class="col-25">
                <a href="#" class="button button-big color-red close-popup">Close</a>
            </div>
            <div class="col-100" style="margin-top:5px;">
                <div id="edittocartall" style="text-transform: uppercase; letter-spacing: 2px; font-weight: bold;" class="button button-big button-fill color-yellow">Add All Cart Items</div>
            </div>
        </div>

        <!--<div id="itemTypeWarning" style="padding:5px;background-color:red;color:white;display:none;">

        </div>-->
        {{#results}}
        <div class="content-block" style="margin:0px;padding:5px 0px 10px 0px; border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: nowrap; overflow:hidden; display:block;">{{Description}}</h3>
                <small>{{CategoryName}}&nbsp;/&nbsp;SKU: {{SKU}}</small>
            </div>
            <div class="row no-gutter">
                <h3 class="col-35" style="margin:0px;padding:0px;padding-top:10px;font-weight:normal;">
                    <button data-id="{{ID}}" class="editorderbtn button buttonselect" style="margin:0; margin-top:10px;">Select</button>
                </h3>
                <div class="col-25">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:75px;"><br />
                </div>
                <div class="col-40">

                    <h3 class="item-input" style="margin:0px;padding:0px;padding-top:4px;text-align:right;">
                        Units:&nbsp;&nbsp;{{Quantity}}
                    </h3>
                    <h3 style="margin:0px;padding:0px;padding-top:4px; text-align:right;">
                        x&nbsp;&nbsp;${{CurrentPrice}}
                    </h3>
                    <h2 style="margin:0px;padding:0px;padding-top:0px;text-align:right; color:#007DC6;">
                        <small> ${{TotalItemPrice}}</small>
                    </h2>
                </div>
            </div>

        </div>
        {{/results}}
    </script>

    <!-- Order Pallet -->
    <script type="text/template7" id="OrderPalletTemplate">
        <h1 style="text-align:center;border-bottom:solid 1px #777">
            Order Pallets
        </h1>
        <div class="row" style="margin-bottom:7px;">
            <div class="col-75">
                <div id="palletordertocart" style="text-transform: uppercase; letter-spacing: 2px; font-weight: bold;" class="button button-big button-green">Submit Order</div>
            </div>
            <div class="col-25">
                <a href="#" class="button button-big color-red close-popup">Close</a>
            </div>
        </div>

        <!--<div id="itemTypeWarning" style="padding:5px;background-color:red;color:white;display:none;">

        </div>-->
        {{#results}}
        <div class="content-block" style="margin:0px;padding:5px 0px 10px 0px; border-bottom:solid 1px #ccc;">
            <div class="row" style="margin-bottom:5px;">
                <h3 class="col-100" style="margin:0px;padding:0px;padding-bottom:3px; text-overflow:ellipsis;  white-space: normal; overflow:auto; display:block;">{{Description}}</h3>
                <small>{{CategoryName}}&nbsp;/&nbsp;SKU: {{SKU}}</small>
            </div>
            <div class="row no-gutter">
                <div class="col-40">
                    <img src="{{@global.imagelocationurl}}{{SKU}}.jpg" onError="this.src='img/imagemissing.jpg';" style="width:75px;"><br />
                </div>
                
                <div class="col-60" style="text-align:right;">
                    <div>SRP ${{SRPrice}}&nbsp;({{SRPer}}%)</div>
                    <h3 class="item-input" style="margin:0px;padding:0px;padding-top:4px;text-align:right;">
                        Unit ${{UPri}}{{#js_compare "this.SellPack > 1"}} x {{this.SellPack}}{{/js_compare}}
                    </h3>
                    <h2 style="margin:0px;padding:0px;padding-top:4px; text-align:right;color:green;">
                        ${{DPri}}
                    </h2>
                    <div class="prvPrice" style="font-size:small;font-weight:normal;">
                        {{#js_compare "this.DFlag !== 'R'"}}${{RegPrice}}{{else}}{{/js_compare}}
                    </div>
                </div>
            </div>
            <div class="row no-gutter">
                <button data-id="{{ProductId}}" class="orderpalletbtn fullWidth button buttonselect" style="margin:0; margin-top:10px;">Select</button>
            </div>
        </div>
        {{/results}}
    </script>

    <!-- Views -->
    <div class="views">
        <!-- Your main view, should have "view-main" class-->
        <div class="view view-main">
            <!-- Top Navbar-->
            <div class="navbar">
                <div class="navbar-inner">
                    <!-- We have home navbar without left link-->
                    <div class="center sliding">GHRA</div>
                    <div class="right">
                        <!-- Right link contains only icon - additional "icon-only" class--><a href="#" class="link icon-only open-panel"> <i class="icon icon-bars"></i></a>
                    </div>
                </div>
            </div>
            <!-- Pages, because we need fixed-through navbar and toolbar, it has additional appropriate classes-->
            <div class="pages navbar-through toolbar-through">
                <!-- Page, data-page contains page name-->
                <div data-page="index" class="page">

                    <!-- Scrollable page content-->
                    <div class="page-content">

                        <div><ul class="ulNobullet boxShadow"><li class="divider"><strong id="companyName"></strong>&nbsp;(<span id="accountNo"></span>) <br />Delivery Day: <span id="deliveryDayTop"></span></li></ul></div>
                        <div class="row">
                            <a href="ProductList.html?id=0&cid=0&alpha=0&ptype=P" style="margin-bottom:-5px;"><img src="img/banners/promotions.jpg" class="fullWidth" /></a>
                            <a href="ProductList.html?id=0&cid=0&alpha=0&ptype=N" style="margin-bottom:-5px;"><img src="img/banners/NewArrivals.jpg" class="fullWidth" /></a>
                            <a href="ProductList.html?id=0&cid=0&alpha=0&ptype=F" style="margin-bottom:-5px;"><img src="img/banners/feature.jpg" class="fullWidth" /></a>
                        </div>
                        <div class="content-block" style="margin-top: 19px; margin-bottom: 0px;">
                            <div class="row">
                                <div class="col-33"><a href="products.html?ObjectType=A" id="product"><img src="img/icons/products.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><a href="promotion.html"><img src="img/icons/promotion.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><a href="ProductList.html?id=0&cid=0&alpha=0&ptype=D" data-popup=".popup-about"><img src="img/icons/disscountedItem.png" class="pdBottom25 fullWidth" /></a></div>
                            </div>
                            <div class="row">
                                <div class="col-33"><a href="setmsrp.html"><img src="img/icons/labels.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><a href="quick-scan.html?type=lbl"><img src="img/icons/printLabel.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><span id="OrderPallets"><img src="img/icons/palletizedOrder.png" class="pdBottom25 fullWidth" /></span></div>
                            </div>
                            <div class="row">
                                <div class="col-33"><a href="announcement.html"><img src="img/icons/announcement.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><a href="order-history.html"><img src="img/icons/orderHistory.png" class="pdBottom25 fullWidth" /></a></div>
                                <div class="col-33"><a href="settings.html"><img src="img/icons/settings.png" class="pdBottom25 fullWidth" /></a></div>
                                <!--<div class="col-33"><a href="view-cart.html"><img src="img/icons/viewCart.png" class="pdBottom25 fullWidth" /></a></div>-->
                                <!--<div class="col-33"><a href="quick-scan.html"><img src="img/icons/quickScan.png" class="pdBottom25 fullWidth" /></a></div>-->
                                
                            </div>
                            <!--<div class="row">
                                <div class="col-33"><a href="#"><img src="img/icons/logout.png" class="pdBottom25 fullWidth open-login-screen" /></a></div>
                                <div class="col-33"></div>
                                <div class="col-33"></div>
                            </div>-->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Toolbar-->
            <div class="toolbar">
                <div class="toolbar-inner">
                    <a id="toolhome" href="index.html" class="link">
                        <i class="ion-ios-home toolbarIcon"></i>
                    </a>
                    <a id="toolsearch" href="search.html" class="link">
                        <i class="ion-ios-search-strong toolbarIcon"></i>
                    </a>
                    <a id="toolquickscan" href="quick-scan.html" class="link">
                        <i class="ion-ios-barcode-outline toolbarIcon"></i>
                    </a>
                    <!--<h4><i class="ion-android-sync"></i>&nbsp;<small id="lastupdate"></small></h4>-->

                    <a id="toolcart" href="view-cart.html" class="link"> <i class="icon ion-ios-cart toolbarIcon"><span class="badge bg-red" style="margin-left:-33px;top: 5px;" id="itemQty">0</span></i></a>
                    <!--<a href="view-cart.html" class="link">
                        <i class="ion-ios-cart-outline toolbarIcon"><span class="badge bg-red">4</span></i>
                    </a>-->
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Add To cart-->
    <div class="popup popup-add" style="background: rgba(255, 255, 255, 1); height:100%;">
        <div class="content-block no-margin" style="overflow:hidden;" id="popupaddContent">

        </div>
    </div>

    <!-- Popup Edit To cart-->
    <div class="popup popup-edit" style="background: rgba(255, 255, 255, 1); height:100%;">
        <div class="content-block" id="editorderDetail">

        </div>
    </div>

    <!-- Popup for pallets-->
    <div class="popup popup-pallet" style="background: rgba(255, 255, 255, 1); height:100%;">
        <div class="content-block" id="palletorders">

        </div>
    </div>

    <div class="popup popup-notfound" style="background: rgba(255, 255, 255, 1);">
        <div class="content-block-title" style="text-align:center;"><h3>UPC/SKU:&nbsp;<span id="scantextval"></span></h3></div>
        <div class="content-block" style="text-align:center;">
            <img src="img/barcodeitemnotfound.jpg" style="width:65%;" />
        </div>
        <p style="margin:15px;"><a href="#" class="button button-big button-red close-popup">Try Again!</a></p>
    </div>

    <!-- Calendar Popup -->
    <div class="popup popup-calendar">
        <div class="content-block-title" style="text-align:center;"><h2>Calendar</h2></div>
        <div class="content-block">
            <div style="padding:0; margin-right:-15px; width:auto" class="content-block-inner">
                <div id="calendar-inline-container"></div>
            </div>
        </div>
        <p style="margin:15px;"><a href="#" class="button button-big button-fill close-popup">Close Calendar</a></p>
    </div>

    <!-- Calculator Popup -->
    <div class="popup popup-calculator">
        <div class="content-block-title" style="text-align:center;"><h2>Calculator<br /><small><a href="#" class="close-popup" style="text-transform:lowercase;font-weight:normal;">(close)</a></small></h2></div>
        <div class="list-block">
            <ul>
                <li>
                    <div class="item-content">
                        <div class="item-inner">
                            <div class="item-input" style="height:40px;font-size:medium;font-weight:bold;">
                                <input type="text" placeholder="Enter number" readonly="readonly" id="demo-calculator" />
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Loging Screen -->
    <div class="login-screen">
        <div class="view">
            <div class="page">
                <div class="page-content login-screen-content">
                    <div class="login-screen-title"><img src="img/log.png" style="width:65%;" /></div>
                    <form id="signinform">
                        <div class="list-block">
                            <ul>
                                <li class="item-content">
                                    <div class="item-inner">
                                        <i class="ion-ios-person font23"></i><div class="item-title label">&nbsp;&nbsp;Username:</div>
                                        <div class="item-input">
                                            <input type="text" name="username" placeholder="Your username" id="username" tabindex="1" required>
                                        </div>
                                    </div>
                                </li>
                                <li class="item-content">
                                    <div class="item-inner">
                                        <i class="ion-ios-locked font23"></i><div class="item-title label">&nbsp;&nbsp;Password:</div>
                                        <div class="item-input">
                                            <input type="password" name="password" placeholder="Your password" id="password" tabindex="2" required>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="list-block" style="margin:15px;max-width:100%;">
                            <input id="signin" type="submit" class="button button-big button-fill mrLR no-margin" value="Login" />
                            <div class="list-block-label">
                                <p>Version 2.5.2</p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Product History-->
    <div class="picker-modal picker-producthistory" style="height:auto;">
        <div class="toolbar" style="background-color:#ccc;">
            <div class="toolbar-inner">
                <div class="left">Product Purchased History</div>
                <div class="right"><a href="#" id="closeprohis" class="close-picker button button-fill color-red button-round" style="letter-spacing:2px;">Close</a></div>
            </div>
        </div>
        <div class="picker-modal-inner" style="height:auto;">
            <div class="content-block" style="margin:1px;padding:0;">
                <div id="propurchasedhistorycontent" class="list-block" style="margin:0;">
                </div>
            </div>
        </div>
    </div>

    <!-- Product History Template-->
    <script type="text/template7" id="prohistoryTemplate">
        <ul>
            {{#each results}}
            <li class="item-content">
                <div class="item-inner">
                    <div class="item-title">{{OrderDate}}</div>
                    <div class="item-after"><span class="badge">{{Qty}}</span></div>
                </div>
            </li>
            {{/each results}}
        </ul>
    </script>

    <div class="popup popup-annoucement">
        <div class="view">
            <div class="page">
                <div id="announcementContentpop" class="page-content">
                </div>
            </div>
        </div>
    </div>
    <div class="popup popup-version">
        <div class="view">
            <div class="page">
                <div class="page-content">
                    <div class="list-block">

                        <div style="text-align:center;">
                            <h2 style="margin-bottom:0;">GHRA APP UPDATE!!!</h2>
                        </div>
                        <div class="item-content">
                            <div class="item-inner">
                                <p style="font-size:x-large;">This device is running an older version of the GHRA app, please download the latest version of the GHRA app from the market place. </p>
                            </div>
                        </div>
                        <div class="item-inner" style="width:100%;">
                            <a id="storelinkgoogle" href="" onclick="openMarket('android')" style="width:inherit;display:none;">
                                <img src="img/google-play-badge.png" alt="" style="width:inherit;" />
                            </a>
                            <a id="storelinkapple" href="" onclick="openMarket('ios')" style="width:inherit;display:none;">
                                <img src="img/app-store-badge.png" alt="" style="width:inherit;" />
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- User Info Screen -->
    <div class="popup popup-services">
        <div class="view">
            <div class="page">
                <div class="page-content">
                    <div class="login-screen-title">
                        <p class="font23">Communication Preferences</p>
                        <p style="font-size:medium; text-align:left; padding:15px;">Enter your email address and mobile number to receive notifications and updates.</p>
                    </div>
                    <div class="list-block">
                        <ul>
                            <li class="item-content">
                                <div class="item-inner">
                                    <i class="ion-ios-telephone font23"></i><div class="label" style="width:30%;">&nbsp;&nbsp;Phone:</div>
                                    <div class="item-input">
                                        <input type="number" name="Phone Number" placeholder="Phone Number" id="mobileNumber" tabindex="1" required>
                                    </div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <i class="ion-ios-email font23"></i><div class="label" style="width:30%;">&nbsp;&nbsp;Email:</div>
                                    <div class="item-input">
                                        <input type="email" name="Email" placeholder="Email Address" id="emailAddress" tabindex="2" required>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="item-content" style="margin:15px;">
                        <div class="item-inner">
                            <button id="userInfoSubmit" class="button button-big button-fill no-margin fullWidth">Save</button>
                            <button class="button button-big fullWidth close-popup" style="margin-top:20px;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="cordova.js"></script>
    <script type="text/javascript" src="js/framework7.min.js"></script>
    <script src="js/template7.min.js"></script>
    <script type="text/javascript" src="js/framework7.upscroller.min.js"></script>
    <script type="text/javascript" src="js/framework7.keypad.min.js"></script>
    <script src="js/toast.js"></script>
    <script>

        //Global Var
        var appCompanyId = 1;
        var db;
        var serverdate;
        var lastrundatetime;
        var isAndroid = Framework7.prototype.device.android === true;
        var isIos = Framework7.prototype.device.ios === true;
        var deviceType = Framework7.prototype.device;
        var barcodetext = "";
        var dbsync;
        var oprnscaner = 0;
        var productselecttype = "A";
        var scantextid = "";
        var hdorderid = 0;
        var editDeliveryId = 0;
        var AddItemCart = [];
        var editItemCart = [];
        var palletItemCart = [];
        var isOnResume = true;
        var isLblScan = false;
        //Version Number assign staticly ...
        var versionnumber = 4;

        // Export selectors engine
        var $$ = Dom7;

        // Initialize your app
        var myApp = new Framework7({
            precompileTemplates: true,
            swipeBackPage: false,
            modalTitle: 'GHRA',
            scrollTopOnStatusbarClick: true,
            animateNavBackIcon: true
        });

        // Calculator
        var calculator = myApp.keypad({
            input: '#demo-calculator',
            type: 'calculator',
            toolbar: false
        });


        //zBar-Barcode Scanner

        var zBarSetting = {
            text_title: "GHRA", // Android only
            text_instructions: "", // Android Only
            camera: "back", // Either "front" or "back"
            flash: "off", // defaults to "auto"
            drawSight: false //defaults to true, create a red sight/line in the center of the scanner view.
        };

        //Toast
        var toast = myApp.toast('', '', {});

        //Templates
        var catTemplate = $$('script#catsubTemplate').html();
        var compiledcatTemplate = Template7.compile(catTemplate);

        var subcatTemplate = $$('script#subcatTemplate').html();
        var compiledsubcatTemplate = Template7.compile(subcatTemplate);

        var productTemplate = $$('script#ProductListTemplate').html();
        var compiledproductTemplate = Template7.compile(productTemplate);

        var announceTemplate = $$('script#announceTemplate').html();
        var compiledannounceTemplate = Template7.compile(announceTemplate);

        var orderHistoryTemplate = $$('script#orderHistoryTemplate').html();
        var compiledorderHistoryTemplate = Template7.compile(orderHistoryTemplate);

        var promotionsTemplate = $$('script#promotionsTemplate').html();
        var compiledpromotionsTemplate = Template7.compile(promotionsTemplate);

        var orderHistoryDetailTemplate = $$('script#orderHistoryDetailTemplate').html();
        var compiledorderHistoryDetailTemplate = Template7.compile(orderHistoryDetailTemplate);

        var promotionDetailTemplate = $$('script#promotionDetailTemplate').html();
        var compiledpromotionDetailTemplate = Template7.compile(promotionDetailTemplate);

        var lastOrderDetailTemplate = $$('script#lastOrderDetailTemplate').html();
        var compiledlastOrderDetailTemplate = Template7.compile(lastOrderDetailTemplate);

        var editOrderDetailTemplate = $$('script#editOrderDetailTemplate').html();
        var compilededitOrderDetailTemplate = Template7.compile(editOrderDetailTemplate);

        var OrderPalletTemplate = $$('script#OrderPalletTemplate').html();
        var compiledOrderPalletTemplate = Template7.compile(OrderPalletTemplate);

        var prohistoryTemplate = $$('script#prohistoryTemplate').html();
        var compiledprohistoryTemplate = Template7.compile(prohistoryTemplate);

        // Add view
        var mainView = myApp.addView('.view-main', {
            dynamicNavbar: true
        });

        //Calendar
        var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        //Page Calendar
        var calendarInline = myApp.calendar({
            container: '#calendar-inline-container',
            value: [new Date()],
            weekHeader: false,
            toolbarTemplate:
				'<div class="toolbar calendar-custom-toolbar">' +
					'<div class="toolbar-inner">' +
						'<div class="left">' +
							'<a href="#" class="link icon-only"><i class="icon icon-back"></i></a>' +
						'</div>' +
						'<div class="center"></div>' +
						'<div class="right">' +
							'<a href="#" class="link icon-only"><i class="icon icon-forward"></i></a>' +
						'</div>' +
					'</div>' +
				'</div>',
            onOpen: function (p) {
                $$('.calendar-custom-toolbar .center').text(monthNames[p.currentMonth] + ', ' + p.currentYear);
                $$('.calendar-custom-toolbar .left .link').on('touchstart', function () {
                    calendarInline.prevMonth();
                });
                $$('.calendar-custom-toolbar .right .link').on('touchstart', function () {
                    calendarInline.nextMonth();
                });
            },
            onMonthYearChangeStart: function (p) {
                $$('.calendar-custom-toolbar .center').text(monthNames[p.currentMonth] + ', ' + p.currentYear);
            }
        });

        //Page index
        myApp.onPageInit('index', function (page) {
            $$('#companyName').html(localStorage.companyName);
            $$('#accountNo').html(localStorage.userName);
            $$('#deliveryDayTop').html(localStorage.deliveryDay);
            isOnResume = true;
        });

        $$(document).on('pageAfterAnimation', '.page[data-page="quickscan"]', function (e) {
            $$('#scantext').focus();
        });

        //Page About
        myApp.onPageInit('about', function (page) {
            $$('#copyYear').html(new Date().getFullYear());
            try {
                db.transaction(function (tx) {
                    tx.executeSql('SELECT ShortName, CompanyUrl, FullCompany, CompanyAddress, CompanyPhoneNumber, Email, Fax,CompanyHours, StorePolicy FROM ServerDate', [], function (tx, results) {
                        var serverResult = results.rows.item(0);
                        $$('#storePolicy').html(serverResult.StorePolicy);
                        $$('#companyLongName').html(serverResult.FullCompany);
                        $$('#companyShortName').html(serverResult.ShortName);
                        $$('#companyAddress').html(serverResult.CompanyAddress);
                        $$('#companyPhone').html(serverResult.CompanyPhoneNumber);
                        $$('#companyFax').html(serverResult.Fax);
                        $$('#companyEmail').html(serverResult.Email);
                        $$('#companyTime').html(serverResult.CompanyHours);
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "CompanyInfo - SelectSQL");
					}, null);
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "About - Page");
            }

        });

        //Page setMsrp
        myApp.onPageInit('setmsrp', function (page) {
            isOnResume = true;
            try {

                db.transaction(function (tx) {
                    var MSRPItems = [];

                    tx.executeSql('select c.CategoryId as cCategoryId, c.Description as cDescription, case when m.isMSRP is null then 0 else m.isMSRP end As isMSRP, case when m.perMSRP is null then 0 else m.perMSRP end As perMSRP from Categories c left join (select Categoryid, isMSRP, perMSRP from SetMsrp where userid = ?) AS m on c.CategoryId = m.CategoryId Where c.Status = 1 Order by c.Description asc', [parseInt(localStorage.userId)], function (tx, results) {

                        var len = results.rows.length;

                        for (var i = 0; i < len; ++i) {
                            var newObj = results.rows.item(i);
                            var SubCat = [];
                            newObj.SubCat = SubCat;
                            MSRPItems.push(newObj);
                        }

                        var results = new newRes(MSRPItems);
                        var msrpviewHtml = Template7.templates.msrpTemplate(results);
                        $$('#msrpContent').html(msrpviewHtml);

                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "MSRP-SelectSQL");
					}, null);

                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "MSRP-Page");
            }
        });

        //Page Products
        myApp.onPageInit('products', function (page) {
            isOnResume = true;
            isLblScan = false;
            var html;
            try {
                $$.each(page.query, function (key, value) {
                    if (key === "ObjectType") {
                        switch (value) {
                            case "A":
                                productselecttype = "A";
                                if (JSON.parse(localStorage.CatSubObject).category.length > 0) {
                                    html = compiledcatTemplate(JSON.parse(localStorage.CatSubObject));
                                    $$("#productSelect").html("Products Categories");
                                    $$('#productContent').html(html);

                                    $$('.allclass').remove();
                                } else {
                                    $$('.allclass').remove();
                                    $$("#productSelect").html("Products Categories");
                                    $$("#productContent").html('<p style="text-align:center;"> No Product Found. </p>');
                                }
                                break;
                            case "P":
                                productselecttype = "P";
                                if (JSON.parse(localStorage.CatSubObjectP).category.length > 0) {
                                    html = compiledcatTemplate(JSON.parse(localStorage.CatSubObjectP));
                                    $$("#productSelect").html("Promotions");
                                    $$('#productContent').html(html);

                                    $$('.alphaclass').remove();
                                } else {
                                    $$('.alphaclass').remove();
                                    $$("#productSelect").html("Promotions");
                                    $$("#productContent").html('<p style="text-align:center;"> No Product Found. </p>');
                                }
                                break;
                            case "N":
                                productselecttype = "N";
                                if (JSON.parse(localStorage.CatSubObjectN).category.length > 0) {
                                    html = compiledcatTemplate(JSON.parse(localStorage.CatSubObjectN));
                                    $$("#productSelect").html("New Arrivals");
                                    $$('#productContent').html(html);
                                    $$('.alphaclass').remove();
                                } else {
                                    $$('.alphaclass').remove();
                                    $$("#productSelect").html("New Arrivals");
                                    $$("#productContent").html('<p style="text-align:center;"> No Product Found. </p>');
                                }
                                break;
                            case "F":
                                productselecttype = "F";
                                if (JSON.parse(localStorage.CatSubObjectF).category.length > 0) {
                                    html = compiledcatTemplate(JSON.parse(localStorage.CatSubObjectF));
                                    $$("#productSelect").html("Featured Items");
                                    $$('#productContent').html(html);
                                    $$('.alphaclass').remove();
                                } else {
                                    $$('.alphaclass').remove();
                                    $$("#productSelect").html("Featured Items");
                                    $$("#productContent").html('<p style="text-align:center;"> No Product Found. </p>');
                                }
                                break;
                        }
                    }
                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "Products - Page");
            }
        });

        //Page ProductList
        myApp.onPageInit('ProductList', function (page) {
            isOnResume = true;
            isLblScan = false;
            var id;
            var cid;
            var alpha;
            myApp.showPreloader('Please Wait ....')
            try {
                $$.each(page.query, function (key, value) {
                    if (key === "id") {
                        id = value;
                    }
                    if (key === "cid") {
                        cid = value;
                    }
                    if (key === "alpha") {
                        alpha = value;
                    }
                    if (key === "ptype") {
                        productselecttype = value;
                    }
                });
                if (typeof id !== "undefined" && typeof cid !== "undefined" && typeof alpha !== "undefined") {
                    db.transaction(function (tx) {
                        var products = [];
                        var query = "";
                        if (productselecttype === "A") {
                            query = 'SELECT ProductId, SKU, Description, RegPrice, SpecialPrice, IsFeature, IsPromotion, IsNew, CategoryId, CategoryName, IsTobacco, SRPrice, SellPack, Size, Status, Bulky, IsDiscounted, DiscountPrice, DiscountReason, CaseQty, isDSD, InStock, DPri, DFlag, UPri, SRPer FROM Products where Products.CategoryId = ?';
                        } else {
                            query = 'SELECT ProductId, SKU, Description, RegPrice, SpecialPrice, IsFeature, IsPromotion, IsNew, CategoryId, "Products" as CategoryName, IsTobacco, SRPrice, SellPack, Size, Status, Bulky, IsDiscounted, DiscountPrice, DiscountReason, CaseQty, isDSD, InStock, DPri, DFlag, UPri, SRPer FROM Products';
                        }
                        
                        var joinquery = " where Products.CategoryId >= ?";

                        $$('#productlistheading').html("Product List");
                        if (productselecttype === "P") {
                            $$('#productlistheading').html("Promotions");
                            query = query + joinquery + " and IsPromotion = 1";
                        } else if (productselecttype === "N") {
                            $$('#productlistheading').html("New Arrivals");
                            query = query + joinquery + " and IsNew = 1";
                        } else if (productselecttype === "F") {
                            $$('#productlistheading').html("Featured Items");
                            query = query + joinquery + " and IsFeature = 1";
                        } else if (productselecttype === "D") {
                            $$('#productlistheading').html("Discounted Items");
                            query = query + joinquery + " and IsDiscounted = 'true'";
                        } 

                        if (alpha === "0") {

                        } else {

                            if (alpha === "1") {
                                query = query + " and substr(Products.Description,1,1) IN ('A', 'B', 'C', 'D', 'E', 'F','G', 'H', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h')";
                            }
                            if (alpha === "2") {
                                query = query + " and substr(Products.Description,1,1) IN ('I', 'J', 'K', 'L', 'M', 'N','O', 'P', 'Q', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q')";
                            }
                            if (alpha === "3") {
                                query = query + " and substr(Products.Description,1,1) IN ('R', 'S', 'T', 'U', 'V', 'W','X', 'Y', 'Z', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z')";
                            }
                            if (alpha === "4") {
                                query = query + " and substr(Products.Description,1,1) IN ('0', '1', '2', '3', '4', '5','6', '7', '8', '9')";
                            }

                        }

                        query = query + " order by Products.description";
                        
                        tx.executeSql(query, [parseInt(cid)], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                               
                                
                                if (productselecttype === "A") {
                                    $$('#breadCrum').html(results.rows.item(0).CategoryName);
                                } 

                                for (var i = 0; i < len; ++i) {
                                    products.push(results.rows.item(i));
                                }

                                var results = new newRes(products);
                                var ProductListHtml = compiledproductTemplate(results);

                                $$('#productsListContent').html(ProductListHtml);

                                myApp.hidePreloader();
                            } else {
                                myApp.hidePreloader();
                                myApp.alert('No Product Found!');
                                $$('#productsListContent').html('<p style="text-align:center;"> No Product Found. </p>');
                            }

                        },
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "ProductList-SelectSQL");
						}, null);
                    });
                } else {
                    myApp.hidePreloader();
                    LogError("SubCatId Not Found", "", "ProductList - Page");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "ProductList - Page");
            }
        });

        //Page Announcement
        myApp.onPageInit('announcement', function (page) {
            isOnResume = true;
            $$('#announcementContent').html("");
            $$('#announcementContent').hide();
            $$('#noconnectionfoundcardnews').hide();
            try {
                if (checkConnection()) {
                    $$.ajax({
                        url: localStorage.AuthKey + "api/News/GetNews",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', LastDate: serverdate },
                        crossDomain: "false",
                        async: true,
                        beforeSend: function (xhr) {
                        },
                        success: function (response, status, xhr) {
                            var newsObj = [];
                            $$.each(JSON.parse(response).results, function (key, value) {
                                newsObj.push(value);
                            });
                            var results = new newRes(newsObj);
                            var newsObjHtml = compiledannounceTemplate(results);
                            $$('#announcementContent').html(newsObjHtml);
                            $$(".closeannpopup").hide();
                            $$('#announcementContent').show();
                            myApp.hidePreloader();
                        },
                        complete: function (status, xhr) {
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetNews");
                        }
                    });
                } else {
                    $$('#noconnectionfoundcardnews').show();
                    myApp.hidePreloader();
                    myApp.alert('No Internet Connection Found!', 'GHRA')
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "Announcement - Page");
            }

        });

        //Page ViewCart
        myApp.onPageInit('view-cart', function (page) {

            refreshCart();
            isOnResume = true;

        });

        //Page ViewCart
        myApp.onPageInit('search', function (page) {

           
            isOnResume = true;
            isLblScan = false;

        });

        function refreshCart() {

            var labelQty = 0;
            var itemQty = 0;
            var returnsQty = 0;

            $$('#cartBulkyMsg').hide();

            try {

                myApp.showPreloader('Processing ...');
                db.transaction(function (tx) {
                    var cartItems = [];
                    tx.executeSql('select sum(CART.Quantity) As TotalQty, sum(CART.Quantity * DPri) As OrderTotal from CART INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).OrderTotal != null) {
                                $$('#cartTotalPrice').html(results.rows.item(0).OrderTotal.toFixed(2));
                                $$('.cartTotalItems').html(results.rows.item(0).TotalQty);
                                itemQty = results.rows.item(0).TotalQty;
                            } else {
                                $$('#cartTotalPrice').html("0.00");
                                $$('.cartTotalItems').html("0");
                            }

                        } else {

                            $$('#cartTotalPrice').html("0.00");
                            $$('.cartTotalItems').html("0");
                        }
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "CartTotal - SelectSQL");
					}, null);

                   

                    tx.executeSql('SELECT DPri AS CurrentPrice, ROUND((ROUND(DPri, 2) * Quantity),2) As TotalItemPrice, UPri, Cart.ID, Products.Description, SRPer, Size, SKU, SellPack, SRPrice, SpecialPrice, CategoryName, RegPrice, Products.InStock, CaseQty, Bulky, Quantity FROM Products inner join Cart on Products.ProductId = Cart.ProductId where Islabel = 0 AND UserId = ? Order by Cart.ID desc', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        for (var i = 0; i < len; ++i) {
                            cartItems.push(results.rows.item(i));
                        }

                        var results = new newRes(cartItems);
                        var cartviewHtml = Template7.templates.cartTemplate(results);
                        $$('#cartContent').html(cartviewHtml);

                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "Cart - SelectSQL");
					}, null);

                });


                db.transaction(function (tx) {

                    var cartItems = [];

                    tx.executeSql('select Sum(CART.Quantity) As TotalQty from CART where CART.isLabel = 2 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).TotalQty != null) {
                                $$('#returnsQty').html(results.rows.item(0).TotalQty);
                                returnsQty = results.rows.item(0).TotalQty;
                            } else {
                                $$('#returnsQty').html("0");
                            }

                        } else {
                            $$('#returnsQty').html("0");
                        }

                    },
					 function (tx, error) {
					     myApp.hidePreloader();
					     LogError(error.message, "", "ReturnTotal - SelectSQL");
					 }, null);


                    tx.executeSql('SELECT Cart.ID, Cart.MarginLabel, Cart.ProductId, Products.Description, Products.Size, Products.SKU, Products.CategoryName, Cart.LabelPrice, Cart.Quantity FROM Products inner join Cart on Products.ProductId = Cart.ProductId where Cart.Islabel = 2 AND Cart.UserId = ? Order by Cart.ID Desc', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        for (var i = 0; i < len; ++i) {
                            cartItems.push(results.rows.item(i));
                        }

                        var results = new newRes(cartItems);
                        var returnviewHtml = Template7.templates.returnTemplate(results);
                        $$(".returntotalspan").each(function () {
                            $$(this).val(parseFloat($$(this).val().toFixed(2)));
                        });
                        $$('#returnContent').html(returnviewHtml);
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "Returns - SelectSQL");
					}, null);


                });

                db.transaction(function (tx) {

                    var cartItems = [];

                    tx.executeSql('select count(CART.Id) As TotalQty from CART where CART.isLabel = 1 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).TotalQty != null) {
                                $$('#labelQty').html(results.rows.item(0).TotalQty);
                                labelQty = results.rows.item(0).TotalQty;
                            } else {
                                $$('#labelQty').html("0");
                            }

                        } else {
                            $$('#labelQty').html("0");
                        }
                        if ((itemQty + labelQty + returnsQty) === 0) {
                            $$("#chkoutbtn").attr('disabled', 'disabled');

                        }

                    },
					 function (tx, error) {
					     myApp.hidePreloader();
					     LogError(error.message, "", "LabelTotal - SelectSQL");
					 }, null);

                    tx.executeSql('SELECT DPri As CurrentPrice, MarginLabel, Cart.ID, Products.Description, Size, SKU, SpecialPrice, UPri, SellPack, CategoryName, SRPrice, SRPer, LabelPrice, RegPrice, CaseQty, Quantity FROM Products inner join Cart on Products.ProductId = Cart.ProductId where Islabel = 1 AND UserId = ? Order by Cart.ID Desc', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        for (var i = 0; i < len; ++i) {
                            cartItems.push(results.rows.item(i));
                        }

                        var results = new newRes(cartItems);
                        var labelviewHtml = Template7.templates.labelTemplate(results);
                        $$('#labelContent').html(labelviewHtml);
                    },
                        function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "Label - SelectSQL");
					}, null);


                });



                db.transaction(function (tx) {
                    if (parseInt(localStorage.bulkitem) > 0 && parseInt(localStorage.BulkyRule) === 1) {
                        tx.executeSql('select sum(CART.Quantity) As TotalBulkyQty from CART Inner join Products On Products.ProductId = CART.ProductId where Products.Bulky = 1 and CART.Islabel = 0 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                                if (parseInt(results.rows.item(0).TotalBulkyQty) > parseInt(localStorage.bulkitem)) {
                                    var msg = localStorage.BulkMessage;
                                    
                                    $$('#cartBulkyMsg').html(msg);
                                    $$('#cartBulkyMsg').show();
                                    myApp.alert(msg);
                                    $$('#chkoutbtn').attr('disabled', 'disabled');
                                }
                            }
                        },
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "GetBulky - SelectSQL");
						}, null);
                    }

                });

                myApp.hidePreloader();
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "ViewCart - Page");
            }

        }

        //Page promotion
        myApp.onPageInit('promotions', function (page) {
            isOnResume = true;
            try {
                if (checkConnection()) {
                    $$.ajax({
                        url: localStorage.AuthKey + "api/MasterPromotions/GetMobMasterPromotion",
                        method: "GET",
                        data: { id: parseInt(localStorage.userId) },
                        crossDomain: "false",
                        async: false,
                        beforeSend: function (xhr) {

                        },
                        success: function (response, status, xhr) {


                           
                            var promotionsObj = [];
                            $$.each(JSON.parse(response).results, function (key, value) {
                                promotionsObj.push(value);
                            });
                            var results = new newRes(promotionsObj);
                            var promotionsHtml = compiledpromotionsTemplate(results);
                            $$('#promotionsList').html(promotionsHtml);
                            myApp.hidePreloader();
                            
                        },
                        complete: function (status, xhr) {
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetMasterPromotions");
                        }
                    });
                } else {
                    $$('#noconnectionfoundcard').show();
                    myApp.hidePreloader();

                    myApp.alert('No Internet Connection Found!', 'GHRA')

                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "Promotions - Page");
            }
        });

        //Page promotion Detail
        myApp.onPageInit('promotion-details', function (page) {
            isOnResume = true;
            try {
                if (checkConnection()) {

                    var id = 0;

                    $$.each(page.query, function (key, value) {
                        if (key === "id") {
                            id = value;
                        }
                    });

                    $$.ajax({
                        url: localStorage.AuthKey + "api/DetailPromotions/GetMobDetailPromotion",
                        method: "GET",
                        data: { id: parseInt(id), CustomerId: parseInt(localStorage.userId) },
                        crossDomain: "false",
                        async: false,
                        beforeSend: function (xhr) {

                        },
                        success: function (response, status, xhr) {

                            
                            var promotionsObj = [];
                            $$.each(JSON.parse(response).results, function (key, value) {
                                var obj = value;
                                var o = []
                                o.push("Accept Quantity?")
                                for (var i = 1; i <= value.Quanity; i++) {
                                    o.push(i);
                                }
                                obj.QtyList = o;
                                promotionsObj.push(value);
                            });
                            var results = new newRes(promotionsObj);
                            var promotionsHtml = compiledpromotionDetailTemplate(results);
                            $$('#promotionDetail').html(promotionsHtml);
                            if (JSON.parse(response).results[0].PromotionMessage != "") {
                                $$('#promotiondetailmessage').html(JSON.parse(response).results[0].PromotionMessage);
                                $$('#promotiondetailmessage').show();
                            } else {
                                $$('#promotiondetailmessage').html("");
                                $$('#promotiondetailmessage').hide();
                            }


                            myApp.hidePreloader();
                            
                        },
                        complete: function (status, xhr) {
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetPromotionsDetails");
                        }
                    });
                } else {
                    $$('#noconnectionfoundcard').show();
                    myApp.hidePreloader();

                    myApp.alert('No Internet Connection Found!', 'GHRA')

                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "PromotionsDetails - Page");
            }
        });

        //Page Oder History
        myApp.onPageInit('orderHistory', function (page) {
            isOnResume = true;
            try {
                if (checkConnection()) {
                    $$.ajax({
                        url: localStorage.AuthKey + "api/OrderHistoryMasters/GetOrderHistoryM",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', UserId: parseInt(localStorage.userId) },
                        crossDomain: "false",
                        async: false,
                        beforeSend: function (xhr) {

                        },
                        success: function (response, status, xhr) {
                            
                            var oderHistoryObj = [];
                            $$.each(JSON.parse(response).results, function (key, value) {
                                oderHistoryObj.push(value);
                            });
                            var results = new newRes(oderHistoryObj);
                            var orderHistoryHtml = compiledorderHistoryTemplate(results);
                            $$('#oderHistoryList').html(orderHistoryHtml);
                            myApp.hidePreloader();
                           
                        },
                        complete: function (status, xhr) {
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetMobCategories");
                        }
                    });
                } else {
                    $$('#noconnectionfoundcard').show();
                    myApp.hidePreloader();

                    myApp.alert('No Internet Connection Found!', 'GHRA')

                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "OrderHistory - Page");
            }
        });

        myApp.onPageInit('quickscan', function (page) {
            isOnResume = true;
            $$("#lblPrefdiv").hide();
            $$("#createOrderlbl").show();
            isLblScan = false;
            try {               
                $$.each(page.query, function (key, value) {
                    if (key === "type") {
                        $$("#lblPrefdiv").show();
                        $$("#createOrderlbl").hide();
                        isLblScan = true;
                        if (localStorage.lblPref) {
                            $$("#lblPref").val(localStorage.lblPref);
                        } else {
                            localStorage.lblPref = "1";
                            localStorage.lblPrefText = "GHRA SRP";
                            $$("#lblPref").val(localStorage.lblPref);
                        }                       
                    }
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "Quick-Scan - Page");
            }
        });


        //Page Oder History Detail
        myApp.onPageInit('orderHistoryDetailList', function (page) {
            isOnResume = true;
            try {
                myApp.showPreloader('Please wait ...');
                if (checkConnection()) {
                    var id = 0;
                    var returnbool = "N";
                    var editbool = "N";
                    var royalid = 0;
                    var nobid = 0;

                    $$.each(page.query, function (key, value) {
                        if (key === "id") {
                            id = value;
                            hdorderid = value;
                        }
                    });

                    $$("#cancelOrder").hide();
                    $$("#editOrder").hide();
                    $$('#oderDetailId').html("");
                    $$('#orderDetailDate').html("");
                    
                    $$('#orderstatus').html("");
                    $$('#orderDetailTotal').html("");
                    $$('#orderDetailOldTotal').html("");
                    $$('#orderDetailTobacco').html("");
                    $$('#orderDetailOldTobacco').html("");
                    $$('#orderDetailGroceries').html("");
                    $$('#orderDetailOldGroceries').html("");

                    $$.ajax({
                        url: localStorage.AuthKey + "api/OrderHistoryMasters/GetOrderHistoryMWithId",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', UserId: parseInt(localStorage.userId), OrdId: id },
                        crossDomain: "false",
                        async: false,
                        beforeSend: function (xhr) {

                        },
                        success: function (response, status, xhr) {
                            var valordertotal = 0.00;
                            var valtobamount = 0.00;
                            var valgroamount = 0.00;

                            db.transaction(function (tx) {

                                $$.each(JSON.parse(response).results, function (key, value) {

                                    royalid = value.RoyalId;
                                    $$('#orderDetailDate').html(value.OrderDate);
                                    
                                    //check if more than one shipping option available
                                    if (value.DeliveryStatus === "PICKUP") {
                                        $$('#deliverystatus').val("1");
                                    } else if (value.DeliveryStatus === "DELIVERY") {
                                        $$('#deliverystatus').val("2");
                                    } else if (value.DeliveryStatus === "RETURN") {
                                        $$('#deliverystatus').val("3");
                                    } else {
                                        $$('#deliverystatus').val("4");
                                    }

                                    
                                    $$('#deliverystatus option[value="4"]').html(localStorage.captionDelivery);
                                   

                                    $$('#orderstatus').html(value.OrdDescritpion);
                                    $$('#oderDetailId').html(value.RoyalId);

                                    if (value.RoyalId === "0") {
                                        $$('#oderDetailId').html(value.OrderId);
                                    }

                                    if (parseFloat(value.OrderTotal) > 0) {
                                        $$('#orderDetailTotal').html("$" + value.OrderTotal);
                                        $$('#orderDetailOldTotal').html("$" + value.oldTotal);
                                        valordertotal = parseFloat(value.OrderTotal);
                                    } else {
                                        $$('#orderDetailTotal').html("$" + value.oldTotal);
                                        $$('#orderDetailOldTotal').html("");
                                        valordertotal = parseFloat(value.oldTotal);
                                    }


                                    if (parseFloat(value.newTob) > 0) {
                                        $$('#orderDetailTobacco').html("$" + value.newTob);
                                        $$('#orderDetailOldTobacco').html("$" + value.oldTob);
                                        valtobamount = parseFloat(value.newTob);
                                    } else {
                                        $$('#orderDetailTobacco').html("$" + value.oldTob);
                                        $$('#orderDetailOldTobacco').html("");
                                        valtobamount = parseFloat(value.oldTob);
                                    }

                                    if (parseFloat(value.newGro) > 0) {
                                        $$('#orderDetailGroceries').html("$" + value.newGro);
                                        $$('#orderDetailOldGroceries').html("$" + value.oldGro);
                                        valgroamount = parseFloat(value.newGro);
                                    } else {
                                        $$('#orderDetailGroceries').html("$" + value.oldGro);
                                        $$('#orderDetailOldGroceries').html("");
                                        valgroamount = parseFloat(value.oldGro);
                                    }


                                    if (parseInt(value.OrderStatusId) === 10) {
                                        $$("#cancelOrder").show();
                                        $$("#editOrder").show();
                                        editbool = "Y";
                                        nobid = value.OrderId;
                                        
                                        if (value.DeliveryStatus === "RETURN") {
                                            $$('#deliverystatus').prop("disabled", true);
                                            $$("#editOrder").hide();
                                        } else {
                                            $$('#deliverystatus option[value="3"]').remove();
                                        }
                                    } else {
                                        $$('#deliverystatus').prop("disabled", true);
                                    }

                                    if (parseInt(value.OrderStatusId) === 30 || parseInt(value.OrderStatusId) === 40) {
                                        returnbool = "Y";
                                        if (value.DeliveryStatus === "RETURN") {
                                            returnbool = "N";
                                        }
                                    }

                                });

                                myApp.hidePreloader();

                            });
                            
                            db.transaction(function (tx) {
                                if ($$('#deliverystatus').val() !== "3") {
                                    if (localStorage.rule === "1") { 

                                        if (valordertotal === 0) {
                                            $$('#deliverystatus option[value="4"]').remove();
                                            $$('#deliverystatus option[value="2"]').remove();
                                            $$('#deliverystatus option[value="1"]').remove();
                                            $$('#deliverystatus option[value="3"]').remove();
                                        } else {



                                            db.transaction(function (tx) {
                                               
                                                tx.executeSql('SELECT * FROM SHIPPINGRULE', [], function (tx, results) {

                                                    

                                                    if (localStorage.ACH) {

                                                        if (localStorage.ACH === "Both") {

                                                           

                                                            //FOr Loop .. Shipping Rule Table ...
                                                            var tobamount = valtobamount;
                                                            var groamount = valgroamount;
                                                            var checkPickup = 0;
                                                            var checkDelivery = 0;
                                                            var checkPaid = 0;

                                                            for (var i = 0; i < results.rows.length; i++) {
                                                               
                                                                var rule = results.rows.item(i).Rule;

                                                                
                                                                //if active rule
                                                                if ((eval(rule)) === true && results.rows.item(i).Status === 1) {
                                                                    
                                                                    checkPickup = 1;
                                                                    ///delivery
                                                                    if (results.rows.item(i).ModeId === 2) {
                                                                        checkDelivery = 1;
                                                                        
                                                                    }/// paid delivery
                                                                    else if (results.rows.item(i).ModeId === 4) {
                                                                        checkPaid = 1;
                                                                        
                                                                    }
                                                                }
                                                                if (i === results.rows.length - 1 && checkPickup === 0) {
                                                                    
                                                                    $$('#deliverystatus option[value="2"]').remove();
                                                                    $$('#deliverystatus option[value="4"]').remove();
                                                                }
                                                                if (i === results.rows.length - 1 && checkDelivery === 1) {
                                                                    
                                                                    $$('#deliverystatus option[value="4"]').remove();
                                                                }
                                                                if (i === results.rows.length - 1 && checkDelivery === 0 && checkPaid === 1) {
                                                                    
                                                                    $$('#deliverystatus option[value="2"]').remove();
                                                                }

                                                            }



                                                        } else {

                                                            $$('#deliverystatus').prop("disabled", true);

                                                            
                                                        }
                                                    }
                                                    else {

                                                        $$('#deliverystatus').prop("disabled", true);

                                                       
                                                    }
                                                },
                                                function (tx, error) {
                                                    myApp.hidePreloader();
                                                    LogError(error.message, "", "Rule - SelectSQL");
                                                }, null);
                                            });
                                        }
                                    }
                                }
                            });
                            
                        },
                        complete: function (status, xhr) {

                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetOrderDetailHeader");
                        }
                    });

                    $$.ajax({
                        url: localStorage.AuthKey + "api/OrderHistoryDetails/GetOrderHistoryM",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', OrderId: id },
                        crossDomain: "false",
                        async: false,
                        beforeSend: function (xhr) {

                        },
                        success: function (response, status, xhr) {
                            db.transaction(function (tx) {
                                var oderHistoryDetailObj = [];
                                var count = 0;
                                $$.each(JSON.parse(response).results, function (key, value) {
                                    count = count + 1;
                                    var obj = value;
                                    obj.Return = returnbool;
                                    obj.OrderID = royalid;
                                    obj.Edit = editbool;
                                    obj.NOrderID = nobid;
                                    var o = []
                                    o.push("Return Quantity?")
                                    for (var i = 1; i <= value.Qty; i++) {
                                        o.push(i);
                                    }
                                    obj.QtyList = o;
                                    oderHistoryDetailObj.push(value);
                                });
                                var results = new newRes(oderHistoryDetailObj);

                                var orderHistoryDetailHtml = compiledorderHistoryDetailTemplate(results);
                                $$('#orderHistoryDetail').html(orderHistoryDetailHtml);
                                if (count <= 1) {
                                    $$(".itemRemoveOrder").hide();
                                }
                                myApp.hidePreloader();
                            });
                        },
                        complete: function (status, xhr) {
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetHistoryDetail");
                        }
                    });

                } else {
                    $$('#noconnectionfoundcardoh').show();
                    myApp.hidePreloader();
                    myApp.alert('No Internet Connection Found!', 'GHRA')
                }

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "OrderHistoryDetailList - Page");
            }

        });

        //Last Oder History Detail
        myApp.onPageInit('lastorder', function (page) {

            try {


                myApp.alert('This is your last submitted order that has saved in this app for technical purpose only. Prices and totals may be different than the original processed order. You can view the complete process order on "Order History" option on the home screen.');


                db.transaction(function (tx) {
                    var cartItems = [];
                    tx.executeSql('SELECT DPri AS CurrentPrice, ROUND((ROUND(DPri, 2) * Quantity),2) As TotalItemPrice, ID, SRPrice, SRPer, UPri, Description, Size, SKU, SpecialPrice, CategoryName, RegPrice, CaseQty, Quantity FROM Products inner join History on Products.ProductId = History.ProductId where Islabel = 0 AND UserId = ? Order by ID desc', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            for (var i = 0; i < len; ++i) {
                                cartItems.push(results.rows.item(i));
                            }
                            var results = new newRes(cartItems);
                            var cartviewHtml = compiledlastOrderDetailTemplate(results);
                            $$('#lastorderDetail').html(cartviewHtml);
                        } else {
                            $$('#lastorderchkoutbtn').attr('disabled', 'disabled');
                            myApp.alert("No Order History");
                        }
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "LastOrder - SelectSQL");
					}, null);

                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "LastOrder - Page");
            }

        });

        //Edit Order


        //Page Checkout
        myApp.onPageInit('checkout', function (page) {
            isOnResume = true;
            var TobAmount;
            var GroAmount;
            var delivery;
            var pqty = 0;
            var lqty = 0;
            var rqty = 0;

            $$("#processingbtn").hide();

            try {

                db.transaction(function (tx) {
                    $$('#CheckOutPolicy').html(localStorage.CheckOutPolicy);
                    tx.executeSql('select sum(CART.Quantity) As TotalQty, sum(CART.Quantity * (case when SpecialPrice <= 0 then RegPrice else SpecialPrice end)) As OrderTotal from CART INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).OrderTotal != null) {
                                $$('#grandTotal').html("$" + results.rows.item(0).OrderTotal.toFixed(2));
                            } else {
                                $$('#grandTotal').html("$0.00");
                            }

                        } else {

                            $$('#grandTotal').html("$0.00");
                        }
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "CheckOutTotal - SelectSQL");
					}, null);

                    tx.executeSql('select count(CART.Id) As TotalQty from CART where CART.isLabel = 1 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            lqty = results.rows.item(0).TotalQty;

                            $$('#labelsQuantity').html(results.rows.item(0).TotalQty);
                        } else {
                            $$('#labelsQuantity').html("0");
                        }

                    },
					 function (tx, error) {
					     myApp.hidePreloader();
					     LogError(error.message, "", "CheckOutTotalQty - SelectSQL");
					 }, null);


                    tx.executeSql('select Id, SUM(CART.Quantity) As TotalQty, Sum(CART.Quantity * CART.LabelPrice) AS TotalReturns from CART where CART.isLabel = 2 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            rqty = results.rows.item(0).TotalQty;
                            $$('#returnsQuantity').html(results.rows.item(0).TotalQty);
                            if (rqty === null) {
                                $$('#returnsQuantity').html("0");
                            }

                            if (results.rows.item(0).TotalReturns != null) {
                                $$('#returnsTotal').html("$" + results.rows.item(0).TotalReturns.toFixed(2));
                            } else {
                                $$('#returnsTotal').html("$0.00");
                            }
                        } else {
                            $$('#returnsQuantity').html("0");
                            $$('#returnsTotal').html("$0.00");
                        }
                    },
					 function (tx, error) {
					     myApp.hidePreloader();
					     LogError(error.message, "", "CheckOutTotalQty - SelectSQL");
					 }, null);


                    tx.executeSql('select sum(OrderQty) As OrderQty, sum(GroceryAmount) As GroAmount, sum(TobaccoAmount) As TobAmount from (select sum(o.Quantity) As OrderQty, case when p.IsTobacco = 0 then sum(o.Quantity * (case when p.SpecialPrice <= 0 then p.RegPrice else p.SpecialPrice end)) else 0 end As GroceryAmount, case when p.IsTobacco = 1 then sum(o.Quantity * (case when p.SpecialPrice <= 0 then p.RegPrice else p.SpecialPrice end)) else 0 end As TobaccoAmount from CART o inner join Products p on p.ProductId = o.ProductId where o.isLabel = 0 AND o.UserId = ? group by p.IsTobacco) Src', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;

                        if (len > 0) {

                            if (results.rows.item(0).TobAmount != null) {
                                $$('#totalTobacco').html("$" + results.rows.item(0).TobAmount.toFixed(2));
                                TobAmount = parseFloat(results.rows.item(0).TobAmount.toFixed(2));
                            } else {
                                TobAmount = 0;
                                $$('#totalTobacco').html("$0.00");
                            }
                            if (results.rows.item(0).GroAmount != null) {
                                $$('#totalMarchandies').html("$" + results.rows.item(0).GroAmount.toFixed(2));
                                GroAmount = parseFloat(results.rows.item(0).GroAmount.toFixed(2));
                            } else {
                                GroAmount = 0;
                                $$('#totalMarchandies').html("$0.00");
                            }
                            if (results.rows.item(0).OrderQty != null) {
                                pqty = parseInt(results.rows.item(0).OrderQty);
                                $$('#productsQuantity').html(results.rows.item(0).OrderQty);
                            } else {
                                $$('#productsQuantity').html("0");
                            }

                        } else {
                            delivery = false;

                            pqty = 0;
                            $$('#totalTobacco').html("$0.00");
                            $$('#totalMarchandies').html("$0.00");
                            $$('#productsQuantity').html("0");
                        }

                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "CheckOutOrdersTotal - SelectSQL");
					}, null);
                });



                db.transaction(function (tx) {

                    if (localStorage.rule === "1") { 

                        if (pqty === 0) {
                            delivery = false;
                            $$('#deliverymodeselect option[value="0"]').remove();
                            $$('#deliverymodeselect option[value="2"]').remove();
                            $$('#deliverymodeselect option[value="4"]').remove();
                            $$('#deliverymodeselect option[value="1"]').prop("selected", "selected");
                            $$('#shippingli').hide();
                        } else {

                            db.transaction(function (tx) {

                                //Shipping Rule ...
                                //SELECT ROGen, ROTob, RTGen, RTHTob, PaidRuleTob, PaidRuleGro, DeliveryAmount FROM ServerDate

                                tx.executeSql('SELECT * FROM SHIPPINGRULE', [], function (tx, results) {



                                  


                                    if (localStorage.ACH) {

                                        if (localStorage.ACH === "Both") {

                                           

                                            //FOr Loop .. Shipping Rule Table ...
                                            var tobamount = TobAmount;
                                            var groamount = GroAmount;
                                            var checkPickup = 0;
                                            var checkDelivery = 0;
                                            var checkPaid = 0;

                                           

                                            $$('#deliverymodeselect option[value="4"]').html(localStorage.captionDelivery);
                                            $$('#deliverymodeselect option[value="0"]').prop("selected", "selected");

                                            for (var i = 0; i < results.rows.length; i++) {
                                               
                                                var rule = results.rows.item(i).Rule;
                                                
                                                if ((eval(rule)) === true && results.rows.item(i).Status === 1) {
                                                    
                                                    checkPickup = 1;
                                                    ///delivery
                                                    if (results.rows.item(i).ModeId === 2) {
                                                        checkDelivery = 1;
                                                        
                                                    }/// paid delivery
                                                    else if (results.rows.item(i).ModeId === 4) {
                                                        checkPaid = 1;
                                                        
                                                    }
                                                }
                                                if (i === results.rows.length - 1 && checkPickup === 0) {
                                                    
                                                    $$('#deliverymodeselect option[value="2"]').remove();
                                                    $$('#deliverymodeselect option[value="4"]').remove();
                                                }
                                                if (i === results.rows.length - 1 && checkDelivery === 1) {
                                                    
                                                    $$('#deliverymodeselect option[value="4"]').remove();
                                                }
                                                if (i === results.rows.length - 1 && checkDelivery === 0 && checkPaid === 1) {
                                                    
                                                    $$('#deliverymodeselect option[value="2"]').remove();
                                                }

                                            }


                                          

                                        } else {

                                           

                                            delivery = false;
                                            $$('#deliverymodeselect option[value="0"]').prop("selected", "selected");
                                           
                                            $$('#deliverymodeselect option[value="2"]').remove();
                                            $$('#deliverymodeselect option[value="4"]').remove();
                                        }
                                    }
                                    else {

                                        
                                        delivery = false;
                                        $$('#deliverymodeselect option[value="0"]').prop("selected", "selected");
                                        
                                        $$('#deliverymodeselect option[value="2"]').remove();
                                        $$('#deliverymodeselect option[value="4"]').remove();
                                    }
                                },
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "Rule - SelectSQL");
								}, null);
                            });
                        }
                    }

                });


            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "CheckOut - Page");
            }


        });

        //Page Setting
        myApp.onPageInit('settings', function (page) {
            isOnResume = true;
            try {
                $$('#lastupdate').html(localStorage.lastrundatetime);
                db.transaction(function (tx) {
                    tx.executeSql('SELECT UserName, CompanyName, Address, EmailAddress, CellPhone, DeliveryDay FROM Customer WHERE UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var serverResult = results.rows.item(0);
                        $$('#storeName').html(serverResult.UserName);
                        $$('#CompanyName').html(serverResult.CompanyName);
                        $$('#storeAddress').html(serverResult.Address);
                        $$('#storePhone').html(serverResult.CellPhone);
                        $$('#storeEmail').html(serverResult.EmailAddress);
                        $$('#storeDay').html("Delivery Day:" + " " + serverResult.DeliveryDay);
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "StoreInfo - SelectSQL");
					}, null);
                });
                
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "Settings - Page");
            }
        });

        //First Function Run on body
        function onLoad() {
            //Ondevice Ready
            document.addEventListener("deviceready", onDeviceReady, false);
        }

        //OnResume Function
        $$(document).on('resume', function (e) {
            //check if user is valid or invalid ...
            if (checkConnection() && isOnResume) {
                runLoginAjax(localStorage.userName, localStorage.password, true)
            }
        });

        myApp.onPageBack('ProductList', function (page) {
            $$('#plsearch').val();
        });

        $$(document).on('click', '#userInfoSubmit', function (e) {
            e.preventDefault();
            var phoneNumber = $$('#mobileNumber').val();
            var email = $$('#emailAddress').val();
            if (phoneNumber.length >= 10 && email.length >= 7) {
                getUserInfo();
            } else {
                myApp.alert("Please Enter Vaild Email and Phone Number.", "GHRA");
            }
        });

        $$(document).on('submit', '#signinform', function (e) {
            e.preventDefault();
            var username = $$('#username').val();
            var password = $$('#password').val();
            var testPlatform;
            try {
                myApp.showPreloader('Authenticating User ....', 'GHRA');
                if (localStorage.userName && localStorage.password) {
                    db.transaction(function (tx) {
                        tx.executeSql('SELECT UserId from Customer where UserName = ?', [username],
						function (tx, results) {
						    var len = results.rows.length;
						    if (len > 0) {
						        ///Offline ...``

						        if (checkConnection()) {
						            testPlatform = "AJAX";
						            //console.log(testPlatform + "Found Connection ");
						        } else {
						            testPlatform = "SQL";
						            //console.log(testPlatform + "No Connection");
						        }
						        checkPlatform(testPlatform, username, password);

						    } else {
						        ///Online ...
						        //console.log(testPlatform + "IN AJAX LEN < 0");
						        testPlatform = "AJAX";
						        checkPlatform(testPlatform, username, password);
						    }
						},
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "signinform - SelectUserSQL");
						}, null);

                        
                        //if (checkConnection() && CalDateTime(lastrundatetime) > dbsync) {
                        //    testPlatform = "AJAX";
                        //    checkPlatform(testPlatform, username, password);
                        //}
                        // console.log(testPlatform + "IN");
                    });
                } else {
                    //console.log(testPlatform + "Out");
                    testPlatform = "AJAX";
                    checkPlatform(testPlatform, username, password);
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "signinform");
            }
        });

        function checkPlatform(testPlatform, username, password) {
            if (testPlatform === "SQL") {
                //$$('#lastupdate').html(getlastupdate());//serverdate.toString().substr(0, 10));
                db.transaction(function (tx) {
                    tx.executeSql('SELECT UserId, UserName, DeliveryDay, Password, CompanyName, Address, EmailAddress, CellPhone, DeliveryDay, BulkyRule, DeliveryMode, TobaccoLimit, GenLimit, ChkoutRule FROM Customer where UserName = ? AND Password = ?', [username, password], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            var value = results.rows.item(0);
                            if (value.UserId != 0) {
                                localStorage.userId = value.UserId;
                                localStorage.userName = value.UserName
                                localStorage.companyName = value.CompanyName;
                                localStorage.password = value.Password;
                                localStorage.rule = value.ChkoutRule;
                                localStorage.deliveryDay = value.DeliveryDay;
                                localStorage.ACH = value.DeliveryMode;
                                localStorage.BulkyRule = value.BulkyRule;
                                $$('#companyName').html(localStorage.companyName);
                                $$('#accountNo').html(localStorage.userName);
                                $$('#deliveryDayTop').html(localStorage.deliveryDay);
                                getItemQty();
                                myApp.hidePreloader();
                                myApp.closeModal();
                                //mainView.router.refreshPage();
                            } else {
                                myApp.hidePreloader();
                                localStorage.userName = username;
                                localStorage.password = "";
                                myApp.alert('Invalid Username or Password!', 'GHRA');
                            }
                        } else {
                            myApp.hidePreloader();
                            localStorage.userName = username;
                            localStorage.password = "";
                            myApp.alert('Invalid Username or Password!', 'GHRA');
                        }
                    },
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "signin - SelectSQL");
						}, null);
                });
            } else if (testPlatform === "AJAX") {
                if (checkConnection()) {
                    //$$('#lastupdate').html(getlastupdate());
                    if (localStorage.AuthKey) {
                        runLoginAjax(username, password, false);
                    } else {
                        getKey();
                        setTimeout(function () { runLoginAjax(username, password, false); }, 300);
                    }

                } else {
                    myApp.hidePreloader();
                    myApp.alert('Application requires internet connection for the first time, please check you internet connection and try again.', 'Exit Application!', function () {
                        navigator.app.exitApp();
                    });

                }
            } else {
                myApp.hidePreloader();
                LogError(e.message, "", "signinformELSE");
            }
        }

        function runLoginAjax(username, password, isResume) {
            myApp.hidePreloader();
            if (isResume) {
                myApp.showPreloader('Checking updates ....', 'GHRA');
            } else {
                myApp.showPreloader('Authenticating User ....', 'GHRA');
            }
            $$.ajax({
                url: localStorage.AuthKey + "api/Customer/Authentication",
                method: "GET",
                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', UserName: username, Password: password },
                crossDomain: "false",
                async: false,
                success: function (response, status, xhr) {

                    if (JSON.parse(response).results[0].UserId != 0) {

                        db.transaction(function (tx) {
                            $$("#signin").hide();
                            $$.each(JSON.parse(response).results, function (key, value) {
                                localStorage.userId = value.UserId;
                                localStorage.userName = value.UserName
                                localStorage.companyName = value.CompanyName;
                                localStorage.password = value.Password;
                                localStorage.rule = value.ChkoutRule;
                                localStorage.BulkyRule = value.BulkyRule;
                                localStorage.Status = value.Status;
                                //ASIF
                                localStorage.ACH = value.DeliveryMode;
                                localStorage.deliveryDay = value.DeliveryDay;
                                $$('#companyName').html(localStorage.companyName);
                                $$('#accountNo').html(localStorage.userName);
                                $$('#deliveryDayTop').html(localStorage.deliveryDay);
                                ///Delete ServerDate Table and Create Again with new field .. just once ...

                                ///
                                tx.executeSql('INSERT OR REPLACE INTO Customer (UserId, UserName, Password, CompanyName, Address, EmailAddress, CellPhone, Status, PermitExpire, TobaccoLimit, GenLimit, DeliveryMode, DeliveryDay, ChkoutRule,BulkyRule) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)', [value.UserId, value.UserName, value.Password, value.CompanyName, value.Address, value.EmailAddress, value.CellPhone, value.Status, value.PermitExpire, value.TobaccoLimit, value.GenLimit, value.DeliveryMode, value.DeliveryDay, value.ChkoutRule, value.BulkyRule],
							 function (tx, results) {
							     getItemQty();
							     //Get Data -- check for updates after login ...
							     getData();
							     myApp.hidePreloader();
							     //if inactive user send them to login screen ...
							     if (value.Status === 0) {
							         localStorage.userName = username;
							         localStorage.password = "";
							         if (isResume) {
							             myApp.loginScreen();
							         } else {
							             myApp.alert('You account has been inactive!', 'GHRA');
							         }

							     } else {
							         myApp.closeModal();
							     }

							     //mainView.router.refreshPage();
							 },
							 function (tx, error) {
							     myApp.hidePreloader();
							     LogError(error.message, "", "Signin - SelectSQL");
							 }, null);
                            });
                        });


                        if (isResume) {

                        } else {

                            if (localStorage.Status === "0") {
                            } else {
                                db.transaction(function (tx) {
                                    $$('#announcementContentpop').html("");
                                    try {
                                        if (checkConnection()) {
                                            $$.ajax({
                                                url: localStorage.AuthKey + "api/News/WAGetPopup",
                                                method: "GET",
                                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28' },
                                                crossDomain: "false",
                                                async: true,
                                                beforeSend: function (xhr) {
                                                    myApp.hidePreloader();
                                                },
                                                success: function (response, status, xhr) {
                                                    myApp.hidePreloader();

                                                    var newsObj = [];
                                                    $$.each(JSON.parse(response).results, function (key, value) {
                                                        newsObj.push(value);
                                                    });
                                                    if (newsObj.length > 0) {
                                                        var results = new newRes(newsObj);
                                                        var newsObjHtml = compiledannounceTemplate(results);
                                                        $$('#announcementContentpop').html(newsObjHtml);
                                                        myApp.popup('.popup-annoucement');
                                                    } else {
                                                        CheckPromoNotification();
                                                    }

                                                },
                                                complete: function (status, xhr) {
                                                    myApp.hidePreloader();
                                                },
                                                error: function (status, xhr) {
                                                    myApp.hidePreloader();
                                                    LogError(status, xhr, "GetNews");
                                                }
                                            });
                                        } else {
                                            myApp.hidePreloader();
                                        }
                                    } catch (e) {
                                        myApp.hidePreloader();
                                        LogError(e.message, "", "Announcement - Page");
                                    }
                                    myApp.hidePreloader();
                                });
                                //Delete InActive Products
                                //db.transaction(function (tx) {
                                //    tx.executeSql('DELETE FROM Products where Status = 0');
                                //});
                            }
                        }
                        myApp.hidePreloader();

                    } else {
                        myApp.hidePreloader();
                        localStorage.userName = username;
                        localStorage.password = "";
                        if (isResume) {
                            myApp.loginScreen();
                        } else {

                            myApp.alert('Invalid Username or Password!', 'GHRA');
                        }

                    }

                },
                complete: function (status, xhr) {

                },
                error: function (status, xhr) {
                    myApp.hidePreloader();
                    LogError(status, xhr, "UserAuthentication");
                }
            });
        }

        function deleteOrder(id) {

            try {
                myApp.confirm('Are you sure you want to cancel this order?', 'GHRA',
					 function () {
					     myApp.showPreloader("Please wait ...");
					     $$.ajax({
					         url: localStorage.AuthKey + "api/OrdersMaster/PostOrder/?OrderId=" + id,
					         type: "POST",
					         async: false,
					         success: function (data) {
					             myApp.hidePreloader();
					             myApp.alert('Your order has been cancelled. Please contact GHRA office if you have any questions.', 'GHRA', function () {
					                 mainView.router.loadPage('order-history.html');
					             });
					         },
					         error: function (status, xhr) {
					             myApp.hidePreloader();
					             LogError(status, xhr, "deleteOrder");
					         }
					     });
					 },
					 function () {
					     myApp.hidePreloader();
					 }
				   );
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "deleteOrder");
            }
        }

        $$(document).on('click', '#closeprohis', function () {
            myApp.hidePreloader();
            $$('#propurchasedhistorycontent').html("");
        });

        $$(document).on('click', '.open-propurhis', function () {
            myApp.hidePreloader();
            var pid = parseInt($$(this).data("id"));
            //$$("#propurchasedhistorycontent").html('<center><span style="width:60px; height:60px" class="preloader"></span></center>')
            $$('#propurchasedhistorycontent').html("");
            try {
                if (checkConnection()) {
                    $$.ajax({
                        url: localStorage.AuthKey + "api/MobProductHistories/GetProductHistoryByCustomer",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', UserId: parseInt(localStorage.userId), ProductId: pid },
                        crossDomain: "false",
                        async: true,
                        beforeSend: function (xhr) {
                        },
                        success: function (response, status, xhr) {
                            var purHistoryObj = [];
                            $$.each(JSON.parse(response).results, function (key, value) {
                                purHistoryObj.push(value);
                            });
                            if (purHistoryObj.length > 0) {
                                var results = new newRes(purHistoryObj);
                                var purHistoryHtml = compiledprohistoryTemplate(results);
                                $$('#propurchasedhistorycontent').html(purHistoryHtml);
                            } else {
                                $$('#propurchasedhistorycontent').html('<center><p>No Purchased History Found.</p></center>');
                            }
                            myApp.pickerModal('.picker-producthistory');
                        },
                        complete: function (status, xhr) {
                        },
                        error: function (status, xhr) {
                            LogError(status, xhr, "MobProductHistories");
                        }
                    });
                } else {
                    $$("#propurchasedhistorycontent").html('<center><p>Internet Connection is required to view product purchased history. Check your Internet connection and try again.</p></center>')
                    myApp.pickerModal('.picker-producthistory');
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "PurchasedHistory - PopUp");
            }
        });

        $$(document).on('change', '#lblPref', function (e) {
            localStorage.lblPref = $$(this).val();
            if ($$(this).val() === "1") {
                localStorage.lblPrefText = "GHRA SRP";
            } else if ($$(this).val() === "2") {
                localStorage.lblPrefText = "No Price";
            } else if ($$(this).val() === "3") {
                localStorage.lblPrefText = "CAT % (Round up to 9)";
            } else if ($$(this).val() === "4") {
                localStorage.lblPrefText = "CAT % (No Round up)";
            }
            
        });

        $$(document).on('change', '#deliverymodeselect', function (e) {
            $$("#checkcartbtn").removeAttr("disabled");
        });

        $$(document).on('change', '#deliverystatus', function (e) {
            try {
                if (hdorderid !== 0) {
                    var sid = $$(this).val();
                    var results = {
                        "results": [
                        {
                            "UserId": parseInt(localStorage.userId),
                            "Id": parseInt(hdorderid), /// Nop Order Number
                            "ChangeValue": parseInt(sid) // delivery / Paid Delivery / Pickup  ...
                        }]
                    };
                    myApp.confirm('Are you sure you want to change the shipping method?', 'GHRA',
                         function () {
                             myApp.showPreloader("Please wait ...");
                             $$.ajax({
                                 url: localStorage.AuthKey + "api/Carts/PutCart/",
                                 type: "POST",
                                 async: false,
                                 data: results,
                                 success: function (data) {
                                     myApp.hidePreloader();
                                     if (data === "false") {
                                         myApp.alert('Unable to change the shipping method, your order may contain pick or delivery only items, please review.', 'GHRA', function () {
                                             mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
                                         });
                                     } else {
                                         myApp.alert('Shipping Method has been changed for this order.', 'GHRA', function () {
                                             mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
                                         });
                                     }
                                 },
                                 error: function (status, xhr) {
                                     myApp.hidePreloader();
                                     LogError(status, xhr, "ChangeShippingMethod");
                                 }
                             });
                         },
                         function () {
                             myApp.hidePreloader();
                             mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
                         }
                       );
                } else {
                    myApp.hidePreloader();
                    myApp.alert('Error Occured! Try Again.', 'GHRA', function () {
                        mainView.router.reloadPage('order-historyDetail.html');
                    });
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "ChangeShippingMethod");
            }
        });

        $$(document).on('click', '.itemRemoveOrder', function (e) {
            var pid = $$(this).data("id");
            var oid = $$(this).data("orderid");
            try {
                var results = {
                    "results": [
					{
					    "UserId": parseInt(localStorage.userId),
					    "Id": parseInt(oid),
					    "ChangeValue": parseInt(pid)
					}]
                };
                myApp.confirm('Are you sure you want to remove this item?', 'GHRA',
					 function () {
					     myApp.showPreloader("Please wait ...");
					     $$.ajax({
					         url: localStorage.AuthKey + "api/Carts/DeleteCart/",
					         type: "POST",
					         async: false,
					         data: results,
					         success: function (data) {
					             myApp.hidePreloader();
					             myApp.alert('Item has been removed from the cart.', 'GHRA', function () {
					                 mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
					             });
					         },
					         error: function (status, xhr) {
					             myApp.hidePreloader();
					             LogError(status, xhr, "deleteItem");
					         }
					     });
					 },
					 function () {
					     myApp.hidePreloader();
					 }
				   );
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "deleteItem");
            }
        });

        $$(document).on('click', '.acceptQty', function (e) {

            try {
                var RowId = parseInt($$(this).data("id"));
                var BatchId = parseInt($$(this).data("batchid"));
                var Price = parseFloat($$(this).data("price"));
                var qtysel = $$(".promoacceptqty[data-id='" + RowId + "']");
                var UserQtyText = $$(".UserQtyText[data-id='" + RowId + "']");
                var UserTotalText = $$(".UserTotalText[data-id='" + RowId + "']");
                if (qtysel.val() === "Accept Quantity?") {
                    myApp.alert("Please select a quantity!")
                } else {

                    myApp.confirm('Are you sure you want to accept this quantities?', 'GHRA',
					 function () {
					     myApp.showPreloader("Please wait ...");
					     $$.ajax({
					         url: localStorage.AuthKey + "api/ghraTobPromotions/PostghraTobPromotion/?RowId=" + RowId + "&UserQty=" + parseInt(qtysel.val()),
					         type: "POST",
					         async: false,
					         //data: { RowId: RowId, UserQty: parseInt(qtysel.val()) },
					         success: function (data) {
					             myApp.hidePreloader();
					             myApp.alert('Thank you for accepting promotion(s).', 'GHRA', function () {
					                 // mainView.router.reloadPage('promotion-details.html?id=' + BatchId);
					                 UserQtyText.html(qtysel.val());
					                 UserTotalText.html(parseFloat(qtysel.val()) * Price);
					                 qtysel.val("Accept Quantity?");
					             });
					         },
					         error: function (status, xhr) {
					             myApp.hidePreloader();
					             LogError(status, xhr, "deleteItem");
					         }
					     });
					 },
					 function () {
					     qtysel.val("Accept Quantity?");
					     myApp.hidePreloader();
					 }
				   );
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "AcceptQuantity");
            }
        });

        $$(document).on('click', '#cancelOrder', function (e) {
            if (hdorderid !== 0) {
                deleteOrder(parseInt(hdorderid));
            }
            hdorderid = 0;
        });

        $$(document).on('click', '#editOrder', function (e) {
            try {
                db.transaction(function (tx) {
                    var cartItems = [];

                    //If order deliverymode is pickup don't show delivery only products ...
                    //$$('#deliverystatus').val("1");

                    var showProducts = '0,1,3';
                    //var Mode = "Pick-Up";
                    if ($$('#deliverystatus').val() === "2" || $$('#deliverystatus').val() === "4") {
                        showProducts = '0,1,2';
                        // Mode = "Delivery";
                    }

                    tx.executeSql('SELECT DPri AS CurrentPrice, ROUND(DPri * Quantity,2) As TotalItemPrice, ID, Description, Size, SKU, SpecialPrice, CategoryName, RegPrice, CaseQty, Quantity FROM Products inner join cart on Products.ProductId = cart.ProductId where Islabel = 0 AND UserId = ? AND Products.InStock in (' + showProducts + ') Order by ID desc', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            for (var i = 0; i < len; ++i) {
                                cartItems.push(results.rows.item(i));
                            }
                            var results = new newRes(cartItems);
                            var cartviewHtml = compilededitOrderDetailTemplate(results);
                            $$('#editorderDetail').html(cartviewHtml);
                            editItemCart = [];
                            myApp.popup('.popup-edit');
                        } else {
                            myApp.alert("Your Cart is empty.");
                        }
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "EditOrder - SelectSQL");
					}, null);

                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "LastOrder - Page");
            }
        });

        $$(document).on('click', '#OrderPallets', function (e) {
            try {
                db.transaction(function (tx) {

                    var palletItems = [];

                    tx.executeSql('SELECT ProductId, DPri, UPri, Description, Size, SKU, SRPer, DFlag, SRPrice, SpecialPrice, CategoryName, RegPrice, CaseQty, SellPack FROM Products where Bulky = 2 Order by Description', [], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            for (var i = 0; i < len; ++i) {
                                palletItems.push(results.rows.item(i));
                            }
                            var results = new newRes(palletItems);
                            var palletItemsHtml = compiledOrderPalletTemplate(results);
                            $$('#palletorders').html(palletItemsHtml);
                            palletItemCart = [];
                            myApp.popup('.popup-pallet');
                        } else {
                            myApp.alert("No Pallet Products found.");
                        }
                    },
                        function (tx, error) {
                            myApp.hidePreloader();
                            LogError(error.message, "", "PalletOrder - SelectSQL");
                        }, null);

                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "LastOrder - Page");
            }
        });

        
        $$(document).on('click', '#edittocart', function () {
            if (editItemCart.length > 0) {
                var j = editItemCart.toString();
                //later delete the items from the cart ..
                editItemCart = [];
                var cart = [];
                db.transaction(function (tx) {

                    tx.executeSql('SELECT UserId, ProductId, Quantity AS Qty, 3 AS isLabel, LabelPrice AS labelPrice, CreateDate, ? AS DeliveryMode, "" As Instruction, MarginLabel FROM Cart where UserId = ? and Id IN (' + j + ') and isLabel = 0', [hdorderid, parseInt(localStorage.userId)], function (tx, results1) {

                        var len = results1.rows.length;
                        for (var i = 0; i < len; ++i) {
                            var t = results1.rows.item(i);
                            cart.push(t);
                        }
                        var results = new newRes(cart);

                        $$.ajax({
                            url: localStorage.AuthKey + "api/Carts/PostCart/?OrderType=2",
                            type: "POST",
                            data: results,
                            dataType: "json",
                            async: false,
                            success: function (data) {
                                //delete items from cart ..

                                db.transaction(function (txt) {
                                    txt.executeSql('DELETE FROM Cart where UserId = ? and Id IN (' + j + ') and isLabel = 0', [parseInt(localStorage.userId)], function (tx, results1) {
                                        getItemQty();
                                        myApp.hidePreloader();
                                    },
                                    function (tx, error) {
                                        myApp.hidePreloader();
                                        LogError(error.message, "", "deleteeditcartbtn - SelectSQL");
                                    }, null);

                                });

                                myApp.hidePreloader();
                                myApp.closeModal();

                                mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
                            },
                            error: function (status, xhr, error) {
                                myApp.hidePreloader();
                                LogError(status, xhr, "checkcartbtn");
                            }
                        });



                    },
                    function (tx, error) {
                        myApp.hidePreloader();
                        LogError(error.message, "", "editcartbtn - SelectSQL");
                    }, null);
                });
            } else {
                myApp.alert('Please select atleast one item.', 'GHRA');
            }
        });


        //Regular Order  = 0
        //Label = 1
        //Return = 2
        //AddOn = 3
        //Pallet = DeliverMode = 5
        $$(document).on('click', '#edittocartall', function () {

            var cart = [];
            db.transaction(function (tx) {

                tx.executeSql('SELECT UserId, ProductId, Quantity AS Qty, 3 AS isLabel, LabelPrice AS labelPrice, CreateDate, ? AS DeliveryMode, "" As Instruction, MarginLabel FROM Cart where UserId = ? and isLabel = 0', [hdorderid, parseInt(localStorage.userId)], function (tx, results1) {

                    var len = results1.rows.length;
                    for (var i = 0; i < len; ++i) {
                        var t = results1.rows.item(i);
                        //t.DeliveryMode = hdorderid;
                        //t.isLabel = 3;
                        //t.Instruction = "";
                        cart.push(t);
                    }
                    var results = new newRes(cart);

                    $$.ajax({
                        url: localStorage.AuthKey + "api/Carts/PostCart/?OrderType=2",
                        type: "POST",
                        data: results,
                        dataType: "json",
                        async: false,
                        success: function (data) {
                            //delete items from cart ..

                            db.transaction(function (txt) {
                                txt.executeSql('DELETE FROM Cart where UserId = ? and isLabel = 0', [parseInt(localStorage.userId)], function (tx, results1) {
                                    getItemQty();
                                    myApp.hidePreloader();
                                },
                                function (tx, error) {
                                    myApp.hidePreloader();
                                    LogError(error.message, "", "deleteeditcartbtn - SelectSQL");
                                }, null);

                            });

                            myApp.hidePreloader();
                            myApp.closeModal();

                            mainView.router.reloadPage('order-historyDetail.html?id=' + hdorderid);
                        },
                        error: function (status, xhr, error) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "checkcartbtn");
                        }
                    });

                },
                    function (tx, error) {
                        myApp.hidePreloader();
                        LogError(error.message, "", "editcartbtn - SelectSQL");
                    }, null);
            });

        });


        $$(document).on('click', '#palletordertocart', function () {

            if (palletItemCart.length > 0) {

                myApp.confirm('Are you sure you want to submit this order?', 'GHRA',
                    function () {

                            var j = palletItemCart.toString();

                            palletItemCart = [];

                            var cart = [];

                            db.transaction(function (tx) {

                    tx.executeSql('SELECT ? AS UserId, ProductId, 1 AS Qty, 0 AS isLabel, 0 AS labelPrice, "04-23-2018 22:28:24" AS CreateDate, "5" AS DeliveryMode, "" As Instruction, 0 AS MarginLabel FROM Products where ProductId IN (' + j + ')', [parseInt(localStorage.userId)], function (tx, results1) {

                        var len = results1.rows.length;
                        for (var i = 0; i < len; ++i) {
                            var t = results1.rows.item(i);
                            cart.push(t);
                        }
                        var results = new newRes(cart);

                        $$.ajax({
                            url: localStorage.AuthKey + "api/Carts/PostCart/?OrderType=2",
                            type: "POST",
                            data: results,
                            dataType: "json",
                            async: false,
                            success: function (data) {
                               
                                myApp.hidePreloader();
                                myApp.closeModal();

                                mainView.router.reloadPage('order-history.html');
                            },
                            error: function (status, xhr, error) {
                                myApp.hidePreloader();
                                LogError(status, xhr, "palletcartbtn");
                            }
                        });

                    },
                        function (tx, error) {
                            myApp.hidePreloader();
                            LogError(error.message, "", "palletordertocart - SelectSQL");
                        }, null);
                });

                    },
                    function () {
                        myApp.hidePreloader();
                    }
                );

            } else {
                myApp.alert('Please select atleast one item.', 'GHRA');
            }
        });

        $$(document).on('click', '.editorderbtn', function () {
            var id = $$(this).data("id");
            var sel = $$(this).html();
            if (sel == 'Selected') {
                $$(this).removeClass('button-fill');
                $$(this).html('Select');
                //add id to editItemCart Array
                editItemCart.splice(editItemCart.indexOf(id), 1);
            } else {
                $$(this).addClass('button-fill');
                $$(this).html('Selected');
                //remove id from editItemCart Array
                if (editItemCart.indexOf(id) === -1) {
                    editItemCart.push(id);
                }
            }
        });

        $$(document).on('click', '.orderpalletbtn', function () {
            var id = $$(this).data("id");
            var sel = $$(this).html();
            if (sel == 'Selected') {
                $$(this).removeClass('button-fill');
                $$(this).html('Select');
                //add id to palletItemCart Array
                palletItemCart.splice(palletItemCart.indexOf(id), 1);
            } else {
                $$(this).addClass('button-fill');
                $$(this).html('Selected');
                //remove id from palletItemCart Array
                if (palletItemCart.indexOf(id) === -1) {
                    palletItemCart.push(id);
                }
            }
        });

        $$(document).on('click', '.popupadd', function (e) {


            oprnscaner = 0;
            var id = $$(this).data("id");
            try {

                db.transaction(function (tx) {
                   // tx.executeSql('SELECT ProductId, c.Margin as CMargin, case when m.perMSRP is null then 0 else m.perMSRP end pMSRP, SKU, p.Description as PDescription, case when SpecialPrice > 0 then round(SpecialPrice, 2) else round(RegPrice, 2) end As CurrentPrice, RegPrice, SpecialPrice, InStock, CaseQty, p.CategoryId, CategoryName, SubCategoryId, SubCategoryName, p.ImageUrl as PImageUrl, SRPrice, SellPack, Size, InStockStatus,  case when m.isMSRP is null then 0 else m.isMSRP end As isMSRP, case when m.perMSRP is null then 0 else case when m.perMSRP > 0 then (ROUND((ROUND((ROUND((((case when SpecialPrice > 0 then round((SpecialPrice / SellPack), 2) else round((RegPrice / SellPack), 2) end) / (100 - (m.perMSRP+0.01-0.01))) * 100),2))+0.05,1)-0.01),2)) else p.SRPrice end end As LabelPrice FROM Products p left join (select Categoryid, isMSRP, perMSRP from SetMsrp where userid = ?) AS m on p.CategoryId = m.CategoryId inner join categories c on p.categoryid = c.categoryid where p.ProductId = ?', [parseInt(localStorage.userId), id],
                    tx.executeSql('SELECT ProductId, m.perMSRP, SKU, IsDiscounted, DiscountReason, Description, RegPrice, DFlag, DPri, UPri, SpecialPrice, InStock, CaseQty, p.CategoryId, CategoryName, SRPrice, SellPack, Size, SRPer, isDSD FROM Products p left join (select CategoryId, isMSRP, perMSRP from SetMsrp where userid = ?) AS m on p.CategoryId = m.CategoryId where p.ProductId = ?', [parseInt(localStorage.userId), id],

                        function (tx, results) {                            
                            var data = results.rows.item(0);
					    var popupHTML = Template7.templates.popupaddTemplate(data);
					    //var popupHTML = compiledpopupaddTemplate(results.rows.item(0));

					    $$("#popupaddContent").html(popupHTML);
					    $$("#quantityid").html(getQtyOptions());
					    myApp.popup('.popup-add');
					},
						 function (tx, error) {
						     myApp.hidePreloader();
						     LogError(error.message, "", "popupadd - SelectSQL");
						 }, null);

                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "popupadd");
            }
        });

        $$(document).on('close', '.popup-add', function () {
            $$("#popupaddContent").html("");
            if (oprnscaner > 0) {
                if (isAndroid) {

                    //setTimeout(function () { }, 1500);
                    scanbarcode();

                } else {
                    scanbarcode();
                }

            } else {
                $$("#scantext").val('');
                $$("#scantext").focus();
            }
        });

        $$(document).on('open', '.popup-edit', function () {

            $$("#editorderspan").html(hdorderid);

        });

        $$(document).on('open', '.popup-add', function () {

            var unitprice = parseFloat($$('#perUnitCost').val().trim());
            var srpcost = parseFloat($$('#srpcost').val().trim());
            var srpper = parseInt($$('#srpper').val().trim());

           

            if (isLblScan) {

                $$("#labeldiv").show();
                $$("#quantitydiv").hide();
                $$("#quantityid").val("0");
                $$('#btnaddtocart').html("Add to Labels");
                var thisval = 0.00;
                var newpercent = 0;
                $$('#displaymsrplabel').html("Label SRP");

                switch (localStorage.lblPref) {
                    case "1":
                        //GHRA SRP
                        newpercent = srpper;
                        thisval = srpcost;
                        $$("#sretailid").val(thisval);
                        $$('#permsrp').val(newpercent);
                        $$('#showmsrplabel').html("(" + newpercent + "%)");
                        break;
                    case "2":
                        //NO PRICE
                        $$('#sretailid').val('0.00');
                        $$('#showmsrplabel').html("");
                        $$('#permsrp').val("0");
                        $$('#displaymsrplabel').html("No Price On Label");
                        $$('#sretailid').hide();
                        break;
                    case "3":
                    case "4":
                        var setmsrp = $$('#setmsrpper').val();
                        if (setmsrp === "" || setmsrp === "0") {
                            //GHRA SRP
                            newpercent = srpper
                            thisval = srpcost;
                            $$('#displaymsrplabel').html("Category MSRP% is not setup - Label SRP");
                        } else {
                            var msrpper = parseInt($$('#setmsrpper').val().trim());
                            if (msrpper > 0) {
                                //User MSRP 
                                if (localStorage.lblPref === "3") {
                                    //Round to 0.9
                                    newpercent = msrpper;
                                    thisval = precisionRound(parseFloat((unitprice * (msrpper / 100)) + unitprice).toFixed(2), 1) - 0.01;
                                    
                                } else {
                                    //No Round
                                    newpercent = msrpper;
                                    thisval = parseFloat((unitprice * (msrpper / 100)) + unitprice).toFixed(2);
                                }
                                
                            } else {
                                //GHRA SRP
                                newpercent = srpper
                                thisval = srpcost;
                                $$('#displaymsrplabel').html("Category MSRP% is not setup - Label SRP");
                            }                            
                        }
                        $$("#sretailid").val(thisval);
                        $$('#permsrp').val(newpercent);
                        $$('#showmsrplabel').html("(" + newpercent + "%)");
                        break;
                    default:
                        $$('#sretailid').val('0.00');
                        $$('#showmsrplabel').html("");
                        $$('#permsrp').val("0");
                        break;
                }

            } else {
                $$("#labeldiv").hide();
                $$("#quantitydiv").show();
                $$('#quantityid option[value="0"]').remove();
                $$("#quantityid").val("1");
                $$('#btnaddtocart').html("Add to Cart");
                $$('#sretailid').val('0');
                $$('#showmsrplabel').html("");
                $$('#displaymsrplabel').html("");
            }

            if (localStorage.CheckInStock) {
                if (localStorage.CheckInStock === '0') { // dont check instock validation
                    $$('#btnaddtocart').removeClass("disabled");
                    $$('#btnaddtocart').removeClass("button-red");
                    $$('#btnaddtocart').addClass("button-green");
                    $$('#btnaddtocart').html("Add to Cart");
                }
            }


            if (isLblScan) {

                $$('#cartExists').hide();
                $$('#viewpurchasedhistorydiv').hide();

            } else {

            $$('#viewpurchasedhistorydiv').show();
            $$('#cartExists').hide();

            //get the product Id and look into cart table .. if exists show cartExists div

            db.transaction(function (tx) {
                var prdid = parseInt($$('#productId').val());
                tx.executeSql('SELECT ID, Quantity From Cart WHERE ProductId = ? AND IsLabel = 0 AND UserId = ?', [prdid, parseInt(localStorage.userId)], function (tx, results) {
                    len = results.rows.length;
                    if (len > 0) {
                        var qty = results.rows.item(0).Quantity;
                        $$('#cartExists').html('This item already exists in the cart. (Quantity: ' + qty + ')')
                        $$('#cartExists').show();
                    }
                },
				  function (tx, error) {
				      myApp.hidePreloader();
				      $$('#cartExists').hide();
				      LogError(error.message, "", "Item Exists in the cart - SelectSQL");

				  }, null);
            });

            }


            if (localStorage.Status !== "2") {
                //isDSD = true ... non-ghra member
                if ($$('#isdsd').val() === "1") {
                    $$('#dsdproductmsg').show();
                    $$('#addtocartdiv').hide();
                    $$("#labeldiv").hide();
                    $$("#quantitydiv").hide();
                }
            }

        });

        $$(document).on('open', '.popup-services', function () {

            if (localStorage.userEmail && localStorage.userMobile) {
                $$("#emailAddress").val(localStorage.userEmail);
                $$("#mobileNumber").val(localStorage.userMobile);
            } else {
                try {
                    if (checkConnection()) {
                        $$.ajax({
                            url: localStorage.AuthKey + "api/AppContacts/GetSingleContact",
                            method: "GET",
                            data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', UserId: parseInt(localStorage.userId) },
                            crossDomain: "false",
                            async: true,
                            beforeSend: function (xhr) {
                            },
                            success: function (response, status, xhr) {
                                var value = JSON.parse(response).results[0];
                                localStorage.userEmail = value.AppEmail;
                                localStorage.userMobile = value.AppPhoneNumber;
                                $$("#emailAddress").val(value.AppEmail);
                                $$("#mobileNumber").val(value.AppPhoneNumber);
                                myApp.hidePreloader();
                            },
                            complete: function (status, xhr) {
                                myApp.hidePreloader();
                            },
                            error: function (status, xhr) {
                                myApp.hidePreloader();
                                LogError(status, xhr, "GetSingleContact");
                            }
                        });
                    } else {
                        myApp.hidePreloader();
                    }
                } catch (e) {
                    myApp.hidePreloader();
                    LogError(e.message, "", "AppContact - Page");
                }

            }

        });

        $$(document).on('close', '.popup-annoucement', function () {
            //alert("IN");
            //$$('#announcementContentpop').html("");
            CheckPromoNotification();
        });

        $$(document).on('touchend', 'a', function () {
            //mainView.router.refreshPage("index.html");
            $$("#toolhome").removeClass("inactiveLink");
        });

        $$(document).on('close', '.login-screen', function () {
            //mainView.router.refreshPage("index.html");
            $$("#toolhome").addClass("inactiveLink");
        });

        $$(document).on('open', '.login-screen', function () {
            $$("#signin").show();
        });

        $$(document).on('close', '.popup-notfound', function () {
            $$("#popupaddContent").html("");
            scantextid = "";
            if (oprnscaner > 0) {
                scanbarcode();
            } else {
                $$("#scantext").val('');
                $$("#scantext").focus();
            }
        });

        $$(document).on('open', '.popup-calculator', function () {
            $$("#demo-calculator").trigger('touchend');
        });

        $$(document).on('click', '.form-to-json', function () {

            var formData = myApp.formToJSON('#my-form');
            var ProductId, Quantity = 0, IsLabel = 0, LabelPrice = 0.00, createDate = getDate();
            try {
                Quantity = parseInt(formData.quantity);
                //TURN ON //localStorage.UserId > 0 && formData.productId > 0
                if (parseInt(formData.productId) > 0 && parseInt(localStorage.userId) > 0) {

                    if (Quantity === 0) {
                        IsLabel = 1;
                    }
                    //} else {
                    //    if (formData.labelSwitch[0] === 'on') {
                    //        IsLabel = 1;
                    //    }
                    //}

                    if (formData.orderSwitch[0] === 'on') {

                        Quantity = Quantity * parseInt(formData.caseQuantity);
                        //Quantity * cases
                    }

                    if (formData.sretail === null || formData.sretail === "") {
                        formData.sretail = LabelPrice;
                    }

                    if (IsLabel === 1) {
                        //insert record for label
                        var len;
                        var newId;
                        db.transaction(function (tx) {
                            tx.executeSql('SELECT ID From Cart WHERE ProductId = ? AND IsLabel = 1 AND UserId = ?', [parseInt(formData.productId), parseInt(localStorage.userId)], function (tx, results) {
                                len = results.rows.length;
                                if (len > 0) {
                                    newId = results.rows.item(0).ID;
                                }
                            },
							  function (tx, error) {
							      myApp.hidePreloader();
							      LogError(error.message, "", "FormToJson - SelectSQL");
							  }, null);
                        });

                        db.transaction(function (tx) {
                            if (len > 0) {
                                tx.executeSql('UPDATE Cart SET LabelPrice = ?, MarginLabel =? WHERE ID = ?', [parseFloat(formData.sretail), parseFloat(formData.permsrp), newId]);
                            } else {
                                tx.executeSql('INSERT INTO Cart (UserId, ProductId, MarginLabel, IsLabel, LabelPrice, CreateDate, Quantity) VALUES(?,?,?,?,?,?,?)', [parseInt(localStorage.userId), parseInt(formData.productId), parseInt(formData.permsrp), 1, parseFloat(formData.sretail), createDate, 0],
										 function (tx, results) {

										 },
										 function (tx, error) {
										     myApp.hidePreloader();
										     LogError(error.message, "", "FormToJson - SelectSQL");
										 }, null);
                            }
                        });
                    }

                    if (parseInt(formData.quantity) > 0) {
                        //Insert record for cart
                        var len;
                        var newId;
                        var newQty;
                        db.transaction(function (tx) {
                            tx.executeSql('SELECT ID, Quantity From Cart WHERE ProductId = ? AND IsLabel = 0 AND UserId = ?', [parseInt(formData.productId), parseInt(localStorage.userId)], function (tx, results) {
                                len = results.rows.length;
                                if (len > 0) {
                                    newId = results.rows.item(0).ID;
                                    newQty = results.rows.item(0).Quantity;
                                }
                            },
							  function (tx, error) {
							      myApp.hidePreloader();
							      LogError(error.message, "", "FormToJson - SelectSQL");
							  }, null);
                        });
                        db.transaction(function (tx) {
                            if (len > 0) {
                                tx.executeSql('UPDATE Cart SET Quantity = ?, MarginLabel =? WHERE ID = ?', [parseInt(newQty) + Quantity, parseFloat(formData.permsrp), newId],
										 function (tx, results) {

										 },
										 function (tx, error) {
										     myApp.hidePreloader();
										     LogError(error.message, "", "FormToJson - SelectSQL");
										 }, null);
                            } else {
                                tx.executeSql('INSERT INTO Cart (UserId, ProductId, Quantity, IsLabel, LabelPrice, CreateDate, marginlabel) VALUES(?,?,?,?,?,?,?)', [parseInt(localStorage.userId), parseInt(formData.productId), Quantity, 0, LabelPrice, createDate, parseFloat(formData.permsrp)],
										 function (tx, results) {

										 },
										 function (tx, error) {
										     myApp.hidePreloader();
										     LogError(error.message, "", "FormToJson - SelectSQL");
										 }, null);
                            }
                        });

                        myApp.closeModal();
                        getItemQty();

                    } else {

                        myApp.closeModal();
                        getItemQty();
                    }
                    toast.show("Item(s) have been added to your cart!");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "formToJson");
            }
        });

        $$(document).on('ajaxStart', function (e) {

            myApp.showPreloader('Loading ...');
        });

        $$(document).on('ajaxError', function (e) {
            myApp.hidePreloader();
            myApp.alert('Communication Error!!! Check Connection.');
        });

        $$(document).on('ajaxComplete', function (e) {

            myApp.hidePreloader();
        });

        //ASIF 20170214
        $$(document).on('click', '.itemReturn', function (e) {
            try {
                var t = $$(this);

                var pid = parseInt($$(this).data("id"));
                var oid = parseInt($$(this).data("orderid"));
                var price = parseFloat($$(this).data("price"));
                var qtysel = $$(".returnqty[data-id='" + pid + "']");
                if (qtysel.val() === "Return Quantity?") {
                    myApp.alert("Please select a return quantity!")
                } else {

                    var qtyselopt = $$(".returnqty[data-id='" + pid + "'] option[value='Return Quantity?']");
                    var qty = parseInt(qtysel.val());
                    myApp.confirm('Are you sure you want to return this item?', 'GHRA',
						function () {
						    myApp.showPreloader('Processing Return ...');
						    t.attr('disabled', 'disabled');
						    qtysel.attr('disabled', '');
						    db.transaction(function (tx) {
						        tx.executeSql('Delete from Cart where UserId = ? and ProductId = ? and MarginLabel = ? and IsLabel = ?', [parseInt(localStorage.userId), pid, oid, 2],
								function (tx, results) {
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "itemReturnDelete - SelectSQL");
								}, null);

						        tx.executeSql('INSERT INTO Cart (UserId, ProductId, Quantity, IsLabel, DeliveryMode, LabelPrice, CreateDate, marginlabel) VALUES(?,?,?,?,?,?,?,?)', [parseInt(localStorage.userId), pid, qty, 2, '4', price, getDate(), oid],
								function (tx, results) {
								    myApp.hidePreloader();
								    myApp.alert('Item has been added to the return cart. You can view your returns in the cart.');
								    // qtyselopt.prop("selected", "selected");
								    //$$(this).removeAttr('disabled');
								    //qtysel.removeAttr('disabled');
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "itemReturn - SelectSQL");
								}, null);
						    });
						},
						function () {
						    t.removeAttr('disabled');
						    qtyselopt.prop("selected", "selected");
						}
					);

                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "itemReturn");
            }
        });

        $$(document).on('change', '#quantityid', function () {
            var cost = parseFloat($$("#productCost").val());
            var caseQty = parseInt($$("#caseQuantity").val());
            var qty = parseInt($$(this).val());
           
            try {
                //productPrice //productCost
                //$$('#casediv').show();
               // $$('#labeldiv').show();
              //  $$('#sretailid').attr('disabled', 'disabled');
                //if ($$('#labelSwitchid').is(':checked')) {
                //    $$('#sretailid').removeAttr('disabled');
                //}
               // $$('#btnaddtocart').text('Add to Cart');
                //if ($$(this).val() === "0") {
                //    //$$('#casediv').hide();
                //    $$('#labeldiv').hide();
                //    $$('#sretailid').removeAttr('disabled');
                //    $$('#btnaddtocart').text('Order Label');
                //    $$(".productPrice").html((cost).toFixed(2));
                //} else {
                    var formData = myApp.formToJSON('#my-form');
                    if (formData.orderSwitch[0] === 'on') {
                        $$(".productPrice").html((cost * caseQty * qty).toFixed(2));
                    } else {
                        $$(".productPrice").html((cost * qty).toFixed(2));
                    }

               // }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "quantityid");
            }
        });

        //$$(document).on('change', '#labelSwitchid', function () {
        //    try {

        //        $$('#sretailid').attr('disabled', 'disabled');

        //        if ($$(this).is(':checked')) {
        //            $$('#sretailid').removeAttr('disabled');
        //        }
        //    } catch (e) {
        //        myApp.hidePreloader();
        //        LogError(e.message, "", "labelSwitchid");
        //    }
        //});

        $$(document).on('click', '.itemRemove', function (event) {
            try {
                var thisId = parseInt($$(this).data("id"));
                if (thisId > 0) {
                    db.transaction(function (tx) {
                        tx.executeSql('DELETE FROM CART where ID = ? AND CART.UserId = ?', [thisId, parseInt(localStorage.userId)], function (tx, results) {
                            getItemQty();
                            refreshCart();
                            // mainView.router.refreshPage();
                        },
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "itemRemove - SelectSQL");
						}, null);
                    });
                    toast.show("Item has been removed from your cart!");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "itemRemove");
            }
        });

        $$(document).on('click', '.updateQty', function (event) {
            try {
                var thisId = parseInt($$(this).data("id"));
                var cartSelector = "#cartQty" + thisId.toString();
                var inputqty = $$(cartSelector).val();
                if (thisId > 0 && inputqty > 0) {
                    db.transaction(function (tx) {
                        tx.executeSql('UPDATE CART SET Quantity = ? where ID = ? AND CART.UserId = ?', [inputqty, thisId, parseInt(localStorage.userId)], function (tx, results) {
                            getItemQty();
                            refreshCart();
                            toast.show("Item quantity has been updated!");
                        },
						   function (tx, error) {
						       myApp.hidePreloader();
						       LogError(error.message, "", "updateQty - SelectSQL");
						   }, null);
                    });
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "updateQty");
            }
        });

        $$(document).on('focusout', '.cartQty', function (event) {
            try {
                var value = parseInt($$(this).val());
                if (!isNaN(value)) {
                    if (value <= 0) {
                        $$(this).val('1');
                    }
                } else {
                    $$(this).val('1');
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "cartQty");
            }
        });

        $$(document).on('click', '.labelRemove', function (event) {
            var thisId = parseInt($$(this).data("id"));
            var lblqty = parseInt($$("#labelQty").html());
            var cartTotalItems = parseInt($$(".cartTotalItems").html());
            var retqty = parseInt($$("#returnsQty").html());
            var thisparent = $$(this).parents(".contentblocklbl");
            try {
                //Delete from cart ...
                db.transaction(function (tx) {
                    tx.executeSql('DELETE FROM CART where ID = ? AND CART.UserId = ?', [thisId, parseInt(localStorage.userId)], function (tx, results) {
                        var newqty = lblqty - 1;
                        if (newqty <= 0) {
                            newqty = 0;
                        }
                        var totalqty = cartTotalItems + newqty + retqty;
                        if (totalqty <= 0) {
                            $$("#chkoutbtn").attr('disabled', 'disabled');
                        }
                        $$("#labelQty").html(newqty);
                        thisparent.remove();
                        toast.show("Label has been removed from your cart!");
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "labelRemove - SelectSQL");
					}, null);
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "labelRemove");
            }
        });

        $$(document).on('click', '.returnsRemove', function (event) {
            var thisId = parseInt($$(this).data("id"));
            var thisQty = parseInt($$(this).data("value"));
            var retqty = parseInt($$("#returnsQty").html());
            var cartTotalItems = parseInt($$(".cartTotalItems").html());
            var lblqty = parseInt($$("#labelQty").html());
            var thisparent = $$(this).parents(".contentblocklbl");
            try {
                //Delete from cart ...
                db.transaction(function (tx) {
                    tx.executeSql('DELETE FROM CART where ID = ? AND CART.UserId = ?', [thisId, parseInt(localStorage.userId)], function (tx, results) {
                        var newqty = retqty - thisQty;
                        if (newqty <= 0) {
                            newqty = 0;
                        }
                        var totalqty = cartTotalItems + newqty + lblqty;
                        $$("#returnsQty").html(newqty);
                        if (totalqty <= 0) {
                            $$("#chkoutbtn").attr('disabled', 'disabled');
                        }
                        thisparent.remove();
                        toast.show("Return has been removed from your cart!");
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "returnRemove - SelectSQL");
					}, null);
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "returnRemove");
            }
        });

        $$(document).on('submit', '#target', function (event) {
            try {
                event.preventDefault();
                $$('#scantext').blur();
                oprnscaner = 0;
                var id = $$('#scantext').val();
                var pid = 0;
               
                db.transaction(function (tx) {
                    tx.executeSql('SELECT ProductId FROM UPC where UPC = ?', [id],
					function (tx, results) {
					    if (results.rows.length > 0) {
					        pid = results.rows.item(0).ProductId;
                        }
                       
					},
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "target - SelectSQL");
					}, null);

                });

                db.transaction(function (tx) {
                    tx.executeSql('SELECT ProductId, m.perMSRP, SKU, IsDiscounted, DiscountReason, Description, RegPrice, DFlag, DPri, UPri, SpecialPrice, InStock, CaseQty, p.CategoryId, CategoryName, SRPrice, SellPack, Size, SRPer, isDSD FROM Products p left join (select CategoryId, isMSRP, perMSRP from SetMsrp where userid = ?) AS m on p.CategoryId = m.CategoryId where p.ProductId = ?', [parseInt(localStorage.userId), parseInt(pid)],
				function (tx, results) {
                    var len = results.rows.length;
                    
				    if (len > 0) {
				        var data = results.rows.item(0);
				        var popupHTML = Template7.templates.popupaddTemplate(data);

				        $$("#popupaddContent").html(popupHTML);
				        $$("#quantityid").html(getQtyOptions());
				        Keyboard.hide();
				        myApp.popup('.popup-add');
				    } else {
				        scantextid = id;
				        $$('#scantextval').html(scantextid);
				        getMissingUPC(id, 1);
				        Keyboard.hide();
				        myApp.popup('.popup-notfound');
				    }
				},
                function (tx, error) {
				    myApp.hidePreloader();
				    LogError(error.message, "", "target - SelectSQL");
				}, null);

                });



            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "target");
            }
        });

        $$(document).on('touchend', '.item-msrp', function () {
            var thisId = parseInt($$(this).data("id"));
            var itemSelector = "#subitems" + thisId.toString();
            var checkexpand = $$(itemSelector).css("height") === "0px";
            try {
                if (checkexpand) {
                    $$(itemSelector).css("height", "auto");
                }


                db.transaction(function (tx) {
                    var subCatItem = [];
                    tx.executeSql('SELECT Description FROM SubCategories where CategoryId = ?', [thisId], function (tx, results) {
                        var len = results.rows.length;
                        for (var i = 0; i < len; ++i) {
                            subCatItem.push(results.rows.item(i));
                        }

                        var results = new newRes(subCatItem);
                        var subCatItemHtml = compiledsubcatTemplate(results);
                        $$(itemSelector).html(subCatItemHtml);

                    },
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "item-msrp - SelectSQL");
						}, null);

                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "item-msrp");
            }
        });

        $$(document).on('change', '.msrpcheck', function () {
            myApp.showPreloader('Please Wait ...');
            var thisId = parseInt($$(this).data("id"));
            var msrpchecked = 0;
            try {
                if ($$(this).is(':checked')) {
                    msrpchecked = 1;
                }

                var checkid = 0;

                db.transaction(function (tx) {

                    tx.executeSql('SELECT ID FROM SetMsrp where CategoryId = ? and UserId = ?', [thisId, parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).ID > 0) {
                                checkid = results.rows.item(0).ID;
                            }
                        }

                    },
					   function (tx, error) {
					       myApp.hidePreloader();
					       LogError(error.message, "", "msrpcheck - SelectSQL");
					   }, null);
                });

                db.transaction(function (tx) {
                    if (checkid > 0) {

                        tx.executeSql('UPDATE SetMsrp SET isMSRP = ? where CategoryId = ? and UserId = ?', [msrpchecked, thisId, parseInt(localStorage.userId)],
						function (tx, results) {
						},
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "msrpcheck - SelectSQL");
						}, null);
                    
                        myApp.hidePreloader();
                    } else {
                        
                        tx.executeSql('INSERT INTO SetMsrp (CategoryId, isMSRP, perMSRP, UserId) VALUES (?,?,?,?)', [thisId, msrpchecked, 0, parseInt(localStorage.userId)],
						function (tx, results) {
						},
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "msrpcheck - SelectSQL");
						}, null);
                        myApp.hidePreloader();
                    }
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "msrpcheck");
            }
        });

        $$(document).on('mouseup touchend', '.msrpslider', function () {
            myApp.showPreloader('Please Wait ...');
            var thisId = parseInt($$(this).data("id"));
            var permsrp = parseInt($$(this).val());
            var checkid = 0;
            try {
                
                db.transaction(function (tx) {

                    tx.executeSql('SELECT ID FROM SetMsrp where CategoryId = ? and UserId = ?', [thisId, parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).ID > 0) {
                                checkid = results.rows.item(0).ID;
                            }
                        }

                    },
							function (tx, error) {
							    myApp.hidePreloader();
							    LogError(error.message, "", "msrpslider - SelectSQL");
							}, null);
                });

                db.transaction(function (tx) {
                    if (checkid > 0) {

                        tx.executeSql('UPDATE SetMsrp SET perMSRP = ? where CategoryId = ? and UserId = ?', [permsrp, thisId, parseInt(localStorage.userId)],
								function (tx, results) {
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "msrpslider - SelectSQL");
								}, null);
                        
                        myApp.hidePreloader();
                    } else {
                        
                        tx.executeSql('INSERT INTO SetMsrp (CategoryId, isMSRP, perMSRP, UserId) VALUES (?,?,?,?)', [thisId, 0, permsrp, parseInt(localStorage.userId)],
								function (tx, results) {
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "msrpslider - SelectSQL");
								}, null);
                        myApp.hidePreloader();
                    }
                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "msrpslider");
            }
        });

        $$(document).on('input', '.msrpslider', function () {
            try {
                var thisId = parseInt($$(this).data("id"));
                var cartSelector = "#msrpoutput" + thisId.toString();
                $$(cartSelector).html($$(this).val());
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "msrpslider");
            }
        });

        $$(document).on('submit', '#searchProduct', function (event) {
            event.preventDefault();
        });

        $$(document).on('keyup', '#mainSearch', function (event) {
            
            
            try {
                
                db.transaction(function (tx) {
                    var searchItems = [];
                    var searchText = $$('#mainSearch').val();
                    if (searchText.length >= 3) {
                        tx.executeSql('SELECT ProductId, SKU, Description, RegPrice, SpecialPrice, IsFeature, IsPromotion, IsNew, CategoryId, CategoryName, IsTobacco, SRPrice, SellPack, Size, Status, Bulky, IsDiscounted, DiscountPrice, DiscountReason, CaseQty, isDSD, InStock, DPri, DFlag, UPri, SRPer FROM Products where Description LIKE ? or SKU LIKE ? order by Description', ["%" + searchText + "%", "%" + searchText + "%"], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                                $$('#searchnotfound').hide();
                                for (var i = 0; i < len; ++i) {
                                    searchItems.push(results.rows.item(i));
                                }

                                var results = new newRes(searchItems);

                                var ProductListHtml = compiledproductTemplate(results);
                                $$('#searchType').html(ProductListHtml);
                                getMissingUPC(searchText, 2);

                            } else {
                                $$('#searchType').html("");
                                $$('#searchnotfound').show();
                                getMissingUPC(searchText, 3);
                            }
                        },
							function (tx, error) {
							    myApp.hidePreloader();
							    LogError(error.message, "", "searchProduct - SelectSQL");
							}, null);
                    } else {
                        $$('#searchType').html("");
                    }

                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "searchProduct");
            }
        });

        $$(document).on('click', '#sendErrorBtn', function (event) {
            var errorLog = [];
            try {
                if (checkConnection()) {
                    db.transaction(function (tx) {
                        tx.executeSql('SELECT UserId, ErrDate, ErrMessage, PhoneType FROM ErrorLog where UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                                for (var i = 0; i < len; ++i) {
                                    errorLog.push(results.rows.item(i));
                                }

                                var results = new newRes(errorLog);

                                $$.ajax({
                                    url: localStorage.AuthKey + "api/ErrLogs/PostMobErrLog",
                                    type: "POST",
                                    data: results,
                                    dataType: "json",
                                    async: false,
                                    success: function (data) {
                                        myApp.alert('Error(s) have been sent successfully to IT support. You will be contacted soon.');
                                    },
                                    error: function (status, xhr) {
                                        myApp.hidePreloader();
                                        LogError(status, xhr, "sendErrorBtn");
                                    }
                                });
                            } else {
                                myApp.alert("No Error Logs");
                            }
                        },
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "sendErrorBtn - SelectSQL");
								}, null);
                    });

                    db.transaction(function (tx) {
                        tx.executeSql('DELETE FROM ErrorLog where UserId = ?', [parseInt(localStorage.userId)],
								function (tx, results) {
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "sendErrorBtn - SelectSQL");
								}, null);
                    });
                } else {
                    myApp.alert("Please Check Your Internet Connection!!", "sendErrorBtn");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "sendErrorBtn");
            }
        });

        $$(document).on('click', '#chkoutbtn', function (event) {
        });

        $$(document).on('click', '#lastorderchkoutbtn', function (event) {
            var cart = [];
            try {
                if (checkConnection()) {
                    $$(this).attr('disabled', 'disabled');
                    db.transaction(function (tx) {
                        tx.executeSql('SELECT UserId, ProductId, Quantity AS Qty, IsLabel AS isLabel, LabelPrice AS labelPrice, CreateDate, DeliveryMode, OrderInstruction As Instruction, MarginLabel FROM History where UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                                for (var i = 0; i < len; ++i) {
                                    cart.push(results.rows.item(i));
                                }
                                results = new newRes(cart);
                                $$.ajax({
                                    url: localStorage.AuthKey + "api/Carts/PostCart/?OrderType=2",
                                    type: "POST",
                                    data: results,
                                    dataType: "json",
                                    async: false,
                                    success: function (data) {
                                        myApp.alert('Your order has been submitted successfully. If you want to cancel this order, please do so now, if not this order will be processed.', 'GHRA', function () {
                                            mainView.router.loadPage('order-history.html');
                                        });
                                    },
                                    error: function (status, xhr) {
                                        myApp.hidePreloader();
                                        LogError(status, xhr, "lastorderchkoutbtn-F");
                                    }
                                });
                            } else {
                                myApp.alert("Empty Order");
                            }
                        },
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "lastorderchkoutbtn - SelectSQL");
								}, null);

                    });
                } else {
                    myApp.hidePreloader();
                    myApp.alert("Please Check Your Internet Connection!!", "lastorderchkoutbtn4");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "lastorderchkoutbtn");
            }
        });

        $$(document).on('click', '#checkcartbtn', function (event) {
            var GroAmount = 0.00;
            var TobAmount = 0.00;
            var pqty = 0.00;
            var cart = [];
            var missing = [];
            var results;
            var deliveryonlyproducts = 0;
            var pickuponlyproducts = 0;
            var popupshow = false;
            var delivery = true;
            var customerEmail = $$('#customerEmail').val().trim();
            var customerPhone = $$('#customerPhone').val().trim();
            var poptext = "Are you sure you want to submit the cart?"
            try {
                if (checkConnection()) {

                    if ($$('#deliverymodeselect').val() != "0" && customerEmail.length >= 7 && customerPhone.length >= 10) {

                        //if status is pickup.. check for delivery-only items
                        db.transaction(function (tx) {
                            if ($$('#deliverymodeselect').val() === "1") {
                                tx.executeSql('Select Count(Id) as DeliveryCount from Cart INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 and Products.InStock = 2 AND CART.UserId = ?', [parseInt(localStorage.userId)],
                                    function (tx, results) {
                                        if (results.rows.item(0).DeliveryCount > 0) {
                                            deliveryonlyproducts = results.rows.item(0).DeliveryCount;
                                            popupshow = true;
                                            poptext = "You have a Delivery-Only item(s) in your cart, please review it.  If you still want to continue it will remove Delivery-Only item(s) from your cart before submitting it. Do you want to continue?"
                                        }
                                    },
                                    function (tx, error) {
                                        myApp.hidePreloader();
                                        LogError(error.message, "", "DeliveryProductCount - SelectSQL");
                                    }, null);
                            }
                        });

                        //if status is delivery or 25 delivery.. check for pickup-only items
                        db.transaction(function (tx) {
                            if ($$('#deliverymodeselect').val() === "2" || $$('#deliverymodeselect').val() === "4") {
                                tx.executeSql('Select Count(Id) as PickupCount from Cart INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 and Products.InStock = 3 AND CART.UserId = ?', [parseInt(localStorage.userId)],
                                    function (tx, results) {
                                        if (results.rows.item(0).PickupCount > 0) {
                                            pickuponlyproducts = results.rows.item(0).PickupCount;
                                            popupshow = true;
                                            poptext = "You have a Pickup-Only item(s) in your cart, please review it.  If you still want to continue it will remove Pickup-Only item(s) from your cart before submitting it. Do you want to continue?"
                                        }
                                    },
                                    function (tx, error) {
                                        myApp.hidePreloader();
                                        LogError(error.message, "", "PickupProductCount - SelectSQL");
                                    }, null);
                            }
                        });

                        db.transaction(function (txt) {
                            myApp.confirm(poptext, 'GHRA',
					            function () {
					                $$("#checkcartbtn").hide();
					                $$("#processingbtn").show();
					                myApp.showPreloader("Please wait ...");
					                if (popupshow) {
					                    db.transaction(function (tx) {
					                        var query = "";
					                        if (deliveryonlyproducts > 0) {
					                            //delete products where instock = 2 from cart
					                            query = "delete from Cart where ProductId IN (select cart.ProductId from Cart INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 and Products.InStock = 2 AND CART.UserId = ?) and cart.UserId = ?";
					                        }
					                        if (pickuponlyproducts > 0) {
					                            //delete products where instock = 3 from cart
					                            query = "delete from Cart where ProductId IN (select cart.ProductId from Cart INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 and Products.InStock = 3 AND CART.UserId = ?) and cart.UserId = ?";
					                        }
					                        tx.executeSql(query, [parseInt(localStorage.userId), parseInt(localStorage.userId)],
                                                    function (tx, results) {
                                                        myApp.hidePreloader();
                                                        /// check if eligible for delivery ...

                                                    },
                                                    function (tx, error) {
                                                        myApp.hidePreloader();
                                                        LogError(error.message, "", "deletedeliverypickupcart - SelectSQL");
                                                    }, null);
					                    });
					                }

					                db.transaction(function (tx) {
					                    if ($$('#deliverymodeselect').val() === "2" || $$('#deliverymodeselect').val() === "4") {
					                        if (localStorage.rule === "1") {
					                            tx.executeSql('select sum(OrderQty) As OrderQty, sum(GroceryAmount) As GroAmount, sum(TobaccoAmount) As TobAmount from (select sum(o.Quantity) As OrderQty, case when p.IsTobacco = 0 then sum(o.Quantity * (case when p.SpecialPrice <= 0 then p.RegPrice else p.SpecialPrice end)) else 0 end As GroceryAmount, case when p.IsTobacco = 1 then sum(o.Quantity * (case when p.SpecialPrice <= 0 then p.RegPrice else p.SpecialPrice end)) else 0 end As TobaccoAmount from CART o inner join Products p on p.ProductId = o.ProductId where o.isLabel = 0 AND o.UserId = ? group by p.IsTobacco) Src', [parseInt(localStorage.userId)], function (tx, results) {
					                                var len = results.rows.length;

					                                if (len > 0) {

					                                    if (results.rows.item(0).TobAmount != null) {
					                                        $$('#totalTobacco').html("$" + results.rows.item(0).TobAmount.toFixed(2));
					                                        TobAmount = parseFloat(results.rows.item(0).TobAmount.toFixed(2));
					                                    } else {
					                                        TobAmount = 0;
					                                        $$('#totalTobacco').html("$0.00");
					                                    }
					                                    if (results.rows.item(0).GroAmount != null) {
					                                        $$('#totalMarchandies').html("$" + results.rows.item(0).GroAmount.toFixed(2));
					                                        GroAmount = parseFloat(results.rows.item(0).GroAmount.toFixed(2));
					                                    } else {
					                                        GroAmount = 0;
					                                        $$('#totalMarchandies').html("$0.00");
					                                    }
					                                    if (results.rows.item(0).OrderQty != null) {
					                                        pqty = parseInt(results.rows.item(0).OrderQty);
					                                        $$('#productsQuantity').html(results.rows.item(0).OrderQty);
					                                    } else {
					                                        $$('#productsQuantity').html("0");
					                                    }

					                                } else {
					                                    delivery = false;

					                                    pqty = 0;
					                                    $$('#totalTobacco').html("$0.00");
					                                    $$('#totalMarchandies').html("$0.00");
					                                    $$('#productsQuantity').html("0");
					                                }

					                            },
                                                    function (tx, error) {
                                                        myApp.hidePreloader();
                                                        LogError(error.message, "", "CheckOutOrdersTotal - SelectSQL");
                                                    }, null);




					                        }
					                    }

					                });

					                db.transaction(function (tx) {
					                    if ($$('#deliverymodeselect').val() === "1") {
					                        // pickup
					                        delivery = true;
					                    }
					                    if ($$('#deliverymodeselect').val() === "2" || $$('#deliverymodeselect').val() === "4") {


					                        tx.executeSql('SELECT ROGen, ROTob, RTGen, RTHTob, PaidRuleTob, PaidRuleGro FROM ServerDate', [], function (tx, results) {
					                            var serverResult = results.rows.item(0);

					                            if (localStorage.ACH) {

					                                if (localStorage.ACH === "Both") {
					                                   

					                                    if (TobAmount >= serverResult.ROTob && GroAmount >= serverResult.ROGen) {

					                                       
					                                        delivery = true;

					                                    } else if (TobAmount >= 0 && GroAmount >= serverResult.RTGen) {

					                                        
					                                        delivery = true;

					                                    } else if (TobAmount >= serverResult.RTHTob && GroAmount >= 0) {

					                                       
					                                        delivery = true;

					                                    } else if (TobAmount >= serverResult.PaidRuleTob && GroAmount >= serverResult.PaidRuleGro) {

					                                        
					                                        delivery = true;

					                                    } else {

					                                        
					                                        delivery = false;

					                                    }

					                                } else {


					                                    
					                                    delivery = false;

					                                }
					                            }
					                            else {
					                                

					                                delivery = false;

					                            }
					                        },
                                            function (tx, error) {
                                                myApp.hidePreloader();
                                                LogError(error.message, "", "DeliveryRuleafterdelete - SelectSQL");
                                            }, null);


					                    }

					                });

					                db.transaction(function (tx) {
					                    var results = {
					                        "results": [
                                            {
                                                "CustomerId": parseInt(localStorage.userId),
                                                "ModelDescription": "Model: " + device.model + " - Platform: " + device.platform + " - UUID: " + device.uuid + " - Version: " + device.version + " - Manufacturer: " + device.manufacturer + " - Serial: " + device.serial + "",
                                                "AppVersion": versionnumber
                                            }]
					                    };

					                    $$.ajax({
					                        url: localStorage.AuthKey + "api/DeviceInfoes/PostDeviceInfo/",
					                        type: "POST",
					                        async: false,
					                        data: results,
					                        success: function (data) {
					                        },
					                        error: function (status, xhr) {
					                            LogError(status, xhr, "deleteItem");
					                        }
					                    });

					                });

					                db.transaction(function (tx) {
					                    tx.executeSql('SELECT UserId, UPC, TypeId, SubmittedDate FROM MissingUPC', [], function (tx, results) {
					                        var len = results.rows.length;
					                        if (len > 0) {
					                            for (var i = 0; i < len; ++i) {
					                                missing.push(results.rows.item(i));
					                            }
					                            results = new newRes(missing);
					                            $$.ajax({
					                                url: localStorage.AuthKey + "api/MissUPC/PostMissingUPC",
					                                type: "POST",
					                                data: results,
					                                dataType: "json",
					                                async: false,
					                                success: function (data) {
					                                    myApp.hidePreloader();
					                                },
					                                error: function (status, xhr) {
					                                    myApp.hidePreloader();
					                                    LogError(status, xhr, "checkcartbtn - missingUPC");
					                                }
					                            });
					                        }


					                    },
                                        function (tx, error) {
                                            myApp.hidePreloader();
                                            LogError(error.message, "", "checkcartbtn - MissingSelectSQL");
                                        }, null);
					                });
					                db.transaction(function (tx) {
					                    tx.executeSql('DELETE FROM MissingUPC', [], function (tx, results) {
					                        myApp.hidePreloader();
					                    },
                                                function (tx, error) {
                                                    myApp.hidePreloader();
                                                    LogError(error.message, "", "checkcartbtn - MissingDeleteSQL");
                                                }, null);
					                });
					                db.transaction(function (tx) {
					                    var deliverymode = $$('#deliverymodeselect').val();
                                        var orderinstruction = $$('#comments').val() + " Email: " + customerEmail + " Phone: " + customerPhone;
					                    tx.executeSql('Update Cart SET DeliveryMode = ?, OrderInstruction = ? where UserId = ? and IsLabel IN (0,1,2)', [deliverymode, orderinstruction, parseInt(localStorage.userId)],
                                                function (tx, results) {
                                                    myApp.hidePreloader();
                                                },
                                                function (tx, error) {
                                                    myApp.hidePreloader();
                                                    LogError(error.message, "", "checkcartbtn - SelectSQL");
                                                }, null);
					                });
					                db.transaction(function (tx) {
					                    tx.executeSql('SELECT UserId, ProductId, Quantity AS Qty, IsLabel AS isLabel, LabelPrice AS labelPrice, CreateDate, DeliveryMode, OrderInstruction As Instruction, MarginLabel FROM Cart where UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
					                        var len = results.rows.length;
					                        if (len > 0) {
					                            if (delivery === true) {

					                                for (var i = 0; i < len; ++i) {
					                                    cart.push(results.rows.item(i));
					                                }
					                                results = new newRes(cart);
					                                $$.ajax({
					                                    url: localStorage.AuthKey + "api/Carts/PostCart/?OrderType=2",
					                                    type: "POST",
					                                    data: results,
					                                    dataType: "json",
					                                    async: false,
					                                    success: function (data) {
					                                        saveHistory(results);
					                                        getItemQty();
					                                    },
					                                    error: function (status, xhr) {
					                                        myApp.hidePreloader();
					                                        LogError(status, xhr, "checkcartbtn");
					                                    }
					                                });
					                            } else {
					                                myApp.alert("This order is not eligible for the delivery. Please review your cart.", function () {
					                                    getItemQty();
					                                    mainView.router.reloadPage('view-cart.html');
					                                    mainView.router.back();
					                                    return false;
					                                });
					                            }
					                        } else {
					                            myApp.hidePreloader();
					                            myApp.alert("Cart is empty!", function () {
					                                $$('#grandTotal').html("$0.00");
					                                $$('#totalTobacco').html("$0.00");
					                                $$('#totalMarchandies').html("$0.00");
					                                getItemQty();
					                                mainView.router.reloadPage('view-cart.html');
					                                mainView.router.back();
					                                return false;
					                            });
					                        }
					                    },
                                        function (tx, error) {
                                            myApp.hidePreloader();
                                            LogError(error.message, "", "checkcartbtn - SelectSQL");
                                        }, null);
					                });
					            },
					            function () {
					                myApp.hidePreloader();
					            }
				           );
                        });

                    } else {
                        myApp.hidePreloader();
                       
                        if ($$('#deliverymodeselect').val() === "0") {
                            myApp.alert("Please select shipping method!!", "Shipping Method");
                        }
                        if (customerEmail.length < 6) {
                            myApp.alert("Email is required!", "Email");
                        }
                        if (customerPhone.length < 10) {
                            myApp.alert("Phone Number is required!", "Phone Number");
                        }
                    }

                } else {

                    myApp.hidePreloader();
                    myApp.alert("Please Check Your Internet Connection!!", "Internet Connection");
                }

            } catch (e) {

                myApp.hidePreloader();
                $$(this).hide();
                $$("#processingbtn").html("Error ....");
                $$("#processingbtn").show();
                LogError(e.message, "", "checkcartbtn");
            }
        });

        function getUserInfo() {
            try {
                var email = $$('#emailAddress').val();
                var mobile = $$('#mobileNumber').val();
                localStorage.userEmail = email;
                localStorage.userMobile = mobile;

                var results = {
                    "results": [
					{
					    "UserId": parseInt(localStorage.userId),
					    "AppPhoneNumber": localStorage.userMobile,
					    "AppEmail": localStorage.userEmail,
					    "CreationDate": getDate()
					}]
                };

                $$.ajax({
                    url: localStorage.AuthKey + "api/AppContacts/PostAppContact/",
                    type: "POST",
                    data: results,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        myApp.alert('Your contact info has been updated.', 'GHRA', function () {
                            myApp.closeModal();
                        });
                    },
                    error: function (status, xhr) {
                        myApp.hidePreloader();
                        LogError(status, xhr, "sendErrorBtn");
                    }
                });

            }
            catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getUserInfo");
            }
        }

        function EmailCart() {
            try {
                var cart = [];
                if (checkConnection()) {
                    db.transaction(function (tx) {
                        tx.executeSql('SELECT UserId, ProductId, Quantity AS Qty, IsLabel AS isLabel, LabelPrice AS labelPrice, CreateDate, DeliveryMode, OrderInstruction As Instruction, MarginLabel FROM Cart where UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                            var len = results.rows.length;
                            if (len > 0) {
                                for (var i = 0; i < len; ++i) {
                                    var obj = results.rows.item(i);
                                    obj.SiteId = appCompanyId;
                                    obj.UserName = localStorage.userName;
                                    cart.push(obj);
                                }
                                results = new newRes(cart);
                                $$.ajax({
                                    url: "https://www.ghrawarehouseapi.com/api/CartITFs/PostCartITF/?SiteId=" + appCompanyId,
                                    type: "POST",
                                    data: results,
                                    dataType: "json",
                                    async: false,
                                    success: function (data) {
                                        myApp.alert("Your cart data has been submitted!");
                                    },
                                    error: function (status, xhr) {
                                        myApp.hidePreloader();
                                        LogError(status, xhr, "Licenses");
                                    }
                                });

                            } else {
                                myApp.alert("No Item in the Cart!");
                            }

                        },
					  function (tx, error) {
					      myApp.hidePreloader();
					      LogError(error.message, "", "EmailCart - SelectSQL");
					  }, null);

                    });
                } else {
                    myApp.alert("Please Check Your Internet Connection!!", "getKey");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "EmailCart");
            }
        }

        function saveHistory(results) {
            try {
                db.transaction(function (tx) {
                    tx.executeSql('DELETE FROM History where UserId = ?', [parseInt(localStorage.userId)],
										 function (tx, results) {

										 },
										 function (tx, error) {
										     myApp.hidePreloader();
										     LogError(error.message, "", "saveHistory - SelectSQL");
										 }, null);
                });

                db.transaction(function (tx) {
                    var resultss = results;
                    $$.each(resultss, function (key, value) {
                        $$.each(value, function (key1, value1) {
                            tx.executeSql('INSERT INTO History (UserId, ProductId, Quantity, IsLabel, LabelPrice, CreateDate, DeliveryMode, OrderInstruction, MarginLabel) VALUES(?,?,?,?,?,?,?,?,?)', [parseInt(value1.UserId), parseInt(value1.ProductId), parseInt(value1.Qty), parseInt(value1.isLabel), parseFloat(value1.labelPrice), value1.CreateDate, value1.DeliveryMode, value1.Instruction, value1.MarginLabel],
										function (tx, results) {
										    var len = results.rows.length;
										},
										function (tx, error) {
										    LogError(error.message, "", "HistoryTable");
										});
                        });
                    });
                });

                db.transaction(function (tx) {
                    tx.executeSql('DELETE FROM Cart where UserId = ?', [parseInt(localStorage.userId)],
										 function (tx, results) {
										 },
										 function (tx, error) {
										     myApp.hidePreloader();
										     LogError(error.message, "", "ProductTable - SelectSQL");
										 }, null);
                    myApp.alert('Your order has been submitted successfully', 'GHRA', function () {
                        mainView.router.loadPage('order-history.html');
                    });
                });
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "saveHistory");
            }
        }

        function LogError(status, xhr, method) {
            try {
                db.transaction(function (tx) {
                    var userID = parseInt(localStorage.userId);
                    if (!localStorage.userId) {
                        userID = 0;
                    }
                    tx.executeSql('INSERT INTO ErrorLog (UserId, ErrDate, ErrMessage, PhoneType) VALUES(?,?,?,?)', [userID, getDate(), JSON.stringify(status.toString() + " " + xhr.toString() + " " + method.toString()).slice(1, -1).toString(), DeviceType()],
									 function (tx, results) {

									 },
									 function (tx, error) {
									     myApp.hidePreloader();
									     myApp.alert("Error Occurred - Method: " + method.toString() + "!", "GHRA");
									 }, null);
                });

                myApp.hidePreloader();
                myApp.alert("Error Occurred - Method: " + method.toString() + "!", "GHRA");

            } catch (e) {
                myApp.hidePreloader();
                myApp.alert("Error - LogError Function! - " + method.toString() + "!", "GHRA");
            }
        }

        function CalDateTime(runDate) {
            try {
                var date1 = new Date(Date.parse(runDate));
                var diffMs = (new Date() - date1);
                var diffDays = Math.round(diffMs / 86400000);
                var diffHrs = Math.round((diffMs % 86400000) / 3600000);
                var diffMins = Math.round(((diffMs % 86400000) % 3600000) / 60000);
                diffDays = diffDays * 1440;
                diffHrs = diffHrs * 60;
                return (diffDays + diffHrs + diffMins);
            } catch (e) {
                return false;
            }
        }

        function getMissingUPC(upc, type) {
            try {
                db.transaction(function (tx) {
                    var userID = parseInt(localStorage.userId);
                    tx.executeSql('INSERT INTO MissingUPC (UserId, UPC, TypeId, SubmittedDate) VALUES(?,?,?,?)', [userID, upc, type, getDate()],
						function (tx, results) {

						},
						function (tx, error) {
						    myApp.hidePreloader();
						    LogError(error.message, "", "getMissingUPC-SQLInsert");
						}, null);
                });
            }
            catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getMissingUPC");
            }
        }

        function getlastupdate() {
            try {
                var d = new Date(Date.parse(serverdate));
                var datestring = (d.getMonth() + 1) + "-" + d.getDate() + "-" + d.getFullYear() + " " + (d.getHours() < 10 ? '0' : '') + d.getHours() + ":" + (d.getMinutes() < 10 ? '0' : '') + d.getMinutes() + ":" + (d.getSeconds() < 10 ? '0' : '') + d.getSeconds();
                return datestring;
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getDate");
                return false;
            }
        }

        function DeviceType() {
            try {
                if (Framework7.prototype.device.ios === true) {
                    return "IOS";
                } else if (Framework7.prototype.device.android === true) {
                    return "Android";
                } else {
                    return "Others";
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "DeviceType");
            }
        }

        function newCat(category) {
            try {
                this.category = category;
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "newCat");
            }
        }

        function newRes(results) {
            try {
                this.results = results;
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "newRes");
            }
        }

        function checkValue() {
            try {
                var formData = myApp.formToJSON('#my-form');
                var cost = parseFloat($$("#productCost").val());
                var caseQty = parseInt($$("#caseQuantity").val());
                var quantity = parseInt(formData.quantity);
                if (formData.orderSwitch[0] === 'on') {
                    $$(".productPrice").html(cost * caseQty * quantity);
                } else {
                    $$(".productPrice").html(cost * quantity);
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "checkValue");
            }
        }

        function getItemQty() {

            var labelQty = 0;
            var itemQty = 0;

            try {
                db.transaction(function (tx) {
                    var cartItems = [];
                    tx.executeSql('select sum(CART.Quantity) As TotalQty, sum(CART.Quantity * (case when SpecialPrice <= 0 then RegPrice else SpecialPrice end)) As OrderTotal from CART INNER JOIN PRODUCTS ON CART.PRODUCTID = PRODUCTS.PRODUCTID where CART.isLabel = 0 AND CART.UserId = ?', [parseInt(localStorage.userId)], function (tx, results) {
                        var len = results.rows.length;
                        if (len > 0) {
                            if (results.rows.item(0).OrderTotal != null) {
                                $$('#itemQty').html(results.rows.item(0).TotalQty);
                                itemQty = results.rows.item(0).TotalQty;
                            } else {
                                $$('#itemQty').html("0");
                            }

                        } else {
                            $$('#itemQty').html("0");
                        }
                    },
					function (tx, error) {
					    myApp.hidePreloader();
					    LogError(error.message, "", "getItemQty - SelectSQL");
					}, null);
                });

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getItemQty");
            }

        }

        function CheckPromoNotification() {


            $$.ajax({
                url: localStorage.AuthKey + "api/PromotionMessages/GetPromotionMessage?id=" + parseInt(localStorage.userId),
                type: "GET",
                dataType: "json",
                async: false,
                success: function (data) {

                    if (data && data.results.length > 0) {
                        myApp.addNotification({
                            title: 'PROMOTIONS !!!',
                            hold: 15000,
                            message: data.results[0].PromoMessage,
                            onClick: function () {
                                mainView.router.loadPage('promotion.html');
                            }
                        });
                        
                    }
                },
                error: function (status, xhr, error) {
                    myApp.hidePreloader();
                    LogError(status, xhr, "GetPromotionNotificationError");
                }
            });




        }

        // Check Connection ..
        function checkConnection() {
            if (navigator.network.connection.type == Connection.NONE) {

                ConnectionReady = "NO";
                return false;
            } else {
                ConnectionReady = "YES";
                return true;
            }
        }

        function CreateDB() {
            myApp.hidePreloader();
            myApp.showPreloader('Creating Database ...');
            try {
                if (!window.openDatabase) {
                    myApp.hidePreloader();
                    myApp.alert('DB not supported');
                } else {
                    
                    var shortName = 'maindb';
                    var version = '1.0';
                    var displayName = 'Main DB';
                    var maxSize = 10 * 1024 * 1024; // in bytes
                    db = openDatabase(shortName, version, displayName, maxSize);

                    //Table Customer (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS Customer (UserId INTEGER unique, UserName TEXT, Password TEXT, CompanyName TEXT, Address TEXT, EmailAddress TEXT, CellPhone TEXT, Status NUMERIC, PermitExpire NUMERIC, TobaccoLimit NUMERIC, GenLimit NUMERIC, DeliveryMode TEXT, DeliveryDay TEXT, ChkoutRule NUMERIC, BulkyRule NUMERIC)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "CustomerTable");
								});
                    });

                    //Table Categories (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS Categories (CategoryId INTEGER unique, Description TEXT, Status NUMERIC, ImageUrl TEXT, isTobacco NUMERIC, Margin INTEGER)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "CategoriesTable");
								});
                    });

                    //Table SubCategories (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS SubCategories (SubCategoryId INTEGER unique, Description TEXT, Status NUMERIC, ImageUrl TEXT, CategoryId NUMERIC)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "SubCategoriesTable");
								});
                    });

                    //Table Products (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS Products (ProductId INTEGER unique, SKU TEXT, Description TEXT, RegPrice REAL, SpecialPrice REAL, IsFeature NUMERIC, IsPromotion NUMERIC, IsNew NUMERIC, CategoryId INTEGER, CategoryName TEXT, IsTobacco NUMERIC, SRPrice REAL, SellPack NUMERIC, Size TEXT, Status NUMERIC, Bulky Numeric, IsDiscounted Numeric, DiscountPrice REAL, DiscountReason TEXT, CaseQty NUMERIC, isDSD Numeric, InStock NUMERIC, DPri REAL, DFlag TEXT, UPri REAL, SRPer INTEGER)', [],
						function (tx, results) {
							var len = results.rows.length;
						},
						function (tx, error) {
							myApp.hidePreloader();
							LogError(error.message, "", "ProductsTable");
						});

                    });

                    //Table UPC (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS UPC (id INTEGER unique, ProductId INTEGER, SKU TEXT, UPC TEXT, Status NUMERIC)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "UPCTable");
								});
                    });

                    //Table ANNOUNCEMENTS (On First Load) 
                    db.transaction(function (tx) {
                        tx.executeSql('DROP TABLE IF EXISTS Annoucements');//IF NOT EXISTS
                    });

                    //Table Server Date (On First Load) 
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS ServerDate (ShortName TEXT, CompanyUrl TEXT, FullCompany TEXT, CompanyAddress TEXT, CompanyPhoneNumber TEXT, Email TEXT, ServerDate TEXT, ImageLocationURL TEXT, DBSync INTEGER, AllowQty INTEGER, delInActive INTEGER, ROGen NUMERIC, ROTob NUMERIC, RTGen NUMERIC, RTHTob NUMERIC, BulkItem INTEGER, AdminPassword TEXT, Fax TEXT, CompanyHours TEXT, StorePolicy TEXT, CheckOutPolicy TEXT, PaidRuleTob NUMERIC, PaidRuleGro NUMERIC, DeliveryAmount TEXT, BulkMessage Text)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "ServerDateTable");
								});
                    });

                    //Table Cart (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS Cart (ID INTEGER PRIMARY KEY AUTOINCREMENT, UserId INTEGER, ProductId INTEGER, Quantity INTEGER, IsLabel NUMERIC, LabelPrice NUMERIC, CreateDate TEXT, DeliveryMode TEXT, OrderInstruction TEXT, MarginLabel INTEGER)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "CartTable");
								});
                    });

                    //Table History (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS History (ID INTEGER PRIMARY KEY AUTOINCREMENT, UserId INTEGER, ProductId INTEGER, Quantity INTEGER, IsLabel NUMERIC, LabelPrice NUMERIC, CreateDate TEXT, DeliveryMode TEXT, OrderInstruction TEXT, MarginLabel INTEGER)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "HistoryTable");
								});
                    });

                    //Table ErrorLog (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS ErrorLog (ID INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, UserId INTEGER, ErrDate TEXT, ErrMessage TEXT, PhoneType TEXT)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "ErrorLogTable");
								});
                    });

                    //Table SetMsrp (On First Load)
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS SetMsrp (ID INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, CategoryId INTEGER, isMSRP INTEGER, perMSRP INTEGER, UserId INTEGER)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "SetMsrpTable");
								});
                    });

                    //Table Missing UPC
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS MissingUPC (ID INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, UserId INTEGER, UPC TEXT, TypeId INTEGER, SubmittedDate TEXT)', [],
								function (tx, results) {
								    var len = results.rows.length;
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "MissingUPCTable");
								});
                    });

                    //Table Shipping Rule
                    db.transaction(function (tx) {
                        tx.executeSql('CREATE TABLE IF NOT EXISTS SHIPPINGRULE (ID INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, ModeId INTEGER, Method TEXT, Rule TEXT, Status INTEGER)', [],
								function (tx, results) {
								},
								function (tx, error) {
								    myApp.hidePreloader();
								    LogError(error.message, "", "ShippingRule");
								});
                    });


                    db.transaction(function (tx) {
                        myApp.hidePreloader();
                        getData();
                    });

                }
            } catch (e) {
                myApp.hidePreloader();
                myApp.alert('Error while creating DB .. Please uninstall app and try again!');
                // Error handling
                LogError(e.message, "", "CreateDB");
            }
        }

        function resetData() {
            try {

                if (checkConnection()) {
                    myApp.confirm('This feature will remove all the data from the application inculding cart, do you want to continue?', 'Reset Application',
						 function () {
						     myApp.showPreloader("Resetting Application ...");

						     var sqlstatements = ["Drop Table Customer;", "Drop Table Categories;", "Drop Table  SubCategories;", "Drop Table Products;", "Drop Table UPC;", "Drop Table IF EXISTS Announcements;", "Drop Table ServerDate;", "Drop Table Cart;", "Drop Table History;", "Drop Table SetMsrp;", "Drop Table ErrorLog;", "Drop Table MissingUPC;"];


						     var i;
						     db.transaction(function (tx) {
						         i = 0;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });


						     db.transaction(function (tx) {
						         i = 1;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 2;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 3;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 4;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 5;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 6;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 7;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 8;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 9;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 10;
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);

						     });

						     db.transaction(function (tx) {
						         i = 11
						         tx.executeSql(sqlstatements[i], [],
								  function (tx, results) {

								      if (i === 11) {
								          window.localStorage.clear();
								          myApp.hidePreloader();
								          myApp.alert('Application has been resetted, application will now redirect you to login page, please make sure you have internet connection.', 'Reset Application!', function () {
								              onDeviceReady();
								          });
								          return false;
								      }
								  },
								  function (tx, error) {
								      myApp.hidePreloader();
								      LogError(error.message, "", sqlstatements[i]);
								  }, null);


						     });

						 },
						 function () {
						 }
					   );
                } else {
                    myApp.hidePreloader();
                    myApp.alert("This feature requires internet connection, please check your internet connection!!", "resetData");
                }
            } catch (e) {
                LogError(e.message, "", "resetData");
                myApp.hidePreloader();
            }
        }

        function getKey() {
            myApp.hidePreloader();
            myApp.showPreloader('Getting License Key ...');
            try {
                if (checkConnection()) {
                    $$.ajax({
                        url: "https://www.ghrawarehouseapi.com/api/Licenses/" + appCompanyId,
                        method: "GET",
                        crossDomain: "false",
                        async: false,
                        success: function (data) {
                            var jsonData = JSON.parse(data);
                            localStorage.AuthKey = jsonData.results[0].CompanyApiUrl
                            myApp.hidePreloader();
                            myApp.showPreloader('Updating DB ...');
                            CreateDB();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "Licenses");
                            myApp.alert("Server Error Occured!!", "GHRA");
                        }
                    });
                } else {
                    myApp.hidePreloader();
                    myApp.alert('Application requires internet connection for the first time, please check you internet connection and try again.', 'Exit Application!', function () {
                        navigator.app.exitApp();
                    });
                }
            } catch (e) {
                LogError(e.message, "", "getKey");
                myApp.hidePreloader();
                myApp.alert("Get License Key Error Occured!!", "GHRA");
            }
        }

        function getAuthKey() {
            //what if authkey has changed .. person can't login so can't update authkey .. ???
            try {
                //If authkey then go create db ..
                if (localStorage.AuthKey) {
                    CreateDB();
                } else {
                    ///otherwise go get auth key
                    getKey();
                }

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getAuthKey");
                myApp.alert("Get Auth Key Error Occured!!", "GHRA");
            }

        }


        function onDeviceReady() {

            try {

                //If device is android and someone press back back ...
                if (Framework7.prototype.device.android === true) {
                    document.addEventListener("backbutton", function (e) {

                        navigator.app.backHistory();

                    }, false);
                }

            } catch (e) {
                //Catch Error
                myApp.hidePreloader();
                LogError(e.message, "", "DeviceType");
                myApp.alert("onDeviceReady Error Occurred!!", "GHRA");
            }


            try {

                    //Start Login Screen
                myApp.loginScreen();

                    $$("#signin").hide();

                    setTimeout(function () {

                        //Main Function ..
                        //If Connection true ... go fetch data ... everytime ...
                        //check app version ...
                        if (checkConnection()) {
                            myApp.hidePreloader();
                            myApp.showPreloader('Checking App Version ...');
                            try {
                                $$.ajax({
                                    url: "https://www.ghrawarehouseapi.com/api/Stores/GetMobStore",
                                    method: "GET",
                                    dataType: 'json',
                                    data: { id: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28' },
                                    crossDomain: "false",
                                    async: false,
                                    success: function (response, status, xhr) {
                                        //if version number is not equal to server version number
                                        if (versionnumber === response.results[0].AllowQty) {
                                            if (localStorage.checkNewVersion) {
                                                
                                            } else {
                                                window.localStorage.clear();
                                                localStorage.checkNewVersion = true;
                                            }
                                            myApp.hidePreloader();
                                            startup();
                                        } else {
                                            //Clean Local Storage if app version is old.
                                            window.localStorage.clear();
                                            myApp.hidePreloader();
                                            if (isAndroid) {
                                                $$('#storelinkgoogle').show();
                                                $$('#storelinkapple').hide();
                                            } else {
                                                $$('#storelinkgoogle').hide();
                                                $$('#storelinkapple').show();
                                            }
                                            myApp.popup('.popup-version');
                                        }
                                    },
                                    complete: function (status, xhr) {
                                        myApp.hidePreloader();
                                    },
                                    error: function (status, xhr) {
                                        myApp.hidePreloader();
                                        LogError(status, xhr, "GetMobStore");
                                    }
                                });
                            } catch (e) {
                                myApp.hidePreloader();
                                LogError(e.message, "", "ServerDatesTable");
                            }

                        } else {

                            //If no connection .. go to start up directly...
                            myApp.hidePreloader();
                            startup();
                        }

                    }, 300);

                    

            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "onDeviceReady");
            }
        }

        function startup() {

            //Check LocalStorage for Last Logged In User Creditentials
            if (localStorage.userName) {
                $$('#username').val(localStorage.userName);
            }
            if (localStorage.password) {
                $$('#password').val(localStorage.password);
            }

            
            //GetMobProducts
            //Global Template Variables
            Template7.global = {
                imagelocationurlbig: localStorage.imagelocationurl,
                imagelocationurl: localStorage.imagelocationurl + "100/",
                checkinstock: localStorage.CheckInStock
            };

            //Check LocalStorage for ServerDate ---- Record Update Date
            if (localStorage.serverdate) {
                serverdate = localStorage.serverdate;
            } else {
                serverdate = "01-01-2000 11:11:11";
            }

            if (localStorage.lastrundatetime) {
                lastrundatetime = localStorage.lastrundatetime;
            } else {
                lastrundatetime = "01-01-2015 11:11:11";
            }

            if (localStorage.dbsync) {
                dbsync = parseInt(localStorage.dbsync);
            } else {
                dbsync = 120;
            }

            myApp.hidePreloader();
            myApp.showPreloader('Processing ...');

            getAuthKey();

            $$("#signin").show();

        }

        function syncData() {
            myApp.showPreloader('Updating DB ...');
            try {
                if (checkConnection()) {
                    getData();
                    myApp.alert("DB has been updated!", "GHRA");
                } else {
                    myApp.hidePreloader();
                    myApp.alert("Please Check Your Internet Connection!!", "syncData");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "syncData");
            }
        }

        function syncPrices() {
            try {
                if (checkConnection()) {
                    myApp.showPreloader('Verifying Cart ...');
                    getData();
                } else {
                    myApp.hidePreloader();
                    myApp.alert("You will need internet connection in order to submit your cart, please Check Your Internet Connection!!");
                }
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "syncPrices");
            }
        }

        function openMarket(phone) {
            var appId = '';
            if (phone === 'android') {
                appId = 'com.itformulation.cart';
            } else {
                appId = 'id1071581508';
            }
            cordova.plugins.market.open(appId);
        }

        function getData() {
            myApp.hidePreloader();

            if (checkConnection()) {

                myApp.showPreloader('Getting Data ...');

                db.transaction(function (tx) {

                    //Categories
                    //CategoryId, Description, Status, ImageUrl, isTobacco
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/Categories/GetMobCategories",
                                method: "GET",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', LastDate: serverdate },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {
                                    
                                    db.transaction(function (tx) {
                                        $$.each(JSON.parse(response).results, function (key, value) {
                                           
                                            tx.executeSql('INSERT OR REPLACE INTO Categories (CategoryId, Description, Status, ImageUrl, isTobacco, Margin) VALUES(?,?,?,?,?,?)', [value.CategoryId, value.Description, value.Status, value.ImageUrl, value.isTobacco, value.Margin],
                                            function (tx, results) {

                                            },
                                            function (tx, error) {
                                                myApp.hidePreloader();
                                                LogError(error.message, "", "CategoriesTable  - SelectSQL");
                                            }
                                            );
                                        });
                                    });
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobCategories");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "CategoriesTable");
                        }
                    }

                    //SubCategories
                    //SubCategoryId, Description, Status, ImageUrl, CategoryId
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/SubCategory/GetMobSubCategories",
                                method: "GET",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', LastDate: serverdate },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {
                                    db.transaction(function (tx) {
                                        $$.each(JSON.parse(response).results, function (key, value) {

                                            tx.executeSql('INSERT OR REPLACE INTO SubCategories (SubCategoryId, Description, Status, ImageUrl, CategoryId) VALUES(?,?,?,?,?)', [value.SubCategoryId, value.Description, value.Status, value.ImageUrl, value.CategoryId],
                                             function (tx, results) {
                                             },
                                             function (tx, error) {
                                                 myApp.hidePreloader();
                                                 LogError(error.message, "", "SubCategoriesTable - SelectSQL");
                                             }, null);

                                        });

                                    });
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobSubCategories");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "SubCategoriesTable");
                        }
                    }

                    //UPC
                    //Id, ProductId, SKU, UPC, Status 
                    if (checkConnection()) {
                        try {

                            for (var i = 1; i <=6 ; i++) {

                            $$.ajax({
                                url: localStorage.AuthKey + "api/UPC/GetProductsIOnUPC",
                                method: "GET",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', LastDate: serverdate, BId: i },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {
                                    db.transaction(function (tx) {
                                        $$.each(JSON.parse(response).results, function (key, value) {

                                            tx.executeSql('INSERT OR REPLACE INTO UPC (id, ProductId, SKU, UPC, Status) VALUES (?,?,?,?,?)', [value.id, value.ProductId, value.SKU, value.UPC, value.Status],
                                                 function (tx, results) {

                                                 },
                                                 function (tx, error) {
                                                     myApp.hidePreloader();
                                                     LogError(error.message, "", "UPCTable - SelectSQL");
                                                 }, null);
                                        });

                                    });
                                    myApp.hidePreloader();

                                },
                                complete: function (status, xhr) {
                                    //Delete InActive Products
                                    db.transaction(function (tx) {
                                        tx.executeSql('DELETE FROM UPC where Status = 0', [],
                                                 function (tx, results) {
                                                 },
                                                 function (tx, error) {
                                                     myApp.hidePreloader();
                                                     LogError(error.message, "", "UPCTable - DELETE UPC");
                                                 }, null);
                                    });
                                    myApp.hidePreloader();
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetProductsUPC");
                                    myApp.alert("Server Error Occured!!", "GHRA");
                                }
                                });

                            }


                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "UPCTABLE");
                        }
                    }

                    //CatSub  Object-ALL
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/CatWithSubCats/GetMobCatWithSubCat",
                                method: "GET",
                                dataType: "json",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', ObjectType: 'A' },
                                crossDomain: "false",
                                async: false,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {

                                    var category = [];
                                    $$.each(response.results, function (key, value) { 
                                        category.push(value);
                                        GetProductsByCat(value.CategoryId);
                                       
                                    });
                                    var newResults = new newCat(category);
                                    localStorage.CatSubObject = JSON.stringify(newResults);
                                    myApp.hidePreloader();

                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobCatWithSubCat-A");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "CategorySubObjAllTable");
                        }
                    }

                    //CatSub  Object-P
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/CatWithSubCats/GetMobCatWithSubCat",
                                method: "GET",
                                dataType: "json",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', ObjectType: 'P' },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {

                                    var category = [];
                                    $$.each(response.results, function (key, value) {
                                        category.push(value);
                                    });
                                    var newResults = new newCat(category);
                                    localStorage.CatSubObjectP = JSON.stringify(newResults);
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobCatWithSubCat-P");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "CategorySubObjPTable");
                        }
                    }

                    //CatSub  Object-N
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/CatWithSubCats/GetMobCatWithSubCat",
                                method: "GET",
                                dataType: "json",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', ObjectType: 'N' },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {

                                    var category = [];
                                    $$.each(response.results, function (key, value) {
                                        category.push(value);
                                    });
                                    var newResults = new newCat(category);
                                    localStorage.CatSubObjectN = JSON.stringify(newResults);
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobCatWithSubCat-N");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "CategorySubObjNTable");
                        }
                    }

                    //CatSub  Object-F
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/CatWithSubCats/GetMobCatWithSubCat",
                                method: "GET",
                                dataType: "json",
                                data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', ObjectType: 'F' },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {

                                    var category = [];
                                    $$.each(response.results, function (key, value) {
                                        category.push(value);
                                    });
                                    var newResults = new newCat(category);
                                    localStorage.CatSubObjectF = JSON.stringify(newResults);
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobCatWithSubCat-F");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "CategorySubObjFTable");
                        }

                    }

                    //Shipping Rule
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: "https://www.ghrawarehouseapi.com/api/Rules/ShippingRule",
                                method: "GET",
                                dataType: 'json',
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                },
                                success: function (response, status, xhr) {
                                    myApp.hidePreloader();
                                    db.transaction(function (tx) {
                                        tx.executeSql('DELETE FROM SHIPPINGRULE');
                                        $$.each(response, function (key, value1) {
                                            tx.executeSql('INSERT OR REPLACE INTO SHIPPINGRULE (ModeId, Method, Rule, Status) VALUES (?,?,?,?)', [value1.ModeId, value1.Method, value1.Rule, value1.Status],
                                                   function (tx, results) {

                                                   },
                                                   function (tx, error) {
                                                       myApp.hidePreloader();
                                                       LogError(error.message, "", "ServerDate - SelectSQL");
                                                   }, null);
                                        });



                                    });
                                },
                                complete: function (status, xhr) {
                                    myApp.hidePreloader();
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobStore");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "ServerDatesTable");
                        }
                    }

                    //Server Dates
                    //Id, SiteId, ShortName, CompanyUrl, FullCompany, CompanyAddress, CompanyPhoneNumber, Email, ServerDate
                    if (checkConnection()) {
                        try {
                            $$.ajax({
                                url: localStorage.AuthKey + "api/Stores/GetMobStore",
                                method: "GET",
                                dataType: 'json',
                                data: { id: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28' },
                                crossDomain: "false",
                                async: true,
                                beforeSend: function (xhr) {
                                    myApp.hidePreloader();
                                    myApp.showPreloader('Updating Application DB');
                                    //Update the table ....
                                    //just once ....
                                    //   if (localStorage.alterServerTable) {

                                    //    }else{
                                    //Drop Table ..
                                    db.transaction(function (tx) {
                                        tx.executeSql('DROP TABLE ServerDate');
                                    });
                                    ///Create Table ...

                                    db.transaction(function (tx) {
                                        tx.executeSql('CREATE TABLE IF NOT EXISTS ServerDate (ShortName TEXT, CompanyUrl TEXT, FullCompany TEXT, CompanyAddress TEXT, CompanyPhoneNumber TEXT, Email TEXT, ServerDate TEXT, ImageLocationURL TEXT, DBSync INTEGER, AllowQty INTEGER, delInActive INTEGER, ROGen NUMERIC, ROTob NUMERIC, RTGen NUMERIC, RTHTob NUMERIC, BulkItem INTEGER, AdminPassword TEXT, Fax TEXT, CompanyHours TEXT, StorePolicy TEXT, CheckOutPolicy TEXT, PaidRuleTob NUMERIC, PaidRuleGro NUMERIC, DeliveryAmount TEXT, BulkMessage Text)', [],
                                                function (tx, results) {
                                                    var len = results.rows.length;
                                                },
                                                function (tx, error) {
                                                    myApp.hidePreloader();
                                                    LogError(error.message, "", "ServerDateTable");
                                                });
                                    });

                                  
                                },

                               
                                //ROGen , ROTob , RTGen , RTHTob
                                success: function (response, status, xhr) {
                                    db.transaction(function (tx) {
                                        tx.executeSql('DELETE FROM ServerDate');
                                        $$.each(response.results, function (key, value1) {
                                            tx.executeSql('INSERT OR REPLACE INTO ServerDate (ShortName, CompanyUrl, FullCompany, CompanyAddress, CompanyPhoneNumber, Email, ServerDate, ImageLocationURL, DBSync, AllowQty, delInActive, ROGen, ROTob, RTGen, RTHTob, BulkItem, AdminPassword,Fax,CompanyHours,StorePolicy,CheckOutPolicy, PaidRuleTob, PaidRuleGro, DeliveryAmount, BulkMessage) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)', [value1.ShortName, value1.CompanyUrl, value1.FullCompany, value1.CompanyAddress, value1.CompanyPhoneNumber, value1.Email, value1.ServerDate, value1.ImageLocationURL, value1.DBSync, value1.AllowQty, value1.delInActive, value1.R1Gen, value1.R1Tob, value1.R2Gen, value1.R3Tob, value1.BulkItem, value1.AdminPassword, value1.Fax, value1.CompanyHours, value1.StorePolicy, value1.CheckOutPolicy, value1.PaidRuleTob, value1.PaidRuleGro, value1.DeliveryAmount, value1.BulkMessage],
                                                   function (tx, results) {

                                                   },
                                                   function (tx, error) {
                                                       myApp.hidePreloader();
                                                       LogError(error.message, "", "ServerDate - SelectSQL");
                                                   }, null);
                                            localStorage.captionDelivery = value1.DeliveryAmount;
                                            localStorage.serverdate = value1.ServerDate;
                                            serverdate = value1.ServerDate;
                                           
                                            localStorage.dbsync = value1.DBSync;
                                            dbsync = value1.DBSync;
                                            localStorage.bulkitem = value1.BulkItem;
                                            localStorage.imagelocationurl = value1.ImageLocationURL;
                                            localStorage.Fax = value1.Fax;
                                            localStorage.companyHours = value1.CompanyHours;
                                            localStorage.companyNameFull = value1.FullCompany;
                                            localStorage.companyNameShort = value1.ShortName;
                                            localStorage.companyAddress = value1.CompanyAddress;
                                            localStorage.versionnumber = value1.AllowQty;
                                            localStorage.CheckInStock = value1.delInActive;
                                            localStorage.BulkMessage = value1.BulkMessage;
                                            
                                            localStorage.CheckOutPolicy = value1.CheckOutPolicy;
                                            Template7.global = {
                                                imagelocationurlbig: localStorage.imagelocationurl,
                                                imagelocationurl: localStorage.imagelocationurl + "100/",
                                                checkinstock: localStorage.CheckInStock
                                            };
                                        });



                                    });
                                    myApp.hidePreloader();
                                },
                                complete: function (status, xhr) {
                                },
                                error: function (status, xhr) {
                                    myApp.hidePreloader();
                                    LogError(status, xhr, "GetMobStore");
                                }
                            });
                        } catch (e) {
                            myApp.hidePreloader();
                            LogError(e.message, "", "ServerDatesTable");
                        }
                    }

                    //Shipping Rules
                    //Delete and insert

                    localStorage.lastrundatetime = new Date();
                    lastrundatetime = new Date();


                });

                db.transaction(function (tx) {
                    myApp.hidePreloader();
                });
            }
        }

        function getDate() {
            try {
                var d = new Date();
                var datestring = (d.getMonth() + 1) + "-" + d.getDate() + "-" + d.getFullYear() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
                return datestring.toString();
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getDate");
                return false;
            }
        }

        function scanbarcode() {
            isOnResume = false;
            try {
                oprnscaner = 1;
                cloudSky.zBar.scan(
                    {
                        text_title: "GHRA", // Android only
                        text_instructions: "", // Android only
                        camera: "back", // defaults to "back"
                        flash: "off", // defaults to "auto". See Quirks
                        drawSight: false //defaults to true, create a red sight/line in the center of the scanner view.
                    },
					  function (text) {
					      
                          

					      if (text !== "") {
					          
					          myApp.showIndicator();
					          var id = text;
					          var pid = 0;

					          setTimeout(function () {

					              db.transaction(function (tx) {
					                  tx.executeSql('SELECT ProductId FROM UPC where UPC = ?', [id],
                                          function (tx, results) {
                                       
                                          if (results.rows.length > 0) {
                                              
                                              pid = results.rows.item(0).ProductId;
                                             
                                          }
                                         
									  },
									  function (tx, error) {
									      myApp.hideIndicator();
									      myApp.hidePreloader();
									      LogError(error.message, "", "scanbarcode - SelectSQL");
									  }, null);

					              });

					              db.transaction(function (tx) {
                                      tx.executeSql('SELECT ProductId, m.perMSRP, SKU, IsDiscounted, DiscountReason, Description, RegPrice, DFlag, DPri, UPri, SpecialPrice, InStock, CaseQty, p.CategoryId, CategoryName, SRPrice, SellPack, Size, SRPer, isDSD FROM Products p left join (select CategoryId, isMSRP, perMSRP from SetMsrp where userid = ?) AS m on p.CategoryId = m.CategoryId where p.ProductId = ?', [parseInt(localStorage.userId), parseInt(pid)],
								  function (tx, results) {
								      if (results.rows.length > 0) {
								          var data = results.rows.item(0);

								          var popupHTML = Template7.templates.popupaddTemplate(data);
								          $$("#popupaddContent").html(popupHTML);
								          $$("#quantityid").html(getQtyOptions());
								          myApp.hideIndicator();
								          myApp.popup('.popup-add');								          
								      } else {
								          $$("#popupaddContent").html("");
								          myApp.hideIndicator();
								          scantextid = id;
								          $$('#scantextval').html(scantextid);
								          getMissingUPC(id, 1);
								          myApp.popup('.popup-notfound');
								      }
								  },
								  function (tx, error) {
								      myApp.hideIndicator();
								      myApp.hidePreloader();
								      LogError(error.message, "", "scanbarcode - SelectSQL");
								  }, null);

					              });

					          }, 250);

					      }

					  },
					  function (error) {
					      
					      myApp.hideIndicator();
					     
					      myApp.hidePreloader();
					     
					  }
				   );
            } catch (e) {
                myApp.hideIndicator();
                myApp.hidePreloader();
                LogError(e.message, "", "scanbarcode");
            }


        }


        function getQtyOptions() {
            try {
                var text = '<option value="0">Order Label Only</option>';
                text += '<option value="1" selected>1</option>';
                for (i = 2; i <= 200; i++) {
                    text += '<option value="' + i + '">' + i + '</option>';
                }
                return text;
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getQtyOptions");
                return false;
            }
        }

        function getQtyReturn() {
            try {
                var text = '<option value="0">Order Label Only</option>';
                text += '<option value="1" selected>1</option>';
                for (i = 2; i <= 200; i++) {
                    text += '<option value="' + i + '">' + i + '</option>';
                }
                return text;
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "getQtyOptions");
                return false;
            }
        }

        function emptyCart() {

            try {
                myApp.confirm('Are you sure you want to empty the cart?', 'GHRA',
					 function () {
					     myApp.showPreloader("Please wait ...");
					     db.transaction(function (tx) {
					         tx.executeSql('DELETE from cart where userid = ?', [parseInt(localStorage.userId)],
								 function (tx, results) {
								     getItemQty();
								     myApp.hidePreloader();
								     myApp.alert('Your cart has been emptied!');
								 },
								 function (tx, error) {
								     myApp.hidePreloader();
								     LogError(error.message, "", "emptyCart - SelectSQL");
								 }, null);
					     });
					 },
					 function () {
					 }
				   );
            } catch (e) {
                myApp.hidePreloader();
                LogError(e.message, "", "emptyCart");
            }
        }

        function GetProductsByCat(catId) {
            //Products
            //ProductId, SKU, Description, RegPrice, SpecialPrice, MarkDown, InStock, IsFreeShip, CaseQty, IsFeature, IsPromotion, IsNew, CategoryId, CategoryName, SubCategoryId, SubCategoryName, ImageUrl, IsTobacco, SRPrice, SellPack, Size, Status
            if (checkConnection()) {
                try {
                    $$.ajax({
                        url: localStorage.AuthKey + "api/Products/GetMobIOnProductsByCat",
                        method: "GET",
                        data: { key: '97316FFF-A4CC-455C-B17A-5CA6AA3CCC28', CatId: catId, LastDate: serverdate },
                        crossDomain: "false",
                        async: true,
                        beforeSend: function (xhr) {
                            myApp.hidePreloader();
                            myApp.showPreloader('Updating Application DB');
                        },
                        success: function (response, status, xhr) {

                            db.transaction(function (tx) {

                                $$.each(JSON.parse(response).results, function (key, value) {
                                    tx.executeSql('INSERT OR REPLACE INTO Products (ProductId, SKU, Description, RegPrice, SpecialPrice, IsFeature, IsPromotion, IsNew, CategoryId, CategoryName, IsTobacco, SRPrice, SellPack, Size, Status, Bulky, IsDiscounted, DiscountPrice, DiscountReason, CaseQty, isDSD, InStock, DPri, DFlag, UPri, SRPer) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)', [value.ProductId, value.SKU, value.Description, value.RegPrice, value.SpecialPrice, value.IsFeature, value.IsPromotion, value.IsNew, value.CategoryId, value.CategoryName, value.IsTobacco, value.SRPrice, value.SellPack, value.Size, value.Status, value.Bulky, value.IsDiscounted, value.DiscountPrice, value.DiscountReason, value.CaseQty, value.isDSD, value.InStock, value.DPri, value.DFlag, value.UPri, value.SRPer],
                                        function (tx, results) {

                                        },
                                        function (tx, error) {
                                            myApp.hidePreloader();
                                            LogError(error.message, "", "ProductTable - SelectSQL");
                                        }, null);

                                });

                            });
                            myApp.hidePreloader();

                        },
                        complete: function (status, xhr) {
                            //Delete InActive Products
                            db.transaction(function (tx) {
                                tx.executeSql('DELETE FROM Products where Status = 0', [],
                                    function (tx, results) {
                                    },
                                    function (tx, error) {
                                        myApp.hidePreloader();
                                        LogError(error.message, "", "ProductTable - DELETE PRODUCT");
                                    }, null);
                            });
                            myApp.hidePreloader();
                        },
                        error: function (status, xhr) {
                            myApp.hidePreloader();
                            LogError(status, xhr, "GetMobProducts");
                            myApp.alert("Server Error Occured!!", "GHRA");
                        }
                    });
                } catch (e) {
                    myApp.hidePreloader();
                    LogError(e.message, "", "ProductTable");
                }
            }
        }

        function precisionRound(number, precision) {
            var factor = Math.pow(10, precision);
            return Math.round(number * factor) / factor;
        }

        $$(document).on('focusout', '#sretailid', function (e) {
            if ($$(this).val().trim().length > 0) {
                var thisval = parseFloat($$(this).val().trim());
                if (thisval > 0) {
                    var unitprice = parseFloat($$('#perUnitCost').val().trim());
                    var newpercent = Math.round(((thisval - unitprice) / thisval) * 100); 
                    $$('#permsrp').val(newpercent.toFixed(2));
                    $$('#sretailid').val(thisval.toFixed(2));
                    $$('#showmsrplabel').html("(" + newpercent + "%)");
                    if (thisval < unitprice) {
                        myApp.alert('Lable Price should be greater than Unit Price!', 'GHRA')
                        $$('#btnaddtocart').addClass("disabled");
                        $$('#btnaddtocart').addClass("button-red");
                        $$('#btnaddtocart').removeClass("button-green");
                    } else {
                        $$('#btnaddtocart').removeClass("disabled");
                        $$('#btnaddtocart').removeClass("button-red");
                        $$('#btnaddtocart').addClass("button-green");
                    }
                }
                else {
                    $$('#showmsrplabel').html("(0%)");
                    $$('#sretailid').val('0');
                    $$('#btnaddtocart').addClass("disabled");
                    $$('#btnaddtocart').addClass("button-red");
                }
            } else {
                $$('#showmsrplabel').html("(0%)");
                $$('#sretailid').val('0');
                $$('#btnaddtocart').addClass("disabled");
                $$('#btnaddtocart').addClass("button-red");
            }
        });

    </script>

</body>

</html>